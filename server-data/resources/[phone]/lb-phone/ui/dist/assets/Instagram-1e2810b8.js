import{H as _e,r as i,u as Z,cq as Me,q as L,ba as $e,p,bb as he,_ as Q,C as H,L as s,j as a,a as e,a3 as ue,bN as qe,N as Ne,cr as De,d as ne,F as X,m as Se,b as me,aU as Ee,b6 as ye,P as oe,a2 as re,cs as ze,R as Ye,a7 as Ae,K as Ke,E as le,b7 as Pe,T as Xe,A as Ce,J as ce,ct as Fe,cu as Ve,s as ae,x as Ue,I as pe,w as Te,a9 as Re,aj as de,am as je,an as Je,aD as Qe,cv as Ze,t as et,ab as Ge,ac as be,aP as tt,ca as at,bX as st,ch as nt,c1 as it,ci as rt,af as ct,cw as lt,be as ot}from"./index-4a091edb.js";import{S as mt}from"./Switch-db0cdd4f.js";import{T as xe}from"./Textarea-17af0c3b.js";import{formatNumber as dt}from"./Tiktok-e6c0fd15.js";import"./Slider-7737f6ef.js";const se=_e({host:"",participants:[],viewers:0});function ut(){var $,te,ie,ve;const{View:n,Account:m,Func:S}=i.useContext(q),o=Z(me),[N,g]=n,[c]=m,r=Z(se),[u,f]=i.useState(!1),[l,t]=i.useState(!1),[P,k]=i.useState(null),[M,w]=i.useState(""),T=i.useRef(null),V=i.useRef(null),h=i.useRef(null),[A,R]=i.useState(null),[D,I]=i.useState(null),[d,G]=i.useState(null),[y,E]=i.useState([]),[_,z]=i.useState([]),[Y,ee]=i.useState([]);i.useEffect(()=>{T.current.scrollTop=T.current.scrollHeight},[Y]),i.useEffect(()=>{const C=o.rtc?new Me({config:o.rtc}):new Me;return C.on("open",v=>{R({peer:C,id:v})}),C.on("call",v=>{v.on("close",()=>{z(O=>O.filter(W=>W.connectionId!==v.connectionId))}),z(O=>[...O,v])}),L("info","Created peer"),()=>{try{for(let v of _)v.close()}catch{L("error","Failed to close calls")}try{C.destroy()}catch{L("error","Failed to destroy peer")}}},[]),i.useEffect(()=>{if(!d||h!=null&&h.current||!A)return;L("info","Creating game render");let C=new $e(d);h.current=C,C.resizeByAspect(3/4);const v=window.innerWidth;v>1280&&C.setQuality(1280/v);let O;if(D||u){L("info","Host is true, creating call"),u?p("Instagram",{action:"setLive",username:c.username,verified:c.verified,id:A.id}):D&&p("Instagram",{action:"joinLive",username:D,streamId:A.id}).then(B=>{if(I(null),!B)return L("error","Failed to join live");t(!0)});const W=d.captureStream(24);O=B=>{L("info","Answering call",B),B.answer(W)},A.peer.on("call",O)}return()=>{O&&A.peer.off("call",O),h.current&&h.current.destroy(),h.current=null}},[d,A]);const x=C=>{C.forEach(v=>{if(v.username===c.username)return L("info","Skipping self");L("info","Adding participant",v);const O=document.createElement("canvas"),W=O.captureStream(0),B=A.peer.call(v.id,W);z(J=>[...J,B]),B.on("close",O.remove),B.on("error",O.remove),B.on("stream",J=>{p("Instagram",{action:"addCall",id:B.connectionId,username:v.username}),E(ge=>[...ge,{stream:J,username:v.username}])})})},U=C=>{C.forEach(v=>{L("info","Removing participant",v),v.username===c.username&&t(!1),E(O=>O.filter(W=>W.username!==v.username))})};i.useEffect(()=>{const C=r.participants;if(!C||!A)return L("warning","No participants");const v=C.filter(W=>!y.find(B=>B.username===W.username));v.length&&x(v),L("info","Added",v);const O=y.filter(W=>!C.find(B=>B.username===W.username));O.length&&U(O),L("info","Removed",O)},[r.participants,A]),i.useEffect(()=>{const C=c.username===(r==null?void 0:r.host);return f(C),he.ShouldClose.set(!1),C&&E(v=>[...v,{username:r.host}]),()=>{he.ShouldClose.set(!0)}},[]);const K=()=>{H.PopUp.set({title:u?s("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):s("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:s("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(u?s("APPS.INSTAGRAM.END_LIVE_POPUP.END"):s("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE")).toLowerCase()}),buttons:[{title:s("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:u?s("APPS.INSTAGRAM.END_LIVE_POPUP.END"):s("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{F(u)}}]})},b=()=>{p("Instagram",{action:"sendLiveMessage",data:{user:{username:c.username,avatar:c.avatar,verified:c.verified},live:r.host,content:M}}),w("")},F=(C,v)=>{if(u)p("Instagram",{action:"endLive"}).then(()=>{g("feed")});else if(l&&p("Instagram",{action:"endLive"}).then(()=>{g("feed")}),p("Instagram",{action:"stopViewing",username:r.host}),C)he.ShouldClose.set(!0),se.patch({ended:!0});else{if(v===!1)return;g("feed")}};return Q("instagram:addMessage",C=>{C.live===r.host&&ee(v=>[...v,C])}),Q("instagram:updateViewers",C=>{C.username===(r==null?void 0:r.host)&&se.patch({viewers:C.viewers})}),Q("instagram:setLive",C=>{se.set(C)}),Q("instagram:liveEnded",C=>{C===(r==null?void 0:r.host)&&F(!0)}),Q("instagram:stopLive",()=>g("feed")),Q("instagram:endCall",C=>{const v=_.find(O=>O.connectionId===C);v&&(v.close(),z(O=>O.filter(W=>W.connectionId!==C)))}),Q("instagram:invitedLive",C=>{C===(r==null?void 0:r.host)&&H.PopUp.set({title:s("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:s("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:C}),buttons:[{title:s("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:s("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{I(C),E(v=>[...v,{username:c.username}])}}]})}),Q("instagram:joinedLive",C=>{C.host===(r==null?void 0:r.host)&&se.patch({participants:[...r.participants,C]})}),Q("instagram:leftLive",C=>{C.host===(r==null?void 0:r.host)&&(L("info","left live",C),se.patch({participants:r.participants.filter(v=>v.username!==C.participant)}))}),a("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":y.length.toString(),children:y.map((C,v)=>C.username===c.username?a("div",{className:"instagram-stream",children:[e("canvas",{ref:O=>{L("info","setting canvas ref",O),G(O)}}),!u&&e(ue,{onClick:()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:s("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{p("Instagram",{action:"endLive"}),t(!1)}}]})}})]}):e(ft,{host:u,stream:C.stream,username:C.username},`stream-${v}`))}),r.ended&&a("div",{className:"instagram-stream-ended",children:[e(qe,{onClick:()=>g("feed")}),e("div",{className:"title",children:s("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(Ne,{children:P&&e(vt,{username:r.host,type:P,host:P==="participants"?u||l:u,endLive:F,close:()=>k(null)})}),a("div",{className:"instagram-live",children:[a("div",{className:"live-header",children:[a("div",{className:"profile",onClick:()=>{y.length>1?k("participants"):!u&&!l&&(F(),S.fetchAndSetProfile(r.host))},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar((te=($=r==null?void 0:r.participants)==null?void 0:$[0])==null?void 0:te.avatar)})`}}),a("div",{className:"name",children:[e(ht,{usernames:r.participants.map(C=>C.username)}),((ve=(ie=r==null?void 0:r.participants)==null?void 0:ie[0])==null?void 0:ve.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(De,{})]})]}),a("div",{className:"stats",children:[e("div",{className:"live",children:s("APPS.INSTAGRAM.LIVE")}),a("div",{className:"viewers",onClick:()=>k("viewers"),children:[e("i",{className:"fas fa-eye"}),r.viewers]}),e("i",{className:"far fa-times x",onClick:()=>{u||l?K():F(!1)}})]})]}),a("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:T,children:Y.map((C,v)=>{let O=S.getAvatar(C.user.avatar);return a("div",{className:"comment",children:[e("img",{src:O}),a("div",{className:"info",children:[a("div",{className:"name",children:[C.user.username,C.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:C.content})]})]},v)})}),a("div",{className:"comment-input",children:[e(ne,{type:"text",ref:V,placeholder:s("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:C=>w(C.target.value),onKeyDown:C=>{C.key==="Enter"&&M.replace(/ /g,"").length>0&&(b(),V.current.value="")}}),e("i",{className:"far fa-paper-plane",onClick:()=>{M.replace(/ /g,"").length>0&&(b(),V.current.value="")}}),(u||l)&&e("i",{className:"fas fa-repeat",onClick:()=>{p("Instagram",{action:"flipCamera"})}})]})]})]})]})}const ft=n=>{const m=i.useRef(null);return i.useEffect(()=>{if(!(m!=null&&m.current))return L("warning","No video ref");m.current.srcObject=n.stream,m.current.play().catch(()=>L("error","Failed to play video stream"))},[n==null?void 0:n.stream]),a("div",{className:"instagram-stream",children:[n.host&&e(ue,{onClick:()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:n.username}),description:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:n.username}),buttons:[{title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{p("Instagram",{action:"removeLive",username:n.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:m})]})},ht=n=>{let m=n.usernames.map((S,o)=>S).join(", ");return m.length>9&&(m=m.substring(0,9)+"..",m[m.length-3]===","&&(m=m.substring(0,m.length-3)+"..")),e(X,{children:m})},vt=n=>{var g;const{Func:m}=i.useContext(q),S=(g=Z(se))==null?void 0:g.participants,[o,N]=i.useState([]);return i.useEffect(()=>{var c;if(n.type==="participants"){N((c=se.value)==null?void 0:c.participants);return}p("Instagram",{action:"getLiveViewers",username:n.username}).then(r=>{r&&N(r)})},[]),a(Se.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>n.close()}),e("div",{className:"title",children:n.type==="viewers"?s("APPS.INSTAGRAM.WHOS_WATCHING"):s("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:o.map((c,r)=>a("div",{className:"item",children:[a("div",{className:"user",onClick:()=>{n.host||(n.endLive(!1,!1),m.fetchAndSetProfile(c.username))},children:[e("div",{className:"profile-picture",children:e("img",{src:m.getAvatar(c.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:c.name})]})]}),n.host&&n.type==="viewers"&&(S.find(u=>u.username===c.username)?e("div",{className:"remove",onClick:u=>{u.stopPropagation(),H.PopUp.set({title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:c.username}),description:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:c.username}),buttons:[{title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{p("Instagram",{action:"removeLive",username:c.username}).then(()=>{})}}]})},children:s("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:u=>{u.stopPropagation(),p("Instagram",{action:"inviteLive",username:c.username})},children:s("APPS.INSTAGRAM.INVITE")}))]},r))})})]})};function He(n){const m=Z(oe.Settings);return e(X,{children:n.liked?e(Ee,{onClick:n.onClick,color:"#ed4956"}):e(ye,{onClick:n.onClick,color:m.display.theme==="dark"?"#ffffff":"#262626"})})}function We(n){const{Account:m,View:S,Func:o,UserPanel:N}=i.useContext(q),[g]=m,[c,r]=S,[u,f]=N,[l,t]=i.useState(n.data),P=i.useRef(null),[k,M]=i.useState(0),[w,T]=i.useState(!1),V=Z(Xe),h=Z(Ce),A={pos:{startLeft:0,startX:0},onMouseDown:I=>{le("Instagram")&&(A.pos={startLeft:P.current.scrollLeft,startX:I.clientX},P.current.style.userSelect="none",document.addEventListener("mouseup",A.onMouseUp),document.addEventListener("mousemove",A.onMove))},onMove:I=>{const d=(I.clientX-A.pos.startX)/Pe();P.current.scrollLeft=A.pos.startLeft-d;const G=P.current.getBoundingClientRect();(G.left*Pe()-5>I.clientX||I.clientX>G.right*Pe()-5)&&A.onMouseUp()},onMouseUp:()=>{P.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",A.onMouseUp),document.removeEventListener("mousemove",A.onMove);const I=JSON.parse(l.media),d=P.current.clientWidth;let G=k;const y=P.current.scrollLeft-A.pos.startLeft;y>d/2&&G<I.length-1?G++:y<-d/2&&G>0&&G--,R(G)}},R=I=>{P.current.scrollTo({left:I*P.current.offsetWidth,behavior:"smooth"}),M(I)};Q("instagram:updatePostData",I=>{if(!I||I.postId!==l.id)return L("warning","instagram:updatePostData","Post ID's do not match");t(d=>({...d,[I.data]:I.increment?d[I.data]+1:d[I.data]-1}))});const D=I=>{if(I.detail===2){if(!l.id)return;l.liked||p("Instagram",{action:"toggleLike",data:{postId:l.id,toggle:!l.liked,isComment:!1}},!l.liked).then(d=>{t(G=>({...G,liked:d})),T(!0),setTimeout(()=>T(!1),1e3)})}};return a("div",{className:"post",id:n.last?"last":"","data-id":l.id,"data-active":n.active,children:[a("div",{className:"post-header",children:[e("img",{className:"profile-picture",onClick:()=>o.fetchAndSetProfile(l.username),src:o.getAvatar(l.avatar)}),a("div",{className:"post-info",children:[a("div",{className:"name",onClick:()=>o.fetchAndSetProfile(l.username),children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),l.location&&e("div",{className:"location",children:l.location})]})]}),a("div",{className:"post-body",children:[w&&e("div",{className:"popup-heart","data-visible":w,children:e(Ee,{})}),e("div",{className:"image-container",ref:P,onMouseDown:A.onMouseDown,children:JSON.parse(l.media).map((I,d)=>{var G;return e("div",{className:"image",onClick:D,children:re(I)?e(gt,{attachment:I,active:n.active&&!(V!=null&&V.visible)&&((G=h==null?void 0:h.active)==null?void 0:G.name)==="Instagram"}):e("img",{src:I})},d)})}),a("div",{className:"actions",children:[a("div",{className:"like-comment",children:[e(He,{liked:l.liked,onClick:()=>{l.id&&p("Instagram",{action:"toggleLike",data:{postId:l.id,toggle:!l.liked,isComment:!1}},!l.liked).then(I=>{t(d=>({...d,liked:I}))})}}),e(ze,{onClick:()=>o.fetchAndSetComments({id:l.id,username:l.username,avatar:l.avatar,verified:l.verified,caption:l.caption,timestamp:l.timestamp})}),(l.username===g.username||g.isAdmin)&&e(Ye,{onClick:()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:s("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{p("Instagram",{action:"deletePost",id:l.id},!0).then(I=>{if(!I)return L("error","Instagram","Failed to delete post");r("feed")})}}]})}})]}),JSON.parse(l.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(l.media).map((I,d)=>e("div",{className:`dot ${k==d?"active":""}`,onClick:()=>R(d)},d))})]}),a("div",{className:"liked-by",onClick:()=>{f({display:!0,data:{title:s("APPS.INSTAGRAM.LIKED_BY"),postId:l.id,cb:()=>{r("feed")}}})},children:[l.like_count," ",s("APPS.INSTAGRAM.LIKES")]}),a("div",{className:"caption",children:[e("span",{className:"user",onClick:I=>{I.stopPropagation(),o.fetchAndSetProfile(l.username)},children:l.username}),Ae(l.caption)," "]}),e("div",{className:"comments",onClick:I=>{I.stopPropagation(),o.fetchAndSetComments({id:l.id,username:l.username,avatar:l.avatar,verified:l.verified,caption:l.caption,timestamp:l.timestamp})},children:l.comment_count>0?s("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:l.comment_count}):s("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:Ke(l.timestamp)})]})]})}const gt=n=>{var g;const[m,S]=i.useState(n.active),o=Z(oe.Settings),N=i.useRef(null);return i.useEffect(()=>{var c,r,u;S(n.active),!(!N.current||!((c=o==null?void 0:o.sound)!=null&&c.volume))&&n.active&&(N.current.volume=o.sound.volume,N.current.currentTime=0,n.active?(r=N.current)==null||r.play().catch(f=>{}):(u=N.current)==null||u.pause().catch(f=>{}))},[n.active]),i.useEffect(()=>{var c;!N.current||!((c=o==null?void 0:o.sound)!=null&&c.volume)||n.active&&(N.current.volume=o.sound.volume)},[(g=o==null?void 0:o.sound)==null?void 0:g.volume]),e("video",{ref:N,src:n.attachment,autoPlay:!0,loop:!0,muted:!n.active,onLoadedMetadata:c=>{n.active&&(c.currentTarget.volume=o.sound.volume)}})},j={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,following:2,followers:13,posts:2,followingList:["loaf","breze"],followerList:["loaf","breze"]},breze:{username:"breze",name:"Breze",bio:`Hey, its breze 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","loaf"],followerList:["lb","loaf"]},loaf:{username:"loaf",name:"Loaf Scripts",bio:`Loaf Scritps official account 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","breze"],followerList:["lb","breze"]}},posts:[{id:"1",username:"breze",name:"Breze",verified:!0,caption:"sunsets are the best",media:'["https://r2.fivemanage.com/images/GRBUI6C4orbD.webp", "https://r2.fivemanage.com/images/rafgjPwSYnn2.png"]',location:"Sandy Shores",like_count:2,comment_count:0,timestamp:Date.now()-1e3*60*60*24*1},{id:"2",username:"lb",name:"LB",verified:!0,caption:"dump",media:'["https://r2.fivemanage.com/images/upTPndukc2PD.webp", "https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp"]',location:"Los Santos",like_count:8,comment_count:2,timestamp:Date.now()-1e3*60*60*24*2}],stories:[{id:"1",username:"lb",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,seen:0,media:[{id:"2",image:"https://r2.fivemanage.com/images/oRKcdeTA8oBy.png",timestamp:Date.now()-1e3*60*60*4,seen:!1,views:2,viewers:[{username:"Breze"},{username:"Loaf"}]}]},{id:"2",username:"breze",verified:!0,seen:0,media:[{id:"1",image:"https://r2.fivemanage.com/images/otBLdXG7WFeu.webp",timestamp:Date.now()-1e3*60*60*2,seen:!1},{id:"2",image:"https://r2.fivemanage.com/images/ZsmnyJOA2rc5.png",timestamp:Date.now()-1e3*60*60*3,seen:!1}]},{id:"3",username:"loaf",verified:!0,seen:1,media:[{id:"1",image:"https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp",timestamp:Date.now()-1e3*60*60*3,seen:!0},{id:"2",image:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*4,seen:!0}]}],comments:[{postId:"2",user:{username:"breze",verified:!0},comment:{id:"1",content:"nice",timestamp:Date.now()-1e3*60*60*24,likes:0}},{postId:"2",user:{username:"loaf",verified:!0},comment:{id:"2",content:"haha, nice picture",timestamp:Date.now()-1e3*60*60*22,likes:1,liked:!0}}],messages:[{id:"1",username:"breze",name:"Breze",verified:!0,content:"hey",messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,content:"yoo, your last post was fire",messages:[{id:"3",sender:"loaf",content:"yoo, your last post was fire",timestamp:Date.now()-1e3*60*60*8}],timestamp:Date.now()-1e3*60*60*8}],notifications:[{type:"like_photo",username:"loaf",name:"Loaf Scripts",postId:"1",photo:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Pt(){const{Account:n,View:m,Func:S,Stories:o}=i.useContext(q),[N,g]=m,[c]=n,[r,u]=i.useState([]),[f,l]=i.useState([]),[t,P]=o,[k,M]=i.useState(null);i.useEffect(()=>{le("Instagram")&&p("Instagram",{action:"getPosts",filters:{following:!0},page:0},j.posts).then(h=>{if(!h)return L("error","Failed to fetch posts");u(h)})},[]),i.useEffect(()=>{le("Instagram")&&N==="feed"&&(p("Instagram",{action:"getLives"}).then(h=>{h&&l(h)}),p("Instagram",{action:"getStories"},j.stories).then(h=>{if(!h)return L("warning","Failed to fetch stories");P([...h.sort((A,R)=>{if(A.seen===R.seen)return 0;if(A.seen===1)return 1;if(R.seen===1)return-1})])}))},[N]),new IntersectionObserver(w,{rootMargin:"20px",threshold:.5});function w(h){h.forEach(A=>{if(A.isIntersecting){let D=A.target.getAttribute("data-id");M(D)}})}const{handleScroll:T}=ce({fetchData:h=>p("Instagram",{action:"getPosts",filters:{following:!0},page:h}),onDataFetched:h=>u([...r,...h]),perPage:25});i.useEffect(()=>{const h=document.querySelector(".stories");return h==null||h.addEventListener("wheel",A=>{A.preventDefault(),h.scrollLeft+=A.deltaY}),()=>{h==null||h.removeEventListener("wheel",A=>{A.preventDefault(),h.scrollLeft+=A.deltaY})}},[]),Q("instagram:updateLives",h=>{h&&l(h)});const V=()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:s("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{p("Instagram",{action:"goLive",user:{username:c.username,avatar:S.getAvatar(c==null?void 0:c.avatar),verified:c.verified}}).then(h=>{if(!h)return L("error","Failed to go live");se.set({host:c.username,participants:[{username:c.username,name:c.username,avatar:S.getAvatar(c==null?void 0:c.avatar),verified:c.verified}],viewers:0}),g("live")})}}]})};return a(X,{children:[a("div",{className:"instagram-header feed-header",children:[a("div",{className:"name",children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e(Fe,{onClick:()=>g("dmList")})]}),a("div",{className:"feed",onScroll:T,children:[e("div",{className:"stories-wrapper",children:a("div",{className:"stories",children:[a("div",{className:"story self",onClick:()=>{H.ContextMenu.set({buttons:[{title:s("APPS.INSTAGRAM.GO_LIVE"),cb:()=>V()},{title:s("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var h,A,R;H.Gallery.set({includeVideos:!0,allowExternal:(R=(A=(h=me)==null?void 0:h.value)==null?void 0:A.AllowExternal)==null?void 0:R.InstaPic,onSelect:D=>{p("Instagram",{action:"addToStory",media:D.src},Math.random().toString(36).substring(7)).then(I=>{if(!I)return L("error","Failed to add story");P([{username:c.username,avatar:c.avatar,verified:c.verified,seen:0,id:I},...t.filter(d=>d.username!==c.username)])})}})}}]})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(c==null?void 0:c.avatar)})`},children:e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})}),e("div",{className:"name",children:s("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(f).map(h=>{var A;return a("div",{className:"story",onClick:()=>{var R;p("Instagram",{action:"viewLive",username:((R=f[h])==null?void 0:R.participant)??h}).then(D=>{var G,y,E,_;if(!D)return L("error","Failed to view live, perhaps it ended?");let I=(G=f[h])!=null&&G.participant?f[(y=f[h])==null?void 0:y.participant]:f[h],d=(I==null?void 0:I.participants)??[];d.unshift({username:((E=f[h])==null?void 0:E.participant)??h,name:I.name,avatar:I.avatar,verified:I.verified,id:I.id}),se.set({host:((_=f[h])==null?void 0:_.participant)??h,participants:d,viewers:D}),g("live")})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar((A=f[h])==null?void 0:A.avatar)})`},children:e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"})}),e("div",{className:"name",children:h})]},h)}),t.map(h=>a("div",{className:"story",onClick:A=>{let[R,D]=Ve(A);S.fetchAndSetStory(h,null,{x:R,y:D})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(h==null?void 0:h.avatar)})`},children:e("img",{className:"circle","data-seen":h.seen===1,src:"./assets/img/icons/instagram/StoryCircle.svg"})}),e("div",{className:"name",children:h.username})]},h.username))]})}),r.length===0&&e("div",{className:"no-posts",children:s("APPS.INSTAGRAM.EMPTY_FEED")}),r.map(h=>e(We,{data:h,active:k===h.id},h.id))]})]})}function ke(){const{View:n,Account:m,LoggedIn:S}=i.useContext(q),o=Z(oe.Settings),[N,g]=i.useState(""),[c,r]=i.useState(""),[u,f]=i.useState(""),[l,t]=n,[P,k]=m,[M,w]=S,[T,V]=i.useState("login"),h=()=>{p("Instagram",{action:"logIn",username:c,password:u},{success:!!j.accounts[c],account:j.accounts[c]}).then(R=>{if(R.success&&R.account)p("isAdmin",null,!1).then(D=>{ae.APPS.INSTAGRAM.account.set(R.account),k({...R.account,isAdmin:D}),t("feed"),w(!0)});else{if(R.error)return H.PopUp.set({title:s("APPS.INSTAGRAM.ERROR"),description:s(`APPS.INSTAGRAM.${R.error}`),buttons:[{title:s("APPS.INSTAGRAM.OK")}]});L("error","Instagram LogIn Error",R.error)}})},A=()=>{let R=c.toLowerCase().replace(/\s/g,""),D=R.match(me.value.UsernameFilter);if(!D||(D==null?void 0:D[0])!==R||R.length<3||R.length>15){L("warning","Username did not match regex"),H.PopUp.set({title:s("APPS.INSTAGRAM.ERROR"),description:s("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:s("APPS.INSTAGRAM.OK")}]});return}p("Instagram",{action:"createAccount",name:N,username:R,password:u},{success:!j.accounts[R]}).then(I=>{if(I.success)p("isAdmin").then(d=>{let G={name:N,username:R,posts:0,followers:0,following:0};ae.APPS.INSTAGRAM.account.set(G),k({...G,isAdmin:d}),t("feed"),w(!0)});else{if(I.error)return H.PopUp.set({title:s("APPS.INSTAGRAM.ERROR"),description:s(`APPS.INSTAGRAM.${I.error}`),buttons:[{title:s("APPS.INSTAGRAM.OK")}]});L("error","couldn't create account",I)}})};return i.useEffect(()=>{g(""),r(""),f("")},[T]),e("div",{className:"log-in",children:a(X,{children:[e("div",{className:"wrapper",children:T==="login"?a(X,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":o.display.theme}),a("div",{className:"form",children:[e(ne,{placeholder:s("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:R=>r(R.target.value.replace(/\s/g,"")),maxLength:15},1),e(ne,{placeholder:s("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:R=>f(R.target.value),maxLength:50},3),e("div",{className:"button",onClick:h,children:s("APPS.INSTAGRAM.LOG_IN")})]})]}):a(X,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":o.display.theme}),a("div",{className:"form",children:[e(ne,{placeholder:s("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:R=>g(R.target.value),maxLength:20},2),e(ne,{placeholder:s("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:R=>r(R.target.value.replace(/\s/g,"")),maxLength:15},4),e(ne,{placeholder:s("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:R=>f(R.target.value),maxLength:50}),e("div",{className:"button",onClick:A,children:s("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:T==="login"?a(X,{children:[s("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>V("createAccount"),children:s("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):a(X,{children:[s("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>V("login"),children:s("APPS.INSTAGRAM.LOG_IN")})]})})]})})}const Ie=_e(!1);function At(){var c,r,u,f,l;const{Func:n}=i.useContext(q),m=Z(Ce),[S,o]=i.useState(null),N=Z(Ie);i.useEffect(()=>{le("Instagram")&&p("Instagram",{action:"getNotifications"},j.notifications).then(t=>{if(!t)return L("warning","Failed to fetch notifications, or no results?");o(t)})},[m==null?void 0:m.active]);const{handleScroll:g}=ce({fetchData:t=>p("Instagram",{action:"getNotifications",page:t}),onDataFetched:t=>o(P=>({...P,notifications:[...P.notifications,...t]})),perPage:25});return a("div",{className:"notifications-container",children:[e(Ne,{children:N&&e(Nt,{})}),e("div",{className:"notifications-header",children:s("APPS.INSTAGRAM.ACTIVITY")}),a("div",{className:"notifications-body",onScroll:g,children:[((c=S==null?void 0:S.requests)==null?void 0:c.total)>0&&a("div",{className:"follow-requests",onClick:()=>Ie.set(!0),children:[a("div",{className:"item-data",children:[e("div",{className:"profile-pictures","data-multiple":S.requests.total>1,children:S.requests.recent.map((t,P)=>e("img",{src:n.getAvatar(t.avatar)},P))}),a("div",{className:"item-body",children:[e("div",{className:"title",children:s("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("div",{className:"subtitle",children:S.requests.total>1?s("APPS.INSTAGRAM.ANDOTHERS").format({username:(r=S.requests.recent[0])==null?void 0:r.username,amount:((u=S.requests)==null?void 0:u.total)-1}):(f=S.requests.recent[0])==null?void 0:f.username})]})]}),a("div",{className:"actions",children:[e("div",{className:"blue-dot"}),e(Ue,{})]})]}),(l=S==null?void 0:S.notifications)==null?void 0:l.map((t,P)=>{let k=P===S.notifications.length-1?"last":"";return e(St,{notification:t,last:k},P)})]})]})}const Nt=()=>{const{Func:n}=i.useContext(q),[m,S]=i.useState(""),[o,N]=i.useState([]),g=[{class:"follow",label:s("APPS.INSTAGRAM.CONFIRM"),action:!0},{class:"following",label:s("APPS.INSTAGRAM.DELETE"),action:!1}];i.useEffect(()=>{p("Instagram",{action:"getFollowRequests",page:0},[]).then(r=>{if(!r)return L("warning","Failed to fetch follow requests");L("info","Fetched follow requests",r),N(r)})},[]);const{handleScroll:c}=ce({fetchData:r=>p("Instagram",{action:"getFollowRequests",page:r}),onDataFetched:r=>N(r),perPage:15});return a(Se.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"requests-container",children:[a("div",{className:"requests-header",children:[e("div",{className:"icon",children:e(pe,{onClick:()=>Ie.set(!1)})}),e("div",{className:"title",children:s("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("span",{})]}),a("div",{className:"requests-body",children:[e(Te,{placeholder:s("SEARCH"),onChange:r=>S(r.target.value)}),e("div",{className:"items",onScroll:c,children:o.filter(r=>r.username.toLowerCase().includes(m.toLowerCase())||r.name.toLowerCase().includes(m.toLowerCase())).map((r,u)=>a("div",{className:"item",children:[a("div",{className:"user",onClick:()=>n.fetchAndSetProfile(r.username),children:[e("img",{className:"avatar",src:n.getAvatar(r.avatar)}),a("div",{className:"user-info",children:[a("div",{className:"username",children:[r.username,r.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:r.name})]})]}),e("div",{className:"buttons",children:g.map((f,l)=>e("div",{className:Re("button",f.class),onClick:t=>{t.stopPropagation(),p("Instagram",{action:"handleFollowRequest",username:r.username,accept:f.action},!0).then(P=>{if(!P)return L("warning","Failed to handle follow request");N(k=>k.filter(M=>M.username!==r.username))})},children:f.label},l))})]},u))})]})]})},St=({notification:n,last:m})=>{const{Account:S,Func:o}=i.useContext(q),[N]=S,[g,c]=i.useState(n.isFollowing);switch(n.type){case"like_photo":return a("div",{className:"notification-item",id:m,onClick:()=>o.fetchAndSetPost(n.postId),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:u=>{u.stopPropagation(),o.fetchAndSetProfile(n.username)}}),a("div",{className:"content",children:[e("span",{children:n.username})," ",s("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:de(n.timestamp)})]})]}),re(n.photo)?e("video",{className:"post-preview",src:n.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:n.photo})]});case"like_comment":return e("div",{className:"notification-item",id:m,onClick:()=>o.fetchAndSetPost(n.postId,!0),children:a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:u=>{u.stopPropagation(),o.fetchAndSetProfile(n.username)}}),a("div",{className:"content",children:[e("span",{children:n.username})," ",s("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:n.comment}),e("span",{className:"date",children:de(n.timestamp)})]})]})});case"comment":return a("div",{className:"notification-item",id:m,onClick:()=>o.fetchAndSetPost(n.postId,!0),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:u=>{u.stopPropagation(),o.fetchAndSetProfile(n.username)}}),a("div",{className:"content",children:[e("span",{children:n.username})," ",s("APPS.INSTAGRAM.COMMENTED").format({comment:n.comment}),e("span",{className:"date",children:de(n.timestamp)})]})]}),re(n.photo)?e("video",{className:"post-preview",src:n.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:n.photo})]});case"follow":return a("div",{className:"notification-item",id:m,onClick:()=>o.fetchAndSetProfile(n.username),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:()=>o.fetchAndSetProfile(n.username)}),a("div",{className:"content",children:[e("span",{children:n.username})," ",s("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:de(n.timestamp)})]})]}),e("div",{className:`button ${g?"following":"follow"}`,onClick:u=>{u.stopPropagation(),N.username!==n.username&&(g?H.PopUp.set({title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.username}),buttons:[{title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{p("Instagram",{action:"toggleFollow",data:{username:n.username,following:!g}},!0).then(()=>{c(f=>!f)})}}]}):p("Instagram",{action:"toggleFollow",data:{username:n.username,following:!g}},!0).then(()=>{c(f=>!f)}))},children:g?s("APPS.INSTAGRAM.FOLLOWING"):s("APPS.INSTAGRAM.FOLLOW")})]})}};function pt(){var F,$,te,ie,ve,C;const{View:n,Profile:m,Account:S,Func:o,GoBack:N,Post:g,UserPanel:c,LoggedIn:r,Dm:u}=i.useContext(q),[f,l]=n,[t,P]=m,[k,M]=r,[w,T]=S,[V,h]=g,[A,R]=u,[D,I]=c,[d,G]=N,[y,E]=i.useState(!1),[_,z]=i.useState(!1),[Y,ee]=i.useState(null);i.useEffect(()=>{le("Instagram")&&t.username&&(E(w.username===t.username),p("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:0}).then(v=>{v&&ee(v)}))},[t==null?void 0:t.username]);const{handleScroll:x}=ce({fetchData:v=>p("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:v}),onDataFetched:v=>ee([...Y,...v]),perPage:15}),U=()=>{if(!t.name)return L("warning","Name is required, not saving");p("Instagram",{action:"updateProfile",data:{name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}},!0).then(v=>{if(!v)return L("warning","Failed to update profile");ae.APPS.INSTAGRAM.account.set({...w,name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}),z(!1),L("info","Successfully updated profile")})};Q("instagram:updateProfileData",v=>{v.username===t.username&&P({...t,[v.data]:v.increment?t[v.data]+1:t[v.data]-1})});const K=i.useRef(!0);i.useEffect(()=>{if(K.current){K.current=!1;return}p("Instagram",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}},!0)},[t.isFollowing]);const b=()=>{p("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(v=>{var B;if(!v)return L("info","No accounts found");let O=w.isAdmin,W=(B=v==null?void 0:v.filter(J=>J!==t.username))==null?void 0:B.map(J=>({title:J,cb:()=>{p("AccountSwitcher",{action:"switch",app:"Instagram",account:J}).then(ge=>{p("Instagram",{action:"isLoggedIn"}).then(fe=>{fe?(ae.APPS.INSTAGRAM.account.set(fe),T({...fe,isAdmin:O}),l("feed"),M(!0)):ae.APPS.INSTAGRAM.account.set(null)})})}}));H.ContextMenu.set({buttons:[{title:w.username},...W,{title:s("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>M(!1)}]})})};return e(X,{children:t&&a("div",{className:"profile",children:[e(Ne,{children:_&&a(Se.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[a("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>z(!1),children:s("CANCEL")}),e("div",{className:"title",children:s("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>U(),children:s("APPS.INSTAGRAM.DONE")})]}),a("div",{className:"edit-profile-body",children:[a("div",{className:"profile-picture",onClick:()=>{var v,O,W;H.Gallery.set({allowExternal:(W=(O=(v=me)==null?void 0:v.value)==null?void 0:O.AllowExternal)==null?void 0:W.InstaPic,onSelect:B=>{P({...t,avatar:B.src}),T({...w,avatar:B.src})}})},children:[e("img",{src:o.getAvatar(t.avatar),alt:"profile"}),e("span",{children:s("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),a("div",{className:"profile-items",children:[a("div",{className:"item",children:[e("div",{className:"title",children:s("APPS.INSTAGRAM.NAME")}),e(ne,{placeholder:s("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:v=>{P({...t,name:v.target.value})},maxLength:30,defaultValue:t.name})]}),a("div",{className:"item",children:[e("div",{className:"title",children:s("APPS.INSTAGRAM.BIO")}),e(xe,{placeholder:s("APPS.INSTAGRAM.BIO"),onChange:v=>{P({...t,bio:v.target.value})},maxLength:100,defaultValue:t.bio??""})]}),a("div",{className:"item",children:[e("div",{className:"title",children:s("APPS.INSTAGRAM.PRIVATE")}),e("div",{className:"switch-wrapper",children:e(mt,{checked:t.private,onChange:()=>P({...t,private:!t.private})})})]})]}),a("div",{className:"buttons",children:[e("div",{className:"button blue",onClick:()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{p("Instagram",{action:"signOut"},!0).then(v=>{if(!v)return L("error","Failed to sign out");M(null),T(null),ae.APPS.INSTAGRAM.account.set(null)})}}]})},children:s("APPS.INSTAGRAM.SIGN_OUT")}),((te=($=(F=me)==null?void 0:F.value)==null?void 0:$.ChangePassword)==null?void 0:te.InstaPic)&&e("div",{className:"button red",onClick:()=>je("Instagram",()=>{}),children:s("APPS.INSTAGRAM.CHANGE_PASSWORD")}),((C=(ve=(ie=me)==null?void 0:ie.value)==null?void 0:ve.DeleteAccount)==null?void 0:C.InstaPic)&&e("div",{className:"button red",onClick:()=>{Je("Instagram",()=>{M(null),T(null),ae.APPS.INSTAGRAM.account.set(null)})},children:s("APPS.INSTAGRAM.DELETE_ACCOUNT")})]})]})]})}),y?e("div",{className:"instagram-header",children:a("div",{className:"name",style:{cursor:"pointer"},onClick:()=>b(),children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(De,{})]})}):a("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{d!=null&&d.cb?d.cb():l("feed")}}),a("div",{className:"name",children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),a("div",{className:"profile-body",children:[a("div",{className:"profile-wrapper",children:[a("div",{className:"top",children:[a("div",{className:"profile-picture",style:{backgroundImage:`url(${o.getAvatar(t.avatar)})`},children:[t.isLive&&(!t.private||t.isFollowing||!y)?e("img",{onClick:()=>{p("Instagram",{action:"getLives"}).then(v=>{var W;let O=t.username;p("Instagram",{action:"viewLive",username:((W=v[O])==null?void 0:W.participant)??O}).then(B=>{var fe,we,Le,Oe;if(!B)return L("error","Failed to view live, perhaps it ended?");let J=(fe=v[O])!=null&&fe.participant?v[(we=v[O])==null?void 0:we.participant]:v[O],ge=(J==null?void 0:J.participants)??[];ge.unshift({username:((Le=v[O])==null?void 0:Le.participant)??O,name:J.name,avatar:J.avatar,verified:J.verified,id:J.id}),se.set({host:((Oe=v[O])==null?void 0:Oe.participant)??O,participants:ge,viewers:B}),l("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"}):null,t.hasStory&&!t.isLive&&(!t.private||t.isFollowing||y)?e("img",{className:"circle","data-seen":t.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.svg",onClick:v=>{let[O,W]=Ve(v);o.fetchAndSetStory({username:t.username,avatar:t.avatar,verified:t.verified},null,{x:O,y:W})}}):null]}),a("div",{className:"stats",children:[a("div",{children:[e("div",{className:"value",children:t.posts}),e("div",{className:"label",children:t.posts===1?s("APPS.INSTAGRAM.POST"):s("APPS.INSTAGRAM.POSTS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!y,onClick:()=>{!t.isFollowing&&t.private&&!y||I({display:!0,data:{title:s("APPS.INSTAGRAM.FOLLOWERS"),username:t.username,cb:()=>{P(t),l("profile"),I({display:!1})}}})},children:[e("div",{className:"value",children:t.followers}),e("div",{className:"label",children:t.followers===1?s("APPS.INSTAGRAM.FOLLOWER"):s("APPS.INSTAGRAM.FOLLOWERS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!y,onClick:()=>{!t.isFollowing&&t.private&&!y||I({display:!0,data:{title:s("APPS.INSTAGRAM.FOLLOWING"),username:t.username,cb:()=>{P(t),l("profile"),I({display:!1})}}})},children:[e("div",{className:"value",children:t.following}),e("div",{className:"label",children:s("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:t.name}),e("div",{className:"description",children:Ae(t.bio)??""}),e("div",{className:"buttons",children:y?y&&e("div",{className:"button edit",onClick:()=>z(!0),children:s("APPS.INSTAGRAM.EDIT_PROFILE")}):a(X,{children:[e("div",{className:Re("button",t.requested||t.isFollowing?"following":"follow"),onClick:()=>{t.isFollowing?H.PopUp.set({title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{P({...t,isFollowing:!1})}}]}):t.private?p("Instagram",{action:"toggleFollow",data:{username:t.username,following:!0}},!0).then(v=>{v&&P({...t,requested:!t.requested})}):P({...t,isFollowing:!0})},children:t.isFollowing?s("APPS.INSTAGRAM.FOLLOWING"):t.requested?s("APPS.INSTAGRAM.REQUESTED"):s("APPS.INSTAGRAM.FOLLOW")}),!t.private||t.isFollowing?e("div",{className:"button following",onClick:()=>{R({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),l("dm")},children:s("APPS.INSTAGRAM.MESSAGE")}):null]})})]}),t.private&&!t.isFollowing&&!y?a("div",{className:"private-account",children:[e("div",{className:"icon",children:e(Qe,{})}),e("div",{className:"title",children:s("APPS.INSTAGRAM.PRIVATE_ACCOUNT")}),e("div",{className:"description",children:s("APPS.INSTAGRAM.PRIVATE_ACCOUNT_DESCRIPTION")})]}):e("div",{className:"posts",onScroll:x,children:Y&&Y.map((v,O)=>{let W=JSON.parse(v.media)[0];return e("div",{onClick:()=>{G({cb:()=>{P(t),l("profile"),h(null),G(null)}}),h(v),l("post")},children:re(W)?e("video",{src:W,muted:!0,autoPlay:!0,loop:!0}):e("img",{src:W})},O)})})]})]})})}function It(){const{Func:n,View:m,GoBack:S,Post:o}=i.useContext(q),[N,g]=m,[c,r]=S,[u,f]=o,[l,t]=i.useState(""),[P,k]=i.useState(""),[M,w]=i.useState([]);i.useState([]);const[T,V]=i.useState([]);i.useEffect(()=>{le("Instagram")&&p("Instagram",{action:"getPosts",page:0},j.posts).then(A=>{if(!A)return L("warning","No posts received in getPosts");V(A)})},[]),i.useEffect(()=>{const A=setTimeout(()=>t(P),500);return()=>clearTimeout(A)},[P]),i.useEffect(()=>{l.length>0&&p("Instagram",{action:"search",query:l},Object.keys(j.accounts).map(A=>j.accounts[A])).then(A=>{A&&w(A)})},[l]);const{handleScroll:h}=ce({fetchData:A=>p("Instagram",{action:"getPosts",page:A}),onDataFetched:A=>V([...T,...A]),perPage:15});return a("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(Te,{placeholder:s("SEARCH"),onChange:A=>k(A.target.value)})}),e("div",{className:"search-body",onScroll:h,children:l.length>0?e("div",{className:"search-results",children:M.map(A=>a("div",{className:"item",onClick:()=>n.fetchAndSetProfile(A.username),children:[e("div",{className:"profile-picture",children:e("img",{src:n.getAvatar(A.avatar),alt:"profile"})}),a("div",{className:"user",children:[a("div",{className:"username",children:[A.username,A.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:A.name})]})]}))}):e("div",{className:"feed-grid",children:T.map((A,R)=>{let I=Math.floor(R/3)%2==0,d=!1;d=R%3==(I?1:0),T[R+1]||(d=!1);let G=JSON.parse(A.media)[0];return e("div",{className:`grid-post${d?" big":""}`,onClick:()=>{r({cb:()=>{g("search"),r(null)}}),f(A),g("post")},children:re(G)?e("video",{src:G,autoPlay:!0,loop:!0,muted:!0}):e("img",{src:G,alt:"post"})},R)})})})]})}function Et(){const{View:n,GoBack:m,Comments:S,Account:o,Func:N}=i.useContext(q),[g]=o,[c,r]=n,[u]=m,[f,l]=S,[t,P]=i.useState(""),k=i.useRef(null);i.useState(0),i.useState(!1),i.useState(!1);const M=()=>{t.length!==0&&p("Instagram",{action:"postComment",data:{postId:f.post.id,comment:t}},Math.random().toString(36).substring(7)).then(T=>{if(!T)return L("error","Failed to post comment, no ");P(""),k.current.value="",l({...f,post:f.post,comments:[{user:{username:g.username,avatar:g.avatar,verified:g.verified},comment:{id:T,content:t,timestamp:new Date().getTime(),likes:0,liked:!1}},...f.comments]})})},{handleScroll:w}=ce({fetchData:T=>p("Instagram",{action:"getComments",postId:f.post.id,page:T}),onDataFetched:T=>l({...f,comments:[...f.comments,...T]}),perPage:25});return a("div",{className:"comments-container",children:[a("div",{className:"comments-header",children:[e(pe,{onClick:()=>{u&&(u!=null&&u.cb)?u.cb():r("feed")}}),e("div",{className:"title",children:s("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),a("div",{className:"comments-body",onScroll:w,children:[a("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e("img",{src:N.getAvatar(f.post.avatar),alt:"profile"})}),a("div",{className:"post-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",children:[f.post.username,f.post.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),Ae(f.post.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:Be(f.post.timestamp)})})]})]}),f.comments.map((T,V)=>e(Ct,{data:T},V))]}),a("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e("img",{src:N.getAvatar(g.avatar),alt:"profile"})}),a("div",{className:"input-container",children:[e(ne,{type:"text",ref:k,placeholder:s("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:g.username}),onKeyPress:T=>{T.key==="Enter"&&M()},onChange:T=>P(T.target.value)}),e("div",{className:"send",onClick:M,children:s("APPS.INSTAGRAM.POST")})]})]})]})}const Ct=({data:n})=>{const{Func:m}=i.useContext(q),[S,o]=i.useState(n.comment.liked),[N,g]=i.useState(n.comment.likes);return Q("instagram:updateCommentLikes",c=>{!c||c.commentId!==n.comment.id||g(r=>r+(c.increment?1:-1))}),a("div",{className:"comment",children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:()=>m.fetchAndSetProfile(n.user.username),children:e("img",{src:m.getAvatar(n.user.avatar),alt:"profile"})}),a("div",{className:"comment-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",onClick:()=>m.fetchAndSetProfile(n.user.username),children:[n.user.username,n.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),n.comment.content]}),a("div",{className:"actions",children:[e("div",{className:"date",children:Be(n.comment.timestamp)}),a("div",{className:"likes",children:[N," ",s("APPS.INSTAGRAM.LIKES").toLowerCase()]})]})]})]}),e(He,{liked:S,onClick:()=>{n.comment.id&&p("Instagram",{action:"toggleLike",data:{postId:n.comment.id,toggle:!S,isComment:!0}},!S).then(c=>{o(c)})}})]})},Be=n=>{const m=new Date(n),o=new Date().getTime()-m.getTime(),N=Math.floor(o/(1e3*60*60*24)),g=Math.floor(o/(1e3*60*60)),c=Math.floor(o/(1e3*60));let r="";return N<1?g<1?r=`${c}m`:r=`${g}h`:N<30?r=`${N}d`:r=`${m.getDate()}/${m.getMonth()+1}/${m.getFullYear()}`,r};function Tt(){const{View:n}=i.useContext(q),[m,S]=n,[o,N]=i.useState(0),[g,c]=i.useState([]),[r,u]=i.useState(""),[f,l]=i.useState(null);return i.useEffect(()=>{var t,P,k;o===0&&H.Gallery.set({allowExternal:(k=(P=(t=me)==null?void 0:t.value)==null?void 0:P.AllowExternal)==null?void 0:k.InstaPic,multiSelect:!0,includeVideos:!0,onCancel:()=>S("feed"),onSelect:M=>{M!=null&&M.length?c(M.map(w=>w.src)):c([M.src]),N(1)}})},[o]),e("div",{className:"newpost-container","data-camera":!1,children:o===1&&a(X,{children:[a("div",{className:"newpost-header",children:[e(pe,{onClick:()=>N(0)}),e("div",{className:"title",children:s("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{p("Instagram",{action:"newPost",data:{caption:r,location:f,images:g}},!0).then(t=>{if(!t)return L("warning","Failed to post");S("feed")})},children:s("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:a("div",{className:"newpost-content",children:[a("div",{className:"caption",children:[e("div",{className:"attachments",style:{width:`calc(4rem + ${g.length*20}px)`},children:g.slice(0,5).map((t,P)=>e("div",{className:"attachment",style:{left:`${P*20}px`,top:`${P*5}px`,zIndex:P+1},children:re(t)?e(Rt,{src:t}):e("img",{src:t,alt:"image"})},P))}),e("div",{className:"text-area",children:e(xe,{onChange:t=>u(t.target.value),placeholder:s("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.CHOOSE_LOCATION.TITLE"),description:s("APPS.INSTAGRAM.CHOOSE_LOCATION.DESCRIPTION"),input:{type:"text",maxCharacters:30,onChange:t=>l(t)},buttons:[{title:s("APPS.INSTAGRAM.CHOOSE_LOCATION.CANCEL")},{title:s("APPS.INSTAGRAM.CHOOSE_LOCATION.PROCEED")}]})},children:f?a(X,{children:[a("div",{className:"label",children:[e(Ze,{}),f]}),e(ue,{onClick:t=>{t.stopPropagation(),l(null)}})]}):a(X,{children:[e("div",{className:"label",children:s("APPS.INSTAGRAM.LOCATION")}),e(Ue,{})]})})]})})]})})}const Rt=({src:n})=>{const[m,S]=i.useState(null);return a(X,{children:[e("video",{src:n,crossOrigin:"anonymous",controls:!1,onMouseOver:N=>N.currentTarget.play(),onMouseOut:N=>N.currentTarget.pause(),onLoadedMetadata:N=>S(N.currentTarget.duration)}),m&&e("div",{className:"video-duration",children:(N=>{const g=Math.floor(N/60),c=et(N-g*60,0);return`${g}:${c<10?"0"+c:c}`})(m)})]})};function wt(){const{View:n,Post:m,GoBack:S}=i.useContext(q),[o,N]=n,[g]=S,[c]=m;return e(X,{children:c&&e("div",{className:"viewpost-container",children:a(X,{children:[a("div",{className:"viewpost-header",children:[e(pe,{onClick:()=>{g&&(g.cb?g.cb():N(g.view))}}),e("div",{className:"name",children:c.username??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(We,{data:c})})]})})})}function Lt(){const{Func:n,Account:m,Dm:S,View:o,GoBack:N}=i.useContext(q);Z(oe.Settings);const[g]=m,[c,r]=o,[u,f]=S,[l,t]=N,[P,k]=i.useState([]),M=i.useRef(null),w=i.useRef(0),[T,V]=i.useState({content:"",attachments:[]}),[h,A]=i.useState(0),[R,D]=i.useState(!1),[I,d]=i.useState(!1);i.useEffect(()=>{var E;D(!1),d(!1),A(0),k([]),p("Instagram",{action:"getMessages",page:0,username:u.username},((E=j.messages.find(_=>_.username===u.username))==null?void 0:E.messages)??[]).then(_=>{_&&k(_.reverse())})},[]),Q("instagram:newMessage",E=>{if(u.username!==E.sender)return;k([...P,E]);let _=document.querySelector(".dm-body-container");_.scrollTop=_.scrollHeight});const G=()=>{T.content.length===0&&T.attachments.length===0||p("Instagram",{action:"sendMessage",username:u.username,message:{content:T.content,attachments:T.attachments.length>0?T.attachments:null}},!0).then(E=>{if(!E)return;M.current.value="",k([...P,{sender:g.username,recipient:u.username,content:T.content,attachments:T.attachments,timestamp:Date.now()}]),V({content:"",attachments:[]});let _=document.querySelector(".dm-body-container");_.scrollTop=_.scrollHeight})},{handleScroll:y}=ce({fetchData:E=>p("Instagram",{action:"getMessages",username:u.username,page:E}),onDataFetched:E=>()=>{let _=document.querySelector(".dm-body-container");w.current=_.scrollHeight,k([...E.reverse(),...P])},perPage:15});return i.useEffect(()=>{let E=document.querySelector(".dm-body-container");const _=E.scrollHeight;E.scrollTop+=_-w.current,E.scroll},[P]),a("div",{className:"dm-container",children:[a("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{l&&l.cb?(l.cb(),t(null)):r("dmList")}}),a("div",{className:"profile",onClick:E=>{E.stopPropagation(),t({cb:()=>{f(u),r("dm")}}),n.fetchAndSetProfile(u.username)},children:[e("div",{className:"avatar",children:e("img",{src:n.getAvatar(u.avatar)})}),a("div",{className:"username",children:[u.name??u.username,u.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:y,children:e("div",{className:"dm-body",children:P.map((E,_)=>{var x;let z,Y=E.sender===g.username?"self":"other",ee=((x=P[_+1])==null?void 0:x.sender)===g.username?"self":"other";return P[_+1]?z=Math.abs(E.timestamp-P[_+1].timestamp)/36e5:ee=void 0,a("div",{className:`message ${Y}`,children:[Y=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:Re("profile-picture",Y!==ee?"show":"hide"),onClick:U=>{U.stopPropagation(),t({cb:()=>{f(u),r("dm")}}),n.fetchAndSetProfile(u.username)},children:e("img",{src:n.getAvatar(u.avatar)})}),a("div",{className:"message-content",children:[E.content&&e("div",{className:"content",children:Ae(E.content)}),E.attachments&&e("div",{className:"attatchments",children:E.attachments.map((U,K)=>re(U)?e("video",{src:U,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:b=>H.FullscreenImage.set(U)},K):e(Ge,{src:U,onClick:()=>H.FullscreenImage.set(U)},K))})]})]}):a(X,{children:[E.content&&e("div",{className:"content",children:Ae(E.content)}),E.attachments&&e("div",{className:"attatchments",children:E.attachments.map((U,K)=>re(U)?e("video",{src:U,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:b=>{H.FullscreenImage.set(U)}},K):e("img",{src:U,onClick:()=>{H.FullscreenImage.set(U)}},K))})]}),P[_+1]&&z>6?e("div",{className:"date",children:be(E.timestamp)}):Y!==ee&&e("div",{className:"date",children:be(E.timestamp)})]},_)})})}),e("div",{className:"attachments",children:T.attachments.map((E,_)=>a("div",{className:"attachment",children:[re(E)?e("video",{src:E,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(Ge,{src:E}),e(ue,{onClick:()=>{V({...T,attachments:T.attachments.filter((z,Y)=>Y!==_)})}})]},_))}),a("div",{className:"dm-footer",children:[e(ne,{type:"text",ref:M,onChange:E=>{V({...T,content:E.target.value})},onKeyDown:E=>{E.key==="Enter"&&G()},placeholder:s("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),T.content.length>0?e("span",{onClick:()=>G(),className:"send",children:s("APPS.INSTAGRAM.SEND")}):e(tt,{onClick:()=>{var E,_,z;T.attachments.length<3&&H.Gallery.set({includeVideos:!0,allowExternal:(z=(_=(E=me)==null?void 0:E.value)==null?void 0:_.AllowExternal)==null?void 0:z.InstaPic,onSelect:Y=>V({...T,attachments:[...T.attachments,Y.src]})})}})]})]})}function Ot(){const{View:n,Func:m,Dm:S,Account:o,GoBack:N}=i.useContext(q),[g,c]=n,[r]=o,[u,f]=S,[l,t]=N,[P,k]=i.useState(!1),[M,w]=i.useState(""),[T,V]=i.useState(""),[h,A]=i.useState([]);i.useState([]);const[R,D]=i.useState([]);i.useEffect(()=>{le("Instagram")&&p("Instagram",{action:"getRecentMessages",page:0},j.messages).then(d=>{d&&D(d)})},[]);const{handleScroll:I}=ce({fetchData:d=>p("Instagram",{action:"getRecentMessages",page:d}),onDataFetched:d=>D([...R,...d]),perPage:25});return i.useEffect(()=>{const d=setTimeout(()=>w(T),500);return()=>clearTimeout(d)},[T]),i.useEffect(()=>{M.length>0?P?p("Instagram",{action:"search",query:M},j.messages.filter(d=>d.username!==r.username)).then(d=>{d&&A(d)}):A(R.filter(d=>{var G;return d.username.includes(M)||((G=d==null?void 0:d.name)==null?void 0:G.includes(M))&&d.username!==r.username})):A([])},[M]),i.useEffect(()=>{w(""),A([])},[P]),e("div",{className:"dm-list",children:P?a("div",{className:"slide up",children:[a("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{k(!1),A([])}}),e("div",{className:"title",children:s("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),a("div",{className:"dm-list-body ",children:[a("div",{className:"input",children:[e("span",{children:s("APPS.INSTAGRAM.TO")}),e(ne,{type:"text",onChange:d=>V(d.target.value),placeholder:s("SEARCH")})]}),h.length>0&&e("div",{className:"items",children:h.map((d,G)=>a("div",{className:"item",onClick:()=>{k(!1),f(d),c("dm")},children:[e("div",{className:"avatar",onClick:y=>{y.stopPropagation(),t({cb:()=>{c("dmList"),t(null)}}),m.fetchAndSetProfile(d.username)},children:e("img",{src:m.getAvatar(d.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[d.username,d.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:d.name})]})]},G))})]})]}):a(X,{children:[a("div",{className:"dm-list-header",children:[a("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>c("feed")}),e("i",{className:"far fa-edit",onClick:()=>k(!0)})]}),e(Te,{placeholder:s("SEARCH"),onChange:d=>V(d.target.value)})]}),e("div",{className:"dm-list-body",onScroll:I,children:e("div",{className:"items",children:M.length>0&&!P?h.map((d,G)=>{var y;return((y=d.content)==null?void 0:y.length)===0&&(d.content=s("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",onClick:()=>{k(!1),f(d),c("dm")},children:[e("div",{className:"avatar",onClick:E=>{E.stopPropagation(),t({cb:()=>{c("dmList"),t(null)}}),m.fetchAndSetProfile(d.username)},children:e("img",{src:m.getAvatar(d.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[d.name,d.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),a("div",{className:"last-message",children:[d.content.length>40?d.content.substring(0,40)+"...":d.content," • ",de(d.timestamp)]})]})]},G)}):R.map((d,G)=>(d.content.length===0&&(d.content=s("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",onClick:()=>{k(!1),f(d),c("dm")},children:[e("div",{className:"avatar",onClick:y=>{y.stopPropagation(),t({cb:()=>{c("dmList"),t(null)}}),m.fetchAndSetProfile(d.username)},children:e("img",{src:m.getAvatar(d.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[d.name,d.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),d.content.length>40?d.content.substring(0,40)+"...":d.content," • ",de(d.timestamp)]})]},G)))})})]})})}function Mt(){var _,z,Y,ee;const{Account:n,View:m,Func:S,Stories:o,Story:N,Dm:g}=i.useContext(q),[c]=n,[r,u]=m,[f,l]=o,[t,P]=N,[k,M]=g,[w,T]=i.useState(0),[V,h]=i.useState(""),[A,R]=i.useState(!1),[D,I]=i.useState({x:0,y:0});i.useEffect(()=>{if(t){I(t.origin);for(let x=0;x<t.media.length;x++)if(!t.media[x].seen)return T(x)}},[]);const d=x=>{if(A)return R(!1);const U=x.target.getBoundingClientRect(),K=x.clientX-U.left*Pe();let b=t.media[w];if(b.seen||p("Instagram",{action:"viewedStory",id:b.id}),K<U.width*Pe()/2)if(w>0)T(w-1);else{let F=f.findIndex(te=>te.username===t.username),$=f[F-1];$&&S.fetchAndSetStory($)}else if(w<t.media.length-1)T(w+1);else{let F=f.findIndex(te=>te.username===t.username),$=f[F+1];$?(y(t.username),S.fetchAndSetStory($),T(0)):E()}},G=()=>{!V||V===""||p("Instagram",{action:"sendMessage",username:t.username,message:{content:V}}).then(x=>{x&&(M({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),u("dm"),E())})},y=x=>{t.media.length===w+1&&l(U=>U.map(K=>(K.username===x&&(K.seen=1),K)))},E=x=>{x!==!1&&y(t.username),P(null)};return a(Se.div,{className:"instagram-story",initial:{scale:0,transformOrigin:t!=null&&t.origin?`${((_=t==null?void 0:t.origin)==null?void 0:_.x)??0}px ${((z=t==null?void 0:t.origin)==null?void 0:z.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:t!=null&&t.origin?`${((Y=t==null?void 0:t.origin)==null?void 0:Y.x)??0}px ${((ee=t==null?void 0:t.origin)==null?void 0:ee.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:D?`${(D==null?void 0:D.x)??0}px ${(D==null?void 0:D.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[re(t==null?void 0:t.media[w].image)?e("video",{className:"background-image",onClick:d,autoPlay:!0,loop:!0,src:t==null?void 0:t.media[w].image}):e("div",{className:"background-image",onClick:d,style:{backgroundImage:`url(${t==null?void 0:t.media[w].image})`}}),e(Ne,{children:A&&e(Gt,{activeImage:w,close:()=>R(!1)})}),a("div",{className:"story-wrapper",children:[a("div",{className:"story-header",children:[e("div",{className:"story-steps",children:t==null?void 0:t.media.map((x,U)=>e("div",{className:w===U?"active":"",onClick:()=>T(U)},U))}),a("div",{className:"profile-details",children:[a("div",{className:"profile",onClick:()=>{t!=null&&t.media[w].seen||p("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[w].id},!0).then(()=>E()),E(),S.fetchAndSetProfile(t.username)},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(t==null?void 0:t.avatar)})`}}),a("div",{className:"name",children:[t==null?void 0:t.username,!1]}),e("div",{className:"time",children:de(t==null?void 0:t.media[w].timestamp)})]}),e("div",{className:"stats",children:e(ue,{onClick:()=>{if(t!=null&&t.media[w].seen)return E();p("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[w].id},!0).then(()=>E())}})})]})]}),(t==null?void 0:t.username)===c.username?a("div",{className:"story-footer","data-stats":!0,children:[a("div",{className:"seen-by",onClick:()=>R(!0),children:[(t==null?void 0:t.media[w].viewers)&&e("div",{className:"images",children:t==null?void 0:t.media[w].viewers.map((x,U)=>e("img",{src:S.getAvatar(x.avatar)},U))}),s("APPS.INSTAGRAM.SEEN_BY").format({count:dt(t==null?void 0:t.media[w].views)??0})]}),e(ue,{onClick:()=>{H.PopUp.set({title:s("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:s("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:s("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:s("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{p("Instagram",{action:"removeFromStory",id:t==null?void 0:t.media[w].id},!0).then(x=>{if(!x)return L("error","Failed to remove image from story");L("info","Removed image from story"),P(null),t.media.length===1&&l(U=>U.filter(K=>K.username!==t.username))})}}]})}})]}):a("div",{className:"story-footer",children:[e("div",{className:"input",children:e(ne,{type:"text",placeholder:s("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:x=>h(x.target.value),onKeyDown:x=>{x.key==="Enter"&&G()}})}),e(Fe,{onClick:()=>G()})]})]})]})}const Gt=n=>{var u;const{Func:m,Story:S}=i.useContext(q),[o,N]=S,[g,c]=i.useState([]);i.useEffect(()=>{var f,l;(n==null?void 0:n.activeImage)!==void 0&&p("Instagram",{action:"getViewers",id:o==null?void 0:o.media[n.activeImage].id,page:0},(l=(f=j.stories.find(t=>t.username===o.username))==null?void 0:f.media.find(t=>t.id===o.media[n.activeImage].id))==null?void 0:l.viewers).then(t=>{if(!t)return L("warning","Failed to fetch viewers data");c(t)})},[]);const{handleScroll:r}=ce({fetchData:f=>p("Instagram",{action:"getViewers",id:o==null?void 0:o.media[n.activeImage].id,page:f}),onDataFetched:f=>c(l=>[...l,...f]),perPage:15});return a(Se.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[a("div",{className:"views",children:[e(at,{})," ",e("div",{className:"views",children:((u=o==null?void 0:o.media[n==null?void 0:n.activeImage])==null?void 0:u.views)??0})]}),e(ue,{className:"close",onClick:n==null?void 0:n.close})]}),a("div",{className:"story-modal-content",children:[e("div",{className:"title",children:s("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:r,children:g.map((f,l)=>e("div",{className:"item",children:a("div",{className:"user",onClick:()=>{m.fetchAndSetProfile(f.username),N(null)},children:[e("div",{className:"profile-picture",children:e("img",{src:m.getAvatar(f.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[f.username,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:f.name})]})]})},l))})]})]})};function bt(){const{Func:n,View:m,Account:S}=i.useContext(q),[o,N]=m,[g]=S;return e("div",{className:"instagram-footer",children:a(X,{children:[[{value:"feed",activeIcon:e(st,{}),icon:e(nt,{})},{value:"search",activeIcon:e(it,{}),icon:e(rt,{})},{value:"newPost",activeIcon:e(ct,{}),icon:e(lt,{})},{value:"notifications",activeIcon:e(Ee,{}),icon:e(ye,{})}].map((r,u)=>e("div",{onClick:()=>N(r.value),children:o===r.value?r.activeIcon:r.icon},u)),e("img",{src:n.getAvatar(g.avatar),className:"profile",alt:"profile",onClick:()=>n.fetchAndSetProfile(g.username)})]})})}function kt(){const{UserPanel:n}=i.useContext(q),[m,S]=n,[o,N]=i.useState([]);let g={[s("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[s("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[s("APPS.INSTAGRAM.LIKED_BY")]:"getLikes"};const c=(u,f)=>{var l,t;if(u!==s("APPS.INSTAGRAM.LIKED_BY")){let P=u===s("APPS.INSTAGRAM.FOLLOWING")?(l=j.accounts[f])==null?void 0:l.followingList:((t=j.accounts[f])==null?void 0:t.followerList)??[];return P==null?void 0:P.map(k=>j.accounts[k])}};i.useEffect(()=>{le("Instagram")&&p("Instagram",{action:g[m.data.title],data:{postId:m.data.postId,username:m.data.username,page:0}},c(m.data.title,m.data.username)).then(u=>{if(!u)return L("info","No data returned from instagram event");N(u)})},[]);const{handleScroll:r}=ce({fetchData:u=>p("Instagram",{action:g[m.data.title],data:{postId:m.data.postId,username:m.data.username,page:u}}),onDataFetched:u=>N([...o,...u]),perPage:25});return e(X,{children:m.data&&o&&a("div",{className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{var u;return(u=m.data)==null?void 0:u.cb()}}),e("div",{className:"userpanel-title",children:m.data.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:r,children:e("div",{className:"items",children:o.map((u,f)=>e(_t,{data:u,allData:m.data},f))})})]})})}const _t=n=>{const{Func:m,Account:S,GoBack:o,UserPanel:N}=i.useContext(q),[g]=S,[c,r]=o,[u,f]=N;let l=n.data;const[t,P]=i.useState(l.isFollowing===1);return a("div",{className:"item",onClick:()=>{r({cb:()=>{f({display:!0,data:n.allData})}}),m.fetchAndSetProfile(l.username)},children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",children:e("img",{src:m.getAvatar(l.avatar),alt:"profile"})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:l.name})]})]}),g.username!==l.username&&e("div",{className:"action",onClick:k=>{k.stopPropagation(),l.username!==g.username&&(t?H.PopUp.set({title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:l.username}),buttons:[{title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:s("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{p("Instagram",{action:"toggleFollow",data:{username:l.username,following:!t}},!0).then(()=>{P(M=>!M)})}}]}):p("Instagram",{action:"toggleFollow",data:{username:l.username,following:!t}},!0).then(()=>{P(M=>!M)}))},children:t?e("div",{className:"button following",children:s("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:s("APPS.INSTAGRAM.FOLLOW")})})]})},q=i.createContext(null);function xt(){var K;const n=Z(oe.Settings),m=(K=Z(Ce))==null?void 0:K.active,S=Z(oe.Styles.TextColor),[o,N]=i.useState("feed"),[g,c]=i.useState(null),[r,u]=i.useState(!1),[f,l]=i.useState([]),[t,P]=i.useState(null),[k,M]=i.useState(null),[w,T]=i.useState(null),[V,h]=i.useState(null),[A,R]=i.useState(null),[D,I]=i.useState(null),[d,G]=i.useState({display:!1,data:null}),[y,E]=i.useState(!0);i.useEffect(()=>{var b,F;m&&((b=m==null?void 0:m.data)==null?void 0:b.view)==="profile"&&z((F=m==null?void 0:m.data)==null?void 0:F.username)},[m]),i.useEffect(()=>{p("isAdmin",null,!1).then(b=>{if(ae.APPS.INSTAGRAM.account.value){c({...ae.APPS.INSTAGRAM.account.value,isAdmin:b}),u(!0),E(!1);return}else if(ae.APPS.INSTAGRAM.account.value===!1)return E(!1);p("Instagram",{action:"isLoggedIn"},j.account).then(F=>{F?(ae.APPS.INSTAGRAM.account.set(F),c({...F,isAdmin:b}),u(!0),E(!1)):(E(!1),ae.APPS.INSTAGRAM.account.set(null))})})},[]),i.useEffect(()=>{if(le("Instagram"))return setTimeout(()=>{o==="live"||o==="story"?(oe.Styles.TextColor.set("#fafafaed"),o=="live"&&H.IndicatorVisible.set(!1)):(oe.Styles.TextColor.set(n.display.theme==="dark"?"#fafafaed":"#000000"),H.IndicatorVisible.set(!0)),o==="dm"?he.ReceiveAppNotifications.set(!1):he.ReceiveAppNotifications.set(!0)},250),()=>{he.ReceiveAppNotifications.set(!0)}},[o]);const _=(b,F)=>{b&&p("Instagram",{action:"getPost",id:b},j.posts.find($=>$.id===b)).then($=>{if($){if(F)return Y($);R($),N("post")}})},z=b=>{var F;b&&p("Instagram",{action:"getProfile",username:b},(F=j.accounts)==null?void 0:F[b]).then($=>{if(!$)return L("warning","Failed to fetch profile data");M($),N("profile")})},Y=b=>{b.id&&p("Instagram",{action:"getComments",postId:b.id,page:0},j.comments.filter(F=>F.postId===b.id)).then(F=>{F&&(h({post:b,comments:F}),N("comments"))})},ee=(b,F,$)=>{var te;!b&&!(b!=null&&b.username)||((F==null?void 0:F.length)==0&&(F=void 0),p("Instagram",{action:"getStory",username:b.username},(te=j.stories.find(ie=>ie.username===b.username))==null?void 0:te.media).then(ie=>{if(!ie)return L("warning","Failed to fetch story data");P({username:b.username,avatar:b.avatar,verified:b.verified,media:ie,queue:F,origin:$})}))},x=b=>b||`./assets/img/avatar-placeholder-${n.display.theme}.svg`,U={feed:e(Pt,{}),search:e(It,{}),notifications:e(At,{}),profile:e(pt,{}),live:e(ut,{}),logIn:e(ke,{}),comments:e(Et,{}),post:e(wt,{}),newPost:e(Tt,{}),userpanel:e(kt,{}),dmList:e(Ot,{}),dm:e(Lt,{})};return i.useEffect(()=>{d.display&&N("userpanel")},[d]),Q("instagram:logout",b=>{if(!b)return L("warning","No username provided to logout");if(!r)return L("info","User is not logged in, cannot log out");if(b!==(g==null?void 0:g.username))return L("warning","Username provided does not match current logged in username, not logging out");c(null),u(!1),N("logIn")}),e("div",{className:"instagram-container",children:e(q.Provider,{value:{View:[o,N],Account:[g,c],Profile:[k,M],Post:[A,R],Comments:[V,h],LoggedIn:[r,u],GoBack:[D,I],UserPanel:[d,G],Dm:[w,T],Stories:[f,l],Story:[t,P],Func:{fetchAndSetProfile:z,fetchAndSetStory:ee,fetchAndSetComments:Y,fetchAndSetPost:_,getAvatar:x}},children:y||n.airplaneMode?e("div",{className:"loading",children:e(ot,{size:40,lineWeight:5,speed:2,color:S})}):e("div",{className:"instagram-wrapper",children:r?a(X,{children:[e(Ne,{children:t&&e(Mt,{})}),U[o],o!=="live"&&o!=="logIn"&&o!=="newPost"&&o!=="comments"&&!t&&e(bt,{})]}):e(ke,{})})})})}export{q as InstagramContext,xt as default};
