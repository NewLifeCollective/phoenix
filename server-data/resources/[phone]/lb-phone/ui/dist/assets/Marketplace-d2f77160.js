import{u as h,j as r,m as M,a as t,L as n,d as D,C as S,b as k,aw as V,p as f,q as R,P as C,a7 as G,bk as U,r as P,E as x,J as Y,_ as $,F as j,ah as B,w as q,S as F,bX as z,b$ as W,I as w,x as J,D as _,A as Q,h as Z,k as ee,b7 as L,f as te,i as ae,N as y,H as N}from"./index-d0bf63a9.js";import{T as se}from"./Textarea-26d983f9.js";function ne(){var u;const e=h(p),c=h(C.PhoneNumber),i=()=>{var a,l;if(!(e!=null&&e.title)||!(e!=null&&e.description)||!(e!=null&&e.price)||!(e!=null&&e.attachments)||((a=e==null?void 0:e.attachments)==null?void 0:a.length)===0){let d;switch(!0){case!(e!=null&&e.title):d=n("APPS.MARKETPLACE.ERROR_POPUP.NO_TITLE");break;case!(e!=null&&e.description):d=n("APPS.MARKETPLACE.ERROR_POPUP.NO_DESCRIPTION");break;case!(e!=null&&e.price):d=n("APPS.MARKETPLACE.ERROR_POPUP.NO_PRICE");break;case(!(e!=null&&e.attachments)||((l=e==null?void 0:e.attachments)==null?void 0:l.length)===0):d=n("APPS.MARKETPLACE.ERROR_POPUP.NO_ATTACHMENTS");break;default:d="Unknown error"}setTimeout(()=>{S.PopUp.set({title:n("APPS.MARKETPLACE.ERROR_POPUP.TITLE"),description:d,buttons:[{title:n("APPS.MARKETPLACE.ERROR_POPUP.OK")}]})},250)}else{let d={...e,number:c};f("MarketPlace",{action:"sendPost",data:d},Math.floor(Math.random()*1e3).toString()).then(m=>{if(!m)return R("warning","Failed to send post, no id could be generated");v.set([{...d,id:m},...v.value]),p.reset()})}};return r(M.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{duration:.2,ease:"easeInOut"},className:"new-post-container",children:[r("div",{className:"new-post-header",children:[t("div",{}),t("div",{className:"close",children:t("div",{onClick:()=>p.set(null)})}),t("div",{className:"post",onClick:i,children:n("APPS.MARKETPLACE.POST")})]}),r("div",{className:"new-post-body",children:[r("div",{className:"item",children:[t("div",{className:"title",children:n("APPS.MARKETPLACE.PRICE")}),t(D,{type:"number",placeholder:"0",onChange:a=>{if(!a.target.value.match(/^[0-9]*$/))return a.preventDefault();p.patch({price:parseFloat(a.target.value)})}})]}),r("div",{className:"item",children:[t("div",{className:"title",children:n("APPS.MARKETPLACE.TITLE")}),t(D,{type:"text",placeholder:"Title",maxLength:50,onChange:a=>p.patch({title:a.target.value})})]}),r("div",{className:"item",children:[t("div",{className:"title",children:n("APPS.MARKETPLACE.DESCRIPTION")}),t(se,{type:"text",placeholder:"Your post",maxLength:250,rows:5,onChange:a=>p.patch({description:a.target.value})})]}),r("div",{className:"item",children:[r("div",{className:"title",children:[" ",n("APPS.MARKETPLACE.IMAGES")]}),r("div",{className:"images",children:[(e==null?void 0:e.attachments)&&e.attachments.length>0&&e.attachments.map((a,l)=>t("div",{className:"image",style:{backgroundImage:`url(${a})`},onClick:()=>{p.patch({attachments:e.attachments.filter((d,m)=>m!==l)})}},l)),(!(e!=null&&e.attachments)||((u=e==null?void 0:e.attachments)==null?void 0:u.length)<=3)&&t("div",{className:"image",onClick:()=>{var a,l,d;S.Gallery.set({allowExternal:(d=(l=(a=k)==null?void 0:a.value)==null?void 0:l.AllowExternal)==null?void 0:d.MarketPlace,onSelect:m=>p.patch({attachments:[...(e==null?void 0:e.attachments)??[],m.src]})})},children:t(V,{})})]})]})]})]})}function ie({post:e}){const c=h(k),i=h(C.PhoneNumber),u=h(I);return t(M.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},viewport:{once:!0},transition:{duration:.2,ease:"easeInOut"},className:"post-item",onClick:()=>A.set(e),children:r("div",{className:"post-info",children:[r("div",{className:"post-header",children:[t("div",{className:"title",children:e.title}),t("div",{className:"date",children:X(e.timestamp)})]}),r("div",{className:"post-content",children:[r("div",{className:"post-text",children:[t("div",{className:"description",children:G(e.description)}),t("div",{className:"price",children:c==null?void 0:c.CurrencyFormat.replace("%s",e.price.toLocaleString())})]}),t("div",{className:"attachment",children:t("img",{src:e.attachments[0]})})]}),(i===e.number||u)&&t("div",{className:"post-footer",children:t(U,{className:"red",onClick:a=>{a.stopPropagation(),H(e.id)}})})]})})}const K={posts:[{id:"1",title:"X80 Proto",description:"X80 Proto, white with red details. Has been driven carefully and is in mint condition",number:"0601232354",attachments:["https://www.digitaltrends.com/wp-content/uploads/2020/08/grotti-x80-proto.jpg"],price:2e6,timestamp:Date.now()-1e3*60*60*2},{id:"2",title:"Banshee",description:"Selling my 2020 model Bravado Banshee, low mileage and in perfect condition. Price is negotiable.",number:"0606643134",attachments:["https://static.wikia.nocookie.net/gtawiki/images/e/ea/Penumbra-GTAV-front-Hao.png","https://static.wikia.nocookie.net/gtawiki/images/e/ea/Penumbra-GTAV-front-Hao.png"],price:74999,timestamp:Date.now()-1e3*60*60*24*2},{id:"3",title:"Sanchez, 2018 Model",description:"Selling my 2018 Sanchez. It has low mileage and is in perfect condition. Price is negotiable.",number:"0651566734",attachments:["https://static.wikia.nocookie.net/gtawiki/images/9/93/Sanchez2-GTAV-front.png","https://img.gta5-mods.com/q95/images/honda-crf-450-livery-sanchez/79a3f3-QlX0LDJLBUGUwml4_mil2w_0_0.jpg"],price:1999,timestamp:Date.now()-1e3*60*60*24*3},{id:"4",title:"Dominator",description:"Selling my 2020 model Dominator, low mileage and in perfect condition.",number:"1234567890",attachments:["https://static.wikia.nocookie.net/gtawiki/images/7/78/Dominator-GTAV-front.png","https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSMLEjCaWEavvnX3kliYe0gwrIGYljDaPb-KA&s"],price:49999,timestamp:Date.now()-1e3*60*60*24*5}]};function re(){const e=h(C.Settings),c=h(C.PhoneNumber),i=h(v),[u,a]=P.useState([]),l=h(b),[d,m]=P.useState(""),[g,T]=P.useState("");P.useEffect(()=>{x("MarketPlace")&&f("MarketPlace",{action:"getPosts",from:l==="personal_posts"?c:null},K.posts.filter(s=>l==="personal_posts"?s.number===c:!0)).then(s=>{s&&s.length>0?v.set(s):setFetchedEverything(!0)})},[l]),P.useEffect(()=>{d.length>0&&f("MarketPlace",{action:"search",from:l==="personal_posts"?c:null,query:d},K.posts.filter(s=>s.title.toLowerCase().includes(d.toLowerCase())&&(l==="personal_posts"?s.number===c:!0))).then(s=>{s&&a(s)})},[d]),P.useEffect(()=>{const s=setTimeout(()=>m(g),500);return()=>clearTimeout(s)},[g]),P.useEffect(()=>{a([]),v.set([])},[l]);const{handleScroll:o}=Y({fetchData:s=>f("MarketPlace",{action:"getPosts",from:l==="personal_posts"?c:null,page:s}),onDataFetched:s=>v.set([...i,...s]),perPage:15});return $("marketPlace:newPost",s=>{e.airplaneMode||s.number!==c&&v.set([s,...i])}),r(j,{children:[r("div",{className:"marketplace-header",children:[r("div",{className:"marketplace-header-top",children:[t("div",{className:"title",children:n("APPS.MARKETPLACE.MARKETPLACE")}),t(B,{onClick:()=>p.set({})})]}),t(q,{placeholder:n("APPS.MARKETPLACE.SEARCH"),onChange:s=>T(s.target.value)})]}),t("div",{className:"marketplace-wrapper",children:t(M.div,{...F(l==="home"?"left":"right",l,.2),className:"posts",onScroll:o,children:(d.length>0?u:i).map((s,E)=>t(ie,{post:s},s.id))})})]})}const ce=[{icon:t(z,{}),title:n("APPS.MARKETPLACE.HOME"),value:"home"},{icon:t(W,{}),title:n("APPS.MARKETPLACE.YOUR_POSTS"),value:"personal_posts"}];function oe(){const e=h(b);return t("div",{className:"marketplace-footer",children:ce.map((c,i)=>r("div",{className:"item","data-active":e===c.value,onClick:()=>b.set(c.value),children:[c.icon,c.title]},i))})}function le(){const e=h(A),c=h(k),i=h(C.PhoneNumber),u=h(I),a=P.useRef(null),[l,d]=P.useState(0),m={pos:{startLeft:0,startX:0},onMouseDown:o=>{x("MarketPlace")&&(m.pos={startLeft:a.current.scrollLeft,startX:o.clientX},a.current.style.userSelect="none",document.addEventListener("mouseup",m.onMouseUp),document.addEventListener("mousemove",m.onMove))},onMove:o=>{const s=(o.clientX-m.pos.startX)/L();a.current.scrollLeft=m.pos.startLeft-s;const E=a.current.getBoundingClientRect();(E.left*L()-5>o.clientX||o.clientX>E.right*L()-5)&&m.onMouseUp()},onMouseUp:()=>{a.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",m.onMouseUp),document.removeEventListener("mousemove",m.onMove);const o=e.attachments,s=a.current.clientWidth;let E=l;const O=a.current.scrollLeft-m.pos.startLeft;O>s/2&&E<o.length-1?E++:O<-s/2&&E>0&&E--,g(E)}},g=o=>{o<0||o>=e.attachments.length||(a.current.scrollTo({left:o*a.current.offsetWidth,behavior:"smooth"}),d(o))},T=o=>{o&&S.PopUp.set({title:n("APPS.SERVICES.CALL_POPUP.TITLE"),description:n("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:te(o)}),buttons:[{title:n("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:n("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let s=_(o);ae({...s,number:o})}}]})};return r("div",{className:"post-container",children:[t("div",{className:"marketplace-header",children:t("div",{className:"marketplace-header-top",children:r("div",{className:"back",onClick:()=>A.reset(),children:[t(w,{}),n("APPS.MARKETPLACE.HOME")]})})}),t("div",{className:"marketplace-wrapper",children:r("div",{className:"post-data",children:[r("div",{className:"attachments",children:[t("div",{className:"attachments-grid",ref:a,onMouseDown:m.onMouseDown,children:e.attachments&&e.attachments.map((o,s)=>t("div",{className:"image",children:t("img",{src:o})},s))}),r("div",{className:"arrows",children:[t("div",{className:"arrow","data-disabled":l===0,children:t(w,{onClick:()=>g(l-1)})}),t("div",{className:"arrow","data-disabled":l===e.attachments.length-1,children:t(J,{onClick:()=>g(l+1)})})]}),t("div",{className:"count",children:n("APPS.MARKETPLACE.AMOUNT_OF_TOTAL").format({amount:l+1,total:e.attachments.length})})]}),r("div",{className:"post-content",children:[t("div",{className:"date",children:X(e.timestamp)}),t("div",{className:"title",children:e.title}),t("div",{className:"price",children:c.CurrencyFormat.replace("%s",e.price.toLocaleString())}),t("div",{className:"description",children:e.description}),r("div",{className:"buttons",children:[r("div",{className:"button green",onClick:()=>{let o=_(e.number);Q.patch({active:{name:"Messages",data:{number:e.number,name:o==null?void 0:o.name,avatar:o==null?void 0:o.avatar,view:"messages"}}})},children:[t(Z,{}),n("APPS.MARKETPLACE.MESSAGE")]}),r("div",{className:"button blue",onClick:()=>T(e.number),children:[t(ee,{}),n("APPS.MARKETPLACE.CALL")]}),(i===e.number||u)&&r("div",{className:"button red",onClick:()=>H(e.id),children:[t(U,{}),n("APPS.MARKETPLACE.REMOVE")]})]})]})]})})]})}const b=N("home"),I=N(!1),v=N([]),A=N(null),p=N(null);function he(){const e=h(A),c=h(p);return P.useEffect(()=>{f("isAdmin").then(i=>I.set(i))},[]),r("div",{className:"marketplace-container",children:[r(M.div,{...F(e?"right":"left",e?"post":"home",.2),className:"marketplace-canister",children:[t(re,{}),t(y,{children:e&&t(le,{})}),t(oe,{})]}),t(y,{children:c&&t(ne,{})})]})}const H=e=>{if(!e)return R("error","No id provided to delete post");S.PopUp.set({title:n("APPS.MARKETPLACE.DELETE_POPUP.TITLE"),description:n("APPS.MARKETPLACE.DELETE_POPUP.TEXT"),buttons:[{title:n("APPS.MARKETPLACE.DELETE_POPUP.CANCEL")},{title:n("APPS.MARKETPLACE.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{f("MarketPlace",{action:"deletePost",id:e},!0).then(c=>{if(!c)return R("error","Failed to delete post");v.set(v.value.filter(i=>i.id!==e)),A!=null&&A.value&&A.reset()})}}]})},X=e=>{const c=new Date,i=new Date(e);if(c.getFullYear()===i.getFullYear()&&c.getMonth()===i.getMonth()){let u=i.getHours()<10?`0${i.getHours()}`:i.getHours(),a=i.getMinutes()<10?`0${i.getMinutes()}`:i.getMinutes();return c.getDate()===i.getDate()?n("MISC.TODAY_TIME").format({hours:u,minutes:a}):c.getDate()-1===i.getDate()?n("MISC.YESTERDAY_TIME").format({hours:u,minutes:a}):`${i.toLocaleString("default",{month:"long"})} ${i.getDate()}th, ${i.getFullYear()}`}};export{A as ActivePost,I as IsAdmin,p as NewPost,v as Posts,b as View,he as default,H as deletePost,X as formatDate};
