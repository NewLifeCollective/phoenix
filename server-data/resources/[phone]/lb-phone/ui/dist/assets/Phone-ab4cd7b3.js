import{r as c,u as S,j as i,m as U,S as G,a as t,I as Oe,L as a,F as R,C as H,b as oe,P as b,g as W,c as se,d as F,e as K,f as V,A as J,h as Ce,i as Y,k as de,l as pe,n as Se,o as re,p as k,q as I,s as w,t as ce,v as he,w as Te,x as ge,y as be,z as Ee,B as Le,D as le,E as me,G as ye,H as ue,M as Pe,J as fe,K as Ie,N as ke,O as He,Q as _e,R as we,T as Re,U as Ue,V as Me,W as De,X as Ve}from"./index-d0bf63a9.js";function xe(){const{View:l,Contact:h}=c.useContext(z),n=S(b.Settings),v=S(b.PhoneNumber),[P,f]=c.useState(null),[u,A]=l,[e,r]=h,N=S(w.APPS.PHONE.contacts),[E,m]=c.useState(!1),[C,g]=c.useState(!1);c.useEffect(()=>f(e.number),[]);const O=()=>{k("Phone",{action:"removeContact",number:e.number},!0).then(o=>{if(!o)return I("warning","Failed to remove contact");w.APPS.PHONE.contacts.set(N.filter(s=>s.number!==e.number)),r(null),A("Contacts")})},_=()=>{k("Phone",{action:"toggleBlock",number:e.number,blocked:!e.blocked},!0).then(o=>{if(o===void 0)return I("warning","Failed to toggle block");r({...e,blocked:!e.blocked}),w.APPS.PHONE.contacts.set(N.map(s=>s.number===e.number?{...s,blocked:!s.blocked}:s))})},y=()=>{k("Phone",{action:"toggleFavourite",number:e.number,favourite:!e.favourite},!0).then(o=>{if(!o)return I("warning","Failed to toggle favourite");r({...e,favourite:!e.favourite}),w.APPS.PHONE.contacts.set(N.map(s=>s.number===e.number?{...s,favourite:!s.favourite}:s))})},B=()=>{if(!e.number||e.number.length===0)return A("Contacts");e.number===v?(b.Settings.patch({name:e.firstname,avatar:e.avatar??n.avatar,address:e.address,email:e.email}),k("setPhoneName",e.firstname),k("setSettings",b.Settings.value),m(o=>!o),w.APPS.PHONE.contacts.set(N.map(o=>o.number===e.number?{...o,...e}:o))):(e.lastname=e.lastname??"",k("Phone",{action:"updateContact",data:{...e,oldNumber:P}},!0).then(o=>{if(!o)return I("warning","Failed to update contact");w.APPS.PHONE.contacts.set(N.map(s=>s.number===P?{...s,...e}:s)),m(s=>!s),f(e.number)}))},X=()=>{e&&H.PopUp.set({title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{k("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(o=>{o&&k("Messages",{action:"sendMessage",number:e.number,content:`<!SENT-LOCATION-X=${ce(o.x,2)}Y=${ce(o.y,2)}!>`,attachments:[]}).then(s=>{if(!s)return I("warning","something went wrong while sending location");J.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&K(e.firstname,e.lastname),avatar:e.avatar},view:"messages"}})})})}}]})},$=c.useRef(!0);return c.useEffect(()=>{$.current&&$.current&&(f(e.number),$.current=!1,g(e.number===v))},[e]),i(U.div,{...G("right","contact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[E?t("span",{}):i("div",{className:"back",onClick:()=>{A(e.from),r(null)},children:[t(Oe,{}),a(`APPS.PHONE.${e.from.toUpperCase()}.TITLE`)]}),e.firstname&&!e.company&&t("span",{onClick:()=>{E?B():m(o=>!o)},children:E?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:E?t(R,{children:i("div",{className:"contact nohover",children:[i("div",{className:"user",onClick:()=>{H.ContextMenu.set({buttons:[{title:a("APPS.PHONE.CONTACTS.CHANGE_AVATAR"),cb:()=>{var o,s,L;H.Gallery.set({allowExternal:(L=(s=(o=oe)==null?void 0:o.value)==null?void 0:s.AllowExternal)==null?void 0:L.Other,onSelect:p=>r({...e,avatar:p.src})})}},{title:a("APPS.PHONE.CONTACTS.REMOVE_AVATAR"),color:"red",cb:()=>{r({...e,avatar:null}),C&&b.Settings.set({...b.Settings.value,avatar:null})}}]})},children:[e.avatar||C&&n.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${e.avatar??n.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:W(e.firstname,e.lastname)}):t(se,{}),t("span",{children:a("APPS.PHONE.EDIT")})]}),i("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),value:e.firstname,onChange:o=>r({...e,firstname:o.target.value}),maxLength:20})}),!C&&t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),value:e.lastname??"",onChange:o=>r({...e,lastname:o.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(F,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:e==null?void 0:e.number,maxLength:20,disabled:C,onChange:o=>{if(C)return;let s=o.target.value.slice(-1).charCodeAt(0);s>=48&&s<=57&&o.target.value.length<=10&&r({...e,number:o.target.value})}})})}),i("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{className:"phone_number",type:"email",placeholder:a("APPS.PHONE.CONTACTS.EMAIL"),defaultValue:C?n==null?void 0:n.email:e==null?void 0:e.email,maxLength:20,onChange:o=>{o.target.value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&(C?b.Settings.set({...b.Settings.value,email:o.target.value}):r({...e,email:o.target.value}))}})}),t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.ADDRESS"),defaultValue:C?n==null?void 0:n.address:e==null?void 0:e.address,maxLength:20,onChange:o=>{C?b.Settings.set({...b.Settings.value,address:o.target.value}):r({...e,address:o.target.value})}})})]}),!C&&t("div",{className:"contact-info",children:t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:O}]})},children:a("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):t(R,{children:i("div",{className:"contact nohover details",children:[i("div",{className:"user",children:[e.avatar||C&&n.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${C?n.avatar:e.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:W(e.firstname,e.lastname)}):t(se,{}),t("div",{className:"name",children:e.firstname?K(e.firstname,e.lastname):V(e.number)})]}),i("div",{className:"actions",children:[i("div",{className:"item","data-disabled":!!(C||e.company),onClick:()=>{J.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&K(e.firstname,e.lastname),avatar:e.avatar,view:"messages"}}})},children:[t(Ce,{}),a("APPS.PHONE.CONTACTS.MESSAGE")]}),i("div",{className:"item call","data-disabled":C,onClick:()=>{Y({number:e.number,company:e.company,companylabel:e.company&&e.firstname})},children:[t(de,{}),a("APPS.PHONE.CONTACTS.CALL")]}),i("div",{className:"item","data-disabled":!!(C||e.company),onClick:()=>{Y({number:e.number,company:e.company,companylabel:e.company&&e.firstname,videoCall:!0})},children:[t(pe,{}),a("APPS.PHONE.CONTACTS.VIDEO")]}),i("div",{className:"item","data-disabled":!!e.company,onClick:()=>{e.company||H.Share.set({type:"contact",data:{number:e.number,firstname:e.firstname,lastname:e.lastname,avatar:e.avatar||C&&n.avatar,email:e.email,address:e.address}})},children:[t(Se,{}),a("APPS.PHONE.CONTACTS.SHARE")]})]}),!e.company&&i(R,{children:[t("div",{className:"contact-info",children:t("div",{className:"item",onClick:()=>{re(e.number),H.PopUp.set({title:a("COMPONENTS.SHARE.COPY_POPUP.TITLE"),description:a("COMPONENTS.SHARE.COPY_POPUP.DESCRIPTION"),buttons:[{title:a("COMPONENTS.SHARE.COPY_POPUP.OK")}]})},children:t("div",{className:"value",children:V(e.number)})})}),(e.email||e.address)&&i("div",{className:"contact-info",children:[e.email&&i("div",{className:"item",onClick:()=>re(e.email),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.EMAIL").toLowerCase()}),t("div",{className:"value",children:e.email})]}),e.address&&i("div",{className:"item",onClick:()=>re(e.address),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.ADDRESS").toLowerCase()}),t("div",{className:"value",children:e.address})]})]}),t("div",{className:"contact-info",children:e.firstname?t(R,{children:!C&&i(R,{children:[t("div",{className:"item",onClick:()=>X(),children:a("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),e.favourite?t("div",{className:"item red",onClick:()=>y(),children:a("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):t("div",{className:"item",onClick:()=>y(),children:a("APPS.PHONE.CONTACTS.ADD_FAVORITE")}),e.blocked?t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:V(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>_()}]})},children:a("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:V(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{_()}}]})},children:a("APPS.PHONE.CONTACTS.BLOCK_CALLER")})]})}):t("div",{className:"item",onClick:()=>A("NewContact"),children:a("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})]})})})]})}function Fe(){const{View:l,viewContact:h}=c.useContext(z),n=S(b.Settings),[v,P]=l,f=S(b.PhoneNumber),u=S(w.APPS.PHONE.contacts),[A,e]=c.useState("");return i(U.div,{...G("left","contacts",.2),className:"animation-container",children:[i("div",{className:"contacts-header",children:[i("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.TITLE")}),t(he,{onClick:()=>P("NewContact")})]}),t(Te,{placeholder:a("SEARCH"),onChange:r=>e(r.target.value)})]}),t("div",{className:"content",children:i("div",{className:"contact-list",children:[t("div",{className:"letters",children:[...Array(26)].map((r,N)=>{let E=String.fromCharCode(N+65);return t("a",{children:E},N)})}),t("div",{className:"contact card",onClick:()=>h({firstname:n==null?void 0:n.name,number:f},"Contacts"),children:i("div",{className:"profile",children:[n.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${n.avatar})`}}):t("div",{className:"avatar",children:W(n==null?void 0:n.name)}),i("div",{className:"profile-info",children:[t("div",{className:"name",children:n==null?void 0:n.name}),t("div",{className:"info",children:a("APPS.PHONE.CONTACTS.MY_CARD")})]}),t(ge,{})]})}),u&&i(R,{children:[Object.entries(u.filter(r=>K(r.firstname,r.lastname).toLowerCase().includes(A.toLowerCase())).sort((r,N)=>r.firstname.localeCompare(N.firstname)).reduce((r,N)=>{let E=N.firstname.charAt(0).toUpperCase();return r[E]||(r[E]=[]),r[E].push(N),r},{})).map(([r,N],E)=>i("div",{children:[t("div",{id:r,className:`divider ${E===0?"no-border":""}`,children:r}),t(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"contacts",children:N.map((m,C)=>i("div",{className:"contact item border",onClick:()=>h(m,"Contacts"),children:[m.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${m.avatar})`}}):t("div",{className:"avatar",children:W(m.firstname,m.lastname)}),i("div",{className:"details",children:[t("div",{className:"name",children:K(m.firstname,m.lastname)}),t("div",{className:"phone-number",children:V(m.number)})]})]},C))})]},E)),i("div",{className:"total-contacts",children:[u.length," ",a("APPS.PHONE.CONTACTS.TITLE")]})]})]})})]})}function Be(){const{viewContact:l}=c.useContext(z),h=S(w.APPS.PHONE.contacts),[n,v]=c.useState(!1);return i(U.div,{...G("left","favourites",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.FAVOURITES.TITLE")}),t("span",{onClick:()=>v(!n),children:n?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:t("div",{className:"favourite",children:h.filter(P=>P.favourite||P.company).sort((P,f)=>P.company?-1:1).map((P,f)=>{let u=K(P.firstname,P.lastname);return i(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:u}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:u}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{Y({number:P.number,company:P.company,companylabel:P.firstname})}}]})},children:[i("div",{className:"user",children:[n&&!P.company&&t(be,{onClick:A=>{A.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:a("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{k("Phone",{action:"toggleFavourite",number:P.number,favourite:!1},!0).then(e=>{if(!e)return I("warning","Failed to remove favourite");w.APPS.PHONE.contacts.set(h.map(r=>r.number===P.number?{...r,favourite:!r.favourite}:r))})}}]})}}),P.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${P.avatar})`}}):t("div",{className:"avatar",children:W(P.firstname,P.lastname)}),i("div",{className:"info",children:[u,t("span",{children:V(P.number)})]})]}),t(Ee,{onClick:A=>{A.stopPropagation(),l(P,"Favourites")}})]},f)})})})]})}const M=[697,770,852,941],D=[1209,1336,1477,1633],Ne={1:[M[0],D[0]],2:[M[0],D[1]],3:[M[0],D[2]],4:[M[1],D[0]],5:[M[1],D[1]],6:[M[1],D[2]],7:[M[2],D[0]],8:[M[2],D[1]],9:[M[2],D[2]],"*":[M[3],D[0]],0:[M[3],D[1]],"#":[M[3],D[2]]},$e=[{key:"1",letters:""},{key:"2",letters:"ABC"},{key:"3",letters:"DEF"},{key:"4",letters:"GHI"},{key:"5",letters:"JKL"},{key:"6",letters:"MNO"},{key:"7",letters:"PQRS"},{key:"8",letters:"TUV"},{key:"9",letters:"WXYZ"},{key:"*",letters:""},{key:"0",letters:"+"},{key:"#",letters:""}],ae={0:2.5,12:2,17:1.75};function Ke(){const l=S(b.Settings),h=S(b.CallData),n=S(J),{View:v,Contact:P,viewContact:f}=c.useContext(z),[u,A]=v,[e,r]=P,[N,E]=c.useState(null),[m,C]=c.useState(""),g=c.useRef(null),O=c.useRef([]),_=c.useRef(null),y=c.useRef(null),B=c.useRef(!0),[X,$]=c.useState(2.5);c.useEffect(()=>{var d;if(!g.current&&((d=n==null?void 0:n.active)==null?void 0:d.name)==="Phone")return g.current=new AudioContext,()=>{g.current&&(s(),g.current.close(),g.current=null)}},[n==null?void 0:n.active]),c.useEffect(()=>{var d;B.current=!!(((d=n==null?void 0:n.active)==null?void 0:d.name)==="Phone"&&(!h||h!=null&&h.banner))},[n==null?void 0:n.active,h]),c.useEffect(()=>{document.addEventListener("keydown",p),document.addEventListener("keyup",x),m==="0"&&$(2.5);let d=0;for(let T=0;T<Object.keys(ae).length;T++)m.length>=parseInt(Object.keys(ae)[T])&&(d=ae[Object.keys(ae)[T]]);return $(d),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",x)}},[m]);const o=d=>{if(!g.current)return;const T=g.current,[Q,j]=Ne[d],ie="sine",Z=T.createOscillator();Z.frequency.value=Q,Z.type=ie;const ee=T.createOscillator();ee.frequency.value=j,ee.type=ie;const te=T.createGain();te.gain.value=.2*(l.sound.volume??.5),Z.connect(te),ee.connect(te),te.connect(T.destination),Z.start(),ee.start();const Ae=setTimeout(()=>{s()},1500);O.current.push([Z,ee,te,Ae])},s=()=>{O.current.forEach(([d,T,Q,j])=>{clearTimeout(j),g.current&&(d.stop(),T.stop(),d.disconnect(),T.disconnect(),Q.disconnect())}),_.current=null,O.current=[]},L=d=>{B.current&&(d=="delete"?C(T=>T.slice(0,-1)):d.match(/^[0-9]+$/)&&C(T=>T+d),Ne[d]&&(_.current&&s(),_.current=d,o(d)))},p=d=>{_.current||d.repeat||(d.key.match(/^[0-9]+$/)?(_.current=d.key,L(d.key)):d.key==="Backspace"?L("delete"):d.key==="Enter"&&m.length>=3&&Y({number:m}))},x=d=>{d.key===_.current&&s()};return c.useEffect(()=>{if(m.length!==Le())return E(null);E(le(m))},[m]),i(U.div,{...G("left","keypad",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.KEYPAD.TITLE")}),t(he,{onClick:()=>{if(C(""),N)f(N,"Keypad");else{let d=le(m);d?(r({...d,number:m}),A("NewContact")):(r({number:m}),A("NewContact"))}}})]})}),t("div",{className:"content noscroll",children:i("div",{className:"keypad-container",children:[t("div",{className:"inputbox",children:t("div",{className:"input",style:{fontSize:`${X}rem`},children:V(m)})}),t("div",{className:"keypad-wrapper",children:i("div",{className:"keypad",children:[$e.map(d=>i("div",{onMouseDown:()=>L(d.key),onMouseUp:()=>s(),children:[d.key,d.letters&&t("span",{children:d.letters})]},d.key)),t("span",{}),t("div",{className:"call",onClick:()=>{m.length>=3&&Y({number:m})},children:t(de,{})}),t("div",{className:"delete",onMouseDown:()=>{if(!me("Phone"))return;L("delete"),y.current&&clearInterval(y.current);const d=setInterval(()=>{L("delete")},100);y.current=d},onMouseUp:()=>{y.current&&(clearInterval(y.current),y.current=null)},children:t(ye,{})})]})})]})})]})}function Ge(){const{View:l,Contact:h}=c.useContext(z),n=S(b.PhoneNumber),[v]=h,[P,f]=l,u=S(w.APPS.PHONE.contacts),A=S(b.Settings),[e,r]=c.useState(null),[N,E]=c.useState(!1);c.useEffect(()=>{b.Styles.TextColor.set(A.display.theme=="dark"?"#ffffff":"#000000")},[]),c.useEffect(()=>{v&&v.number&&r({...e,number:v.number})},[v]),c.useEffect(()=>{e&&E(e.firstname&&e.number!==void 0)},[e]);const m=()=>{if(e){if(!e.number||(e==null?void 0:e.number)===n)return f("Contacts");e.lastname=(e==null?void 0:e.lastname)??"",k("Phone",{action:"saveContact",data:e},!0).then(C=>{if(!C)return I("warning","Failed to save contact");w.APPS.PHONE.contacts.set([...u,e]),f("Contacts")})}};return i(U.div,{...G("up","newcontact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items",children:[t("div",{className:"back",onClick:()=>f("Contacts"),children:a("APPS.PHONE.CANCEL")}),t("span",{className:N?"":"disabled",onClick:()=>{N&&m()},children:a("APPS.PHONE.DONE")})]})}),t("div",{className:"content",children:t(R,{children:i("div",{className:"contact nohover",children:[t("div",{className:"user",onClick:()=>{var C,g,O;H.Gallery.set({allowExternal:(O=(g=(C=oe)==null?void 0:C.value)==null?void 0:g.AllowExternal)==null?void 0:O.Other,onSelect:_=>r({...e,avatar:_.src})})},children:e!=null&&e.avatar?i(R,{children:[t("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${e.avatar})`}}),t("span",{children:a("APPS.PHONE.EDIT")})]}):i(R,{children:[t(se,{className:"big"}),t("span",{className:"add",children:a("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),i("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:C=>r({...e,firstname:C.target.value}),maxLength:20})}),t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:C=>r({...e,lastname:C.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(F,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:v==null?void 0:v.number,maxLength:15,onChange:C=>{let g=C.target.value.slice(-1).charCodeAt(0);g>=48&&g<=57&&r({...e,number:C.target.value})}})})})]})})})]})}const ne=ue([]).mock(Pe.RecentCalls);function Xe(){const{viewContact:l}=c.useContext(z),[h,n]=c.useState("all"),v=S(ne),P=["all","missed"];c.useEffect(()=>{k("Phone",{action:"getRecent",page:0,missed:h==="missed"},Pe.RecentCalls.filter(u=>h==="missed"?!u.answered:!0)).then(u=>{if(!u)return I("error","Failed to get recent calls");ne.set(u)})},[h]);const{handleScroll:f}=fe({fetchData:u=>k("Phone",{action:"getRecent",missed:h==="missed",page:u}),onDataFetched:u=>ne.set([...ne.value,...u]),perPage:25});return i(U.div,{...G("left","recent",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:i("div",{className:"items col",children:[t("div",{className:"selector-container",children:t("div",{className:"selector",children:P.map((u,A)=>t("div",{className:"option","data-active":h===u,onClick:()=>n(u),children:a(`APPS.PHONE.RECENTS.${u.toUpperCase()}`)},A))})}),t("div",{className:"title",children:a("APPS.PHONE.RECENTS.TITLE")})]})}),t("div",{className:"content",onScroll:f,children:t(U.div,{...G(h==="all"?"left":"right",h,.2),className:"recent-calls",children:v.map((u,A)=>{var r,N,E;let e=le(u.number);return i(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item","data-missed":!u.called&&!u.answered?"true":"false",onClick:()=>{if(u.hideCallerId)return;let m;e!=null&&e.name?m=e.name:m=V(u.number),H.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:m}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:m}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{Y({number:u.number})}}]})},children:[i("div",{className:"user",children:[u.hideCallerId?t("div",{className:"avatar",style:{backgroundImage:`url(./assets/img/avatar-placeholder-${(E=(N=(r=b)==null?void 0:r.Settings)==null?void 0:N.value)==null?void 0:E.display.theme}.svg)`}}):e!=null&&e.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${e==null?void 0:e.avatar})`}}):t("div",{className:"avatar",children:W(e==null?void 0:e.name)}),t("div",{className:"info",children:u.hideCallerId?i(R,{children:[a("APPS.PHONE.CALL.NO_CALLER_ID"),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]}):e!=null&&e.name?i(R,{children:[e.name,t("span",{children:V(u.number)})]}):i(R,{children:[V(u.number),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]})})]}),i("div",{className:"info",children:[t("div",{className:"date",children:Ie(u.timestamp)}),t(Ee,{onClick:m=>{if(m.stopPropagation(),u.hideCallerId)return I("info","Call info couldn't be loaded since user called with 'No Caller ID'");e!=null&&e.name?l({...e,number:u.number},"Recents"):l({...u},"Recents")}})]})]},A)})})})]})}const ve=ue(null),q=ue([]);function je(){const l=S(q);c.useEffect(()=>{me("Phone")&&k("Phone",{action:"getVoiceMails",page:0},Pe.VoiceMails).then(n=>{if(!n)return I("error","Failed to get voicemails");I("info","Received voicemails",n),q.set(n)})},[]);const{handleScroll:h}=fe({fetchData:n=>k("Phone",{action:"getVoiceMails",page:n}),onDataFetched:n=>q.set([...q.value,...n]),perPage:25});return i(U.div,{...G("left","voicemail",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:t("div",{className:"items",children:t("div",{className:"title",children:a("APPS.PHONE.VOICEMAIL.TITLE")})})}),t("div",{className:"content",onScroll:h,children:t("div",{className:"voicemails",children:l.map(n=>t(Ye,{data:n},n.id))})})]})}const Ye=({data:l})=>{const h=S(oe),n=S(b.Settings),v=c.useRef(null),[P,f]=c.useState(!1),[u,A]=c.useState(!1),[e,r]=c.useState(!1),[N,E]=c.useState(null),[m,C]=c.useState(0),g=S(ve),[O,_]=c.useState(null),y=S(Re),B=S(J);c.useEffect(()=>{var s;y!=null&&y.visible&&((s=v.current)==null||s.pause(),r(!1))},[y==null?void 0:y.visible,B==null?void 0:B.active]),c.useEffect(()=>{var L;v.current=new Audio(l.url),v.current.src=l.url,v.current.volume=n.sound.volume??.5,v.current.addEventListener("ended",()=>{r(!1)}),v.current.addEventListener("timeupdate",()=>{C(v.current.currentTime)});let s=(L=w.APPS.PHONE.contacts)==null?void 0:L.value;if(s&&l.number){let p=s.find(x=>x.number==l.number);p&&_(p)}return()=>{var p,x;(p=v.current)==null||p.pause(),(x=v.current)==null||x.remove(),v.current=null}},[]),c.useEffect(()=>{var s;g&&g!==l.id&&((s=v.current)==null||s.pause(),r(!1),f(!1))},[g]),c.useEffect(()=>{n.sound.volume&&(v.current.volume=n.sound.volume)},[n.sound.volume]),c.useEffect(()=>{var s;r(!1),C(0),(s=v.current)==null||s.pause(),v.current.currentTime=0,P&&ve.set(l.id)},[P]);const X=s=>{s=s/1e3;const L=Math.floor(s/60),p=ce(s-L*60,0);return`${L}:${p<10?"0"+p:p}`},$=(s,L)=>{const p=new Date(s),x=p.getFullYear(),d=p.getMonth()+1,T=p.getDate(),Q=p.getHours(),j=p.getMinutes();return L?`${T} ${p.toLocaleDateString(h.DateLocale,{month:"long"})} ${x} ${a("APPS.PHONE.VOICEMAIL.AT")} ${Q}:${j<10?"0"+j:j}`:`${x}-${d<10?"0"+d:d}-${T<10?"0"+T:T}`},o={light:{active:"#333333",track:"#cccccc"},dark:{active:"#FFFFFF",track:"#999999"}};return t(U.div,{className:"voicemail-item",initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},onClick:()=>f(!P),"data-expanded":P,children:i("div",{className:"voicemail-info",children:[i("div",{className:"voicemail-row",children:[i("div",{className:"details",children:[t("div",{className:"voicemail-title",children:l.hideCallerId?a("APPS.PHONE.CALL.NO_CALLER_ID"):O?K(O==null?void 0:O.firstname,O==null?void 0:O.lastname):V(l.number)}),t("div",{className:"subtitle",children:$(l.timestamp,!0)})]}),!P&&t("div",{className:"info",children:t("div",{className:"duration",children:X(l.duration)})})]}),t(ke,{children:P&&i(U.div,{className:"voicemail-actions",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[i("div",{className:"voicemail-duration-slider",onClick:s=>s.stopPropagation(),children:[t(F,{type:"range",min:0,max:100,value:N||m/l.duration*100,style:{background:`linear-gradient(to right, ${o[n.display.theme].active} 0%, ${o[n.display.theme].active} ${N||m/(l.duration/1e3)*100}%, ${o[n.display.theme].track} ${N||m/(l.duration/1e3)*100}%, ${o[n.display.theme].track} 100%)`},onMouseDown:s=>{me("Phone")&&(s.stopPropagation(),A(!0))},onMouseUp:s=>{if(s.stopPropagation(),A(!1),N){if(!v.current)return I("warning","Audio ref is null");v.current.currentTime=l.duration/1e3/100*N,E(null)}},onChange:s=>{s.stopPropagation(),E(s.target.value)}}),i("div",{className:"duration",children:[t("div",{children:X(m)??"0:00"}),t("div",{children:X(l.duration)})]})]}),i("div",{className:"voicemail-item-footer",children:[t("div",{className:"play",onClick:s=>{if(s.stopPropagation(),!v.current)return I("warning","Audio ref is null");e?v.current.pause():v.current.play().catch(()=>I("error","Failed to play voicemail",l.id)),r(!e)},children:e?t(He,{}):t(_e,{})}),i("div",{className:"buttons",children:[l.number&&i(R,{children:[t(de,{className:"green",onClick:s=>{s.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.DESCRIPTION").format({number:V(l.number)}),buttons:[{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.PROCEED"),cb:()=>{Y({number:l.number})}}]})}}),t(Ce,{className:"blue",onClick:s=>{s.stopPropagation(),J.patch({active:{name:"Messages",data:{number:l.number,name:(O==null?void 0:O.firstname)&&K(O.firstname,O.lastname),avatar:O==null?void 0:O.avatar},view:"messages"}})}})]}),t(we,{className:"red",onClick:s=>{s.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.PROCEED"),cb:()=>{k("Phone",{action:"deleteVoiceMail",id:l.id},!0).then(L=>{if(!L)return I("error","Failed to delete voicemail");I("info","Deleted voicemail",l.id),q.set(q.value.filter(p=>p.id!==l.id))})}}]})}})]})]})]})})]})})};const z=c.createContext(null);function qe(){const l=S(J).active,[h,n]=c.useState("Contacts"),[v,P]=c.useState(null),f=S(w.APPS.PHONE.contacts),u=(r,N)=>{P({...r,from:N}),n("Contact")};c.useEffect(()=>{var r,N;if(f&&l!=null&&l.data)if(((r=l.data)==null?void 0:r.view)==="contact"){let E=f==null?void 0:f.find(m=>m.number==l.data.number);if(!E)return;P({...E||{number:l.data.number},from:"Contacts"}),n("Contact")}else((N=l.data)==null?void 0:N.view)==="newContact"&&(P({number:l.data.number,from:"Contacts"}),n("NewContact"))},[]);const A={Favourites:t(Be,{}),Contacts:t(Fe,{}),Recents:t(Xe,{}),Keypad:t(Ke,{}),NewContact:t(Ge,{}),Contact:t(xe,{}),Voicemail:t(je,{})},e={Favourites:t(Ue,{}),Recents:t(Me,{}),Contacts:t(se,{}),Keypad:t(De,{}),Voicemail:t(Ve,{})};return i("div",{className:"phone-app-container",children:[t(z.Provider,{value:{Contact:[v,P],View:[h,n],viewContact:u},children:t("div",{className:"wrapper",children:A[h]})}),t("div",{className:"footer",children:Object.keys(e).map((r,N)=>{let E=h==r?"active":"";return i("div",{className:`item ${E}`,onClick:()=>n(r),children:[e[r],t("span",{children:a(`APPS.PHONE.${r.toUpperCase()}.TITLE`)})]},N)})})]})}export{z as PhoneContext,qe as default};
