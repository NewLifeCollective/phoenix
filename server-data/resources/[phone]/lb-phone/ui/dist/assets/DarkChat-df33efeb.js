import{u as R,r as g,s as c,p,q as u,j as r,m as I,S as _,a as t,L as e,aw as $,C as v,aV as Y,b,am as q,an as B,w as J,$ as z,c5 as Q,aj as Z,x as ee,P as M,E as G,J as te,_ as W,I as ne,ag as ae,a9 as se,A as re,a7 as ie,ac as V,d as O,cv as ce,a4 as oe,t as F,H as U}from"./index-d0bf63a9.js";const k={username:"lb",channels:[{id:1,name:"guns",members:7,lastMessage:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{id:2,name:"comics",members:134,lastMessage:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{id:3,name:"cars",members:23,lastMessage:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12}],messages:{guns:[{content:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{content:"yo, does anyone have any weapons for sale?",sender:"rya2n",timestamp:Date.now()-1e3*60*60*6},{content:"sup",sender:"lb",timestamp:Date.now()-1e3*60*60*17}],comics:[{content:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{content:"any good cominc recommendations?",sender:"yungblood",timestamp:Date.now()-1e3*60*60*10},{content:"just finished reading the new batman comic, its amazing",sender:"batmanfan123",timestamp:Date.now()-1e3*60*60*24}],cars:[{content:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12},{content:"anyone know where i can get a good deal on a car?",sender:"anonymous",timestamp:Date.now()-1e3*60*60*14},{content:"i have a 2018 camaro for sale, 15k",sender:"camaroguy",timestamp:Date.now()-1e3*60*60*18},{content:"i have a 2017 mustang for sale, 10k",sender:"mustangguy",timestamp:Date.now()-1e3*60*60*20},{content:"looking for a quite new car in good condition for around 10k, anyone know where i can find one?",sender:"lb",timestamp:Date.now()-1e3*60*60*22}]}};function le(){var K,L;const a=R(h),o=R(S),[C,l]=g.useState(""),[m,s]=g.useState(""),D=R(M.Settings),d=R(c.APPS.DARKCHAT.channels);g.useEffect(()=>{c.APPS.DARKCHAT.channels.value||p("DarkChat",{action:"getChannels"},k.channels).then(i=>{if(!i)return u("warning","Failed to fetch channels");c.APPS.DARKCHAT.channels.set(i)})},[o]);const f=()=>{p("AccountSwitcher",{action:"getAccounts",app:"DarkChat"},null).then(i=>{var H;if(!i)return u("info","No accounts found");let T=(H=i==null?void 0:i.filter(n=>n!==o))==null?void 0:H.map(n=>({title:n,cb:()=>{p("AccountSwitcher",{action:"switch",app:"DarkChat",account:n}).then(()=>{S.set(n),c.APPS.DARKCHAT.username.set(n),c.APPS.DARKCHAT.channels.reset(),h.set("channels")})}}));v.ContextMenu.set({buttons:[{title:o},...T,{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:()=>{h.set("signup"),S.reset(),c.APPS.DARKCHAT.username.reset(),c.APPS.DARKCHAT.channels.reset()}},{title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),color:"red",cb:()=>{v.PopUp.set({title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),description:e("APPS.MAIL.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:e("APPS.MAIL.SIGN_OUT_POPUP.CANCEL")},{title:e("APPS.MAIL.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{p("DarkChat",{action:"logout"},!0).then(n=>{if(!n)return u("warning","Failed to logout, success returned false");S.reset(),c.APPS.DARKCHAT.username.reset(),c.APPS.DARKCHAT.channels.reset(),h.set("signin")})}}]})}}]})})};return r(I.div,{..._("left",a,.2),className:"animation-container",children:[r("div",{className:"darkchat-header",children:[r("div",{className:"top",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.TITLE")}),r("div",{className:"buttons",children:[t($,{onClick:()=>{o&&v.PopUp.set({title:e("APPS.DARKCHAT.NEW_ROOM"),description:e("APPS.DARKCHAT.NEW_ROOM_TEXT"),input:{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:D!=null&&D.streamerMode?"password":"text",minCharacters:3,onChange:i=>s(i)},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{s(i=>(p("DarkChat",{action:"joinChannel",channel:i},!k.channels.find(T=>T.name===i)&&{timestamp:Date.now(),name:i,members:Math.floor(Math.random()*100),lastMessage:"Welcome to the channel!",sender:"admin"}).then(T=>{if(!T)return u("warning","Failed to join channel");w.set(T),h.set("chat"),c.APPS.DARKCHAT.channels.set([T,...d])}),i))}}]})}}),t(Y,{className:"elipse",onClick:()=>{var i,T,H,n;v.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:f},((T=(i=b)==null?void 0:i.value)==null?void 0:T.ChangePassword.DarkChat)&&{title:e("APPS.DARKCHAT.CHANGE_PASSWORD"),cb:()=>{setTimeout(()=>{q("DarkChat",()=>{})},250)}},((n=(H=b)==null?void 0:H.value)==null?void 0:n.DeleteAccount.DarkChat)&&{title:e("APPS.DARKCHAT.DELETE_ACCOUNT"),color:"red",cb:()=>{setTimeout(()=>{B("DarkChat",()=>{S.reset(),c.APPS.DARKCHAT.username.set(null),c.APPS.DARKCHAT.channels.set(null),h.set("signin")})},250)}}]})}})]})]}),t(J,{placeholder:e("APPS.DARKCHAT.SEARCH"),theme:"dark",onChange:i=>l(i.target.value)})]}),(d==null?void 0:d.length)===0&&r("div",{className:"no-channels",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.NO_CHATS")}),t("div",{className:"description",children:e("APPS.DARKCHAT.NO_CHATS_TEXT")})]}),t("div",{className:"channels-body",children:(L=(K=d==null?void 0:d.sort((i,T)=>T.timestamp-i.timestamp))==null?void 0:K.filter(i=>i.name.toLowerCase().includes(C.toLowerCase())))==null?void 0:L.map(i=>t(Ae,{channel:i},i.id))})]})}const Ae=({channel:a})=>{const o=R(S),C=R(M.Settings),l=s=>/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(s),m=z(s=>{v.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),color:"red",cb:()=>{v.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),description:e("APPS.DARKCHAT.LEAVE_CHANNEL.DESCRIPTION"),buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.PROCEED"),cb:()=>{p("DarkChat",{action:"leaveChannel",channel:a.name},!0).then(D=>{if(!D)return u("warning","Failed to leave channel");h.set("channels"),w.set(null);let d=c.APPS.DARKCHAT.channels.value.filter(f=>f.name!==a.name);c.APPS.DARKCHAT.channels.set(d)})}}]})}}]})});return r("div",{...m,className:"channel",onClick:()=>{o&&(w.set(a),h.set("chat"))},children:[r("div",{className:"channel-info",children:[r("div",{className:"members",children:[t(Q,{}),t("span",{children:a.members})]}),r("div",{className:"channel-content",children:[t("div",{className:"channel-name",children:C.streamerMode?"*****":a.name}),a.lastMessage&&r("div",{className:"recent-message",children:[r("b",{children:[a.sender,":"]})," ",l(a.lastMessage)?e("APPS.MESSAGES.SENT_LOCATION_SHORT"):a.lastMessage]})]})]}),r("div",{className:"right",children:[t("div",{className:"timestamp",children:Z(a.timestamp)}),t(ee,{})]})]})};function me(){const a=R(M.Settings),o=R(w),C=R(S),l=R(h),[m,s]=g.useState([]),[D,d]=g.useState(""),f=g.useRef(null),K=g.useRef(0);g.useEffect(()=>{var n;G("DarkChat")&&p("DarkChat",{action:"getMessages",channel:o.name,page:0},(n=k.messages)==null?void 0:n[o.name]).then(A=>{if(!A)return u("error","Failed to fetch messages");s(A.reverse())})},[]);const{handleScroll:L}=te({fetchData:n=>p("DarkChat",{action:"getMessages",channel:o.name,page:n}),onDataFetched:n=>()=>{let A=document.querySelector(".chat-wrapper");K.current=A.scrollHeight,s([...n.reverse(),...m])},perPage:15});g.useEffect(()=>{let n=document.querySelector(".chat-wrapper");const A=n.scrollHeight;n.scrollTop+=A-K.current,n.scroll},[m]);const i=()=>{if(D.length>0){let n={sender:C,content:D,timestamp:new Date().getTime()};p("DarkChat",{action:"sendMessage",content:D,channel:o.name},!0).then(()=>{d(""),f.current.value="",s([...m,n]);let A=c.APPS.DARKCHAT.channels.value.map(P=>(P.name===o.name&&(P.lastMessage=n.content,P.sender=C,P.timestamp=new Date().getTime()),P));c.APPS.DARKCHAT.channels.set(A)})}},T=()=>{v.PopUp.set({title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{p("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(n=>{if(!n)return;let A={content:`<!SENT-LOCATION-X=${F(n.x,2)}Y=${F(n.y,2)}!>`,sender:C,timestamp:new Date().getTime()};p("DarkChat",{action:"sendMessage",...A,channel:o.name},!0).then(P=>{if(P){s(N=>[...N,A]),d(""),f.current.value="";let E=c.APPS.DARKCHAT.channels.value.map(N=>(N.name===o.name&&(N.lastMessage=A.content,N.sender=C,N.timestamp=new Date().getTime()),N));c.APPS.DARKCHAT.channels.set(E)}else s(E=>[...E,{...A,delivered:!1}])})})}}]})};W("darkChat:newMessage",n=>{if(o.name!==n.channel||!G("DarkChat"))return;let A=c.APPS.DARKCHAT.channels.value.map(P=>(P.name===n.channel&&(P.lastMessage=n.content,P.sender=n.sender,P.timestamp=new Date().getTime()),P));c.APPS.DARKCHAT.channels.set(A),s([...m,{...n,timestamp:new Date().getTime()}])});const H=n=>{if(n)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(n)};return r(I.div,{..._("right",l,.2),className:"animation-container",children:[t("div",{className:"darkchat-header chat",children:r("div",{className:"top",children:[t(ne,{onClick:()=>{h.set("channels"),w.set(null)}}),r("div",{className:"content",children:[t("div",{className:"title",children:a.streamerMode?"*****":o.name}),r("div",{className:"members",children:[o.members," ",o.members===1?e("APPS.DARKCHAT.MEMBER"):e("APPS.DARKCHAT.MEMBERS")]})]}),t(ae,{onClick:()=>{v.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_ROOM"),description:e("APPS.DARKCHAT.LEAVE_ROOM_TEXT"),buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE"),color:"red",cb:()=>{p("DarkChat",{action:"leaveChannel",channel:o.name},!0).then(n=>{if(!n)return u("warning","Failed to leave channel");h.set("channels"),w.set(null);let A=c.APPS.DARKCHAT.channels.value.filter(P=>P.name!==o.name);c.APPS.DARKCHAT.channels.set(A)})}}]})}})]})}),t("div",{className:"chat-wrapper",onScroll:L,children:t("div",{className:"chat-body",children:m.map((n,A)=>{var x;let P,E=null,N=n.sender===C?"self":"other",y=((x=m[A+1])==null?void 0:x.sender)===C?"self":"other";if(m[A+1]?P=Math.abs(n.timestamp-m[A+1].timestamp)/36e5:y=void 0,H(n.content)){let j=n.content.match(/X=(-?\d*\.?\d*)Y/)[1],X=n.content.match(/Y=(-?\d*\.?\d*)!>/)[1];E={x:j,y:X}}return r("div",{className:se("message",N),children:[E?t("div",{className:"location",onClick:()=>{re.patch({active:{name:"Maps",data:{location:[E.y,E.x],name:`${n.sender}'s location`}}})},children:t("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}})}):t("div",{className:"content",children:ie(n.content)}),m[A+1]&&P>6?r("div",{className:"date",children:[N=="other"&&t("div",{className:"user",children:n.sender}),V(n.timestamp)]}):N!==y&&r("div",{className:"date",children:[N=="other"&&t("div",{className:"user",children:n.sender}),V(n.timestamp)]})]},A)})})}),t("div",{className:"chat-bottom",children:r("div",{className:"input",children:[t(O,{type:"text",placeholder:e("APPS.DARKCHAT.INPUT_PLACEHOLDER"),value:D,ref:f,onChange:n=>d(n.target.value),onKeyDown:n=>{if(n.key==="Enter")return i()}}),r("div",{className:"buttons",children:[t("div",{className:"location",children:t(ce,{onClick:T})}),D.length>0&&t("div",{className:"send",onClick:i,children:t(oe,{})})]})]})})]})}function de(){const[a,o]=g.useState({username:"",password:""}),C=()=>{p("DarkChat",{action:"login",username:a.username,password:a.password},{success:!0}).then(l=>{l&&l.success?(S.set(a.username),c.APPS.DARKCHAT.username.set(a.username),h.set("channels")):l&&l.reason&&(u("error",l.reason),v.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${l.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]}))})};return t(I.div,{..._("right","signin",.2),className:"animation-container",children:r("div",{className:"form",children:[t("div",{className:"form-header",children:t("div",{className:"title",children:e("APPS.DARKCHAT.LOGIN")})}),r("div",{className:"form-content",children:[r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),t("div",{className:"input",children:t(O,{type:"text",placeholder:"anonymous",maxLength:50,onChange:l=>{o({...a,username:l.target.value.toLowerCase()})}})})]}),r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),t("div",{className:"input",children:t(O,{type:"password",placeholder:"••••••••••",minLength:3,onChange:l=>{o({...a,password:l.target.value})}})})]}),t("div",{className:"button",onClick:()=>C(),children:e("APPS.DARKCHAT.LOGIN")})]}),r("div",{className:"footer",children:[e("APPS.DARKCHAT.NO_ACCOUNT")," ",t("span",{onClick:()=>h.set("signup"),children:e("APPS.DARKCHAT.SIGN_UP")})]})]})})}function he(){const[a,o]=g.useState({username:"",password:""}),C=()=>{if(a.username===""||a.password==="")return u("warning","Username or password is empty");let l=a==null?void 0:a.username.toLowerCase().replace(/\s/g,""),m=l.match(b.value.UsernameFilter);if(!m||(m==null?void 0:m[0])!==l||l.length<3||l.length>15){u("warning","Username did not match regex"),v.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e("APPS.DARKCHAT.USERNAME_NOT_ALLOWED"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}p("DarkChat",{action:"register",username:a.username,password:a.password},{success:!0}).then(s=>{if(!s)return u("warning","Darkchat response is null");if(s&&s.success)u("info","Account created successfully"),S.set(a.username),c.APPS.DARKCHAT.username.set(a.username),h.set("channels");else if(s&&s.reason){u("warning",s.reason),v.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${s.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}})};return t(I.div,{..._("left","signup",.2),className:"animation-container",children:r("div",{className:"form",children:[t("div",{className:"form-header",children:t("div",{className:"title",children:e("APPS.DARKCHAT.SIGN_UP")})}),r("div",{className:"form-content",children:[r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),t("div",{className:"input",children:t(O,{type:"text",placeholder:"anonymous",maxLength:50,onChange:l=>{o({...a,username:l.target.value.toLowerCase()})}})})]}),r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),t("div",{className:"input",children:t(O,{type:"password",placeholder:"••••••••••",minLength:3,onChange:l=>{o({...a,password:l.target.value})}})})]}),t("div",{className:"button",onClick:()=>C(),children:e("APPS.DARKCHAT.SIGN_UP")})]}),r("div",{className:"footer",children:[e("APPS.DARKCHAT.ALREADY_HAVE")," ",t("span",{onClick:()=>h.set("signin"),children:e("APPS.DARKCHAT.LOGIN")})]})]})})}const Pe={channels:t(le,{}),chat:t(me,{}),signin:t(de,{}),signup:t(he,{})},h=U("signup"),w=U(null),S=U(null);function Ce(){const a=R(h),[o,C]=g.useState(""),[l,m]=g.useState(!0);return g.useEffect(()=>{if(c.APPS.DARKCHAT.username.value){S.set(c.APPS.DARKCHAT.username.value),m(!1);return}p("DarkChat",{action:"getUsername"},k.username).then(s=>{if(m(!1),!s||!(s!=null&&s.username))return u("warning","Darkchat response is null");S.set(s.username),c.APPS.DARKCHAT.username.set(s.username),s.password?h.set("channels"):v.PopUp.set({title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),description:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.DESCRIPTION"),input:{type:"password",placeholder:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.PLACEHOLDER"),minLength:3,maxLength:50,onChange:D=>C(D)},buttons:[{title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),cb:()=>{C(D=>(p("DarkChat",{action:"setPassword",password:D},{success:!0}).then(d=>{if(!d||d!=null&&d.reason)return u("error",d.reason);h.set("channels")}),""))}}]})})},[]),W("darkchat:logout",s=>{if(!s)return u("warning","No username provided to logout");if(!S.value)return u("warning","No username stored in cache to logout");if(s!==(S==null?void 0:S.value))return u("warning","Username provided does not match current logged in username, not logging out");S.set(null),h.set("signin"),c.APPS.DARKCHAT.username.set(null),c.APPS.DARKCHAT.channels.set(null)}),t("div",{className:"darkchat-container",children:!l&&Pe[a]})}export{w as ActiveChannel,S as Username,h as View,Ce as default};
