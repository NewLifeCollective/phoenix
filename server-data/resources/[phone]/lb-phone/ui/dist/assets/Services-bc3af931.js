import{u as I,r as v,E as G,p as u,q as N,a,F as L,j as i,L as t,m as A,c4 as Se,k as J,bw as Pe,C as g,c5 as Ee,aw as pe,b_ as ue,b as W,J as he,_ as V,I as Ce,f as y,a0 as ve,d as Ie,bS as Y,a4 as Ne,t as ae,a9 as ge,a7 as te,a8 as be,A as B,ac as q,P as w,w as fe,e as ne,g as Ae,h as ce,D as se,H as $,i as re,bv as le,c6 as Oe,c7 as ie,N as de,az as Re,S as me,$ as Le,x as Te,c8 as ye}from"./index-4a091edb.js";import{S as oe}from"./Switch-db0cdd4f.js";const _={companies:[{job:"police",name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png",canCall:!0,canMessage:!0,bossRanks:["boss","lieutenant"],open:!0,location:{name:"Mission Row",coords:{x:428.9,y:-984.5}}},{job:"ambulance",name:"Ambulance",icon:"https://cdn-icons-png.flaticon.com/128/1032/1032989.png",canCall:!0,canMessage:!0,bossRanks:["boss","doctor"],open:!0,location:{name:"Pillbox",coords:{x:304.2,y:-587}}},{job:"mechanic",name:"Mechanic",icon:"https://cdn-icons-png.flaticon.com/128/10281/10281554.png",canCall:!0,canMessage:!0,bossRanks:["boss","worker"],open:!1,location:{name:"LS Customs",coords:{x:-336.6,y:-134.3}}},{job:"taxi",name:"Taxi",icon:"https://cdn-icons-png.flaticon.com/128/433/433449.png",canCall:!0,canMessage:!0,bossRanks:["boss","driver"],open:!1,location:{name:"Taxi HQ",coords:{x:984.2,y:-219}}}],company:{job:"police",duty:!0,receiveCalls:!0,isBoss:!0,balance:1e6,employees:[{id:1,name:"Breze",grade:1,gradeLabel:"Officer",canInteract:!0,online:!0},{id:2,name:"Loaf Scripts",grade:2,gradeLabel:"Sergeant",canInteract:!0,online:!0},{id:3,name:"Kash",grade:3,gradeLabel:"Lieutenant",canInteract:!0,online:!1}],grades:[{label:"Officer",grade:1},{label:"Sergeant",grade:2},{label:"Lieutenant",grade:3},{label:"Captain",grade:4}]},messageList:[{id:"1",lastMessage:"Is anyone available to help me?",sender:"Breze",number:"1234567890",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*2},{id:"2",lastMessage:"Hello, how can i help you?",sender:"Loaf Scripts",number:"4802940940",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*4},{id:"3",lastMessage:"Hey, i need backup at the bank",sender:"Sally",number:"2051440412",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*24*2}],messages:{1:[{id:"1",sender:"1234567890",content:"Is anyone available to help me?",timestamp:Date.now()-1e3*60*60*2},{id:"2",sender:"1234567323",content:"Hey, a unit is on its way to your location",timestamp:Date.now()-1e3*60*60*24*2},{id:"3",sender:"1234567890",content:"i'd like to report a crime, i'm at the pier",timestamp:Date.now()-1e3*60*60*24*2}],2:[{id:"1",sender:"4802940940",content:"Hey, can you help me?",timestamp:Date.now()-1e3*60*60*4},{id:"2",sender:"4802940940",content:"I need a unit to my location",timestamp:Date.now()-1e3*60*60*24*5},{id:"3",sender:"4802940940",content:"I need backup at the bank",timestamp:Date.now()-1e3*60*60*24*9}],3:[{id:"1",sender:"2051440412",content:"is there any way you have any job positions available?",timestamp:Date.now()-1e3*60*60*24*2},{id:"2",sender:"2051440412",content:"hello?",timestamp:Date.now()-1e3*60*60*24*4},{id:"3",sender:"2051440412",content:"hey, i have a question",timestamp:Date.now()-1e3*60*60*24*5}]},employees:[{firstname:"John",lastname:"Doe",grade:1,gradeLabel:"Officer",number:"1234567890",online:!0},{firstname:"Loaf",lastname:"Scripts",grade:2,gradeLabel:"Sergeant",number:"4802940940",online:!0},{firstname:"Kash",grade:3,gradeLabel:"Lieutenant",number:"2051440412",online:!1},{firstname:"Sally",grade:4,gradeLabel:"Captain",number:"1234567323",online:!0}]};function De(){var S,E,o,p,h,f,s,P,T,U,X,z,K;const e=I(W),n=I(C),[l,m]=v.useState(null);v.useEffect(()=>{G("Services")&&u("Services",{action:"getCompany"},_.company).then(d=>{if(!d)return N("warning","Failed to fetch company data");C.set(d)})},[]);const c=()=>{g.PopUp.set({title:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:t("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:d=>{m(d)},type:"number"},buttons:[{title:t("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:t("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{m(d=>{/^\d+$/.test(d)&&u("Services",{action:"depositMoney",amount:parseInt(d)},parseInt(d)+n.balance).then(b=>{if(typeof b!="number")return N("warning","Balance is not a number, not updating");C.patch({balance:b})})})}}]})},r=()=>{g.PopUp.set({title:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:t("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:d=>{m(d)},type:"number"},buttons:[{title:t("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:t("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{m(d=>{if(/^\d+$/.test(d)){if(n.balance-parseInt(d)<0){g.PopUp.set({title:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:t("APPS.SERVICES.WITHDRAW_POPUP.NOT_ENOUGH_MONEY").format({amount:d}),buttons:[{title:t("APPS.SERVICES.WITHDRAW_POPUP.PROCEED")}]});return}u("Services",{action:"withdrawMoney",amount:parseInt(d)},n.balance-parseInt(d)).then(b=>{if(typeof b!="number")return N("warning","Balance is not a number, not updating");C.patch({balance:b})})}})}}]})};return a(L,{children:n!=null&&n.job?i("div",{className:"actions-container",children:[a("div",{className:"category-title",children:t("APPS.SERVICES.SETTINGS")}),a("section",{children:i(L,{children:[n.duty!==void 0&&((E=(S=e==null?void 0:e.Companies)==null?void 0:S.Management)==null?void 0:E.Duty)!==!1&&i(A.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[a(Se,{className:"orange"}),i("div",{className:"item-info",children:[a("div",{className:"title",children:t("APPS.SERVICES.DUTY")}),a("div",{className:"description",children:t("APPS.SERVICES.DUTY_DESCRIPTION")})]})]}),a("div",{className:"item-value",children:a(oe,{checked:n.duty,onChange:()=>{u("Services",{action:"toggleDuty",duty:!n.duty},!0).then(()=>{var d;return C.patch({duty:!((d=C.value)!=null&&d.duty)})})}})})]}),(n.duty===void 0||n.duty===!0)&&i(A.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[a(J,{className:"green"}),i("div",{className:"item-info",children:[a("div",{className:"title",children:t("APPS.SERVICES.JOB_CALLS")}),i("div",{className:"description",children:[" ",t("APPS.SERVICES.JOB_CALLS_DESCRIPTION").format({toggle:n.receiveCalls?t("APPS.SERVICES.DISABLE"):t("APPS.SERVICES.ENABLE")})]})]})]}),a("div",{className:"item-value",children:a(oe,{checked:n.receiveCalls,onChange:()=>{u("Services",{action:"toggleCalls"},!n.receiveCalls).then(d=>{C.patch({receiveCalls:d})})}})})]})]})}),n.isBoss&&i(L,{children:[a("div",{className:"category-title",children:t("APPS.SERVICES.ACTIONS")}),i("section",{children:[i(A.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[a(Pe,{className:"green"}),i("div",{className:"item-info",children:[a("div",{className:"title",children:t("APPS.SERVICES.BALANCE")}),a("div",{className:"description",children:"Current balance of the company"})]})]}),a("div",{className:"item-value",children:e.CurrencyFormat.replace("%s",(o=n.balance)==null?void 0:o.toLocaleString())})]}),(((h=(p=e==null?void 0:e.Companies)==null?void 0:p.Management)==null?void 0:h.Deposit)!==!1||((s=(f=e==null?void 0:e.Companies)==null?void 0:f.Management)==null?void 0:s.Withdraw)!==!1)&&i("div",{className:"item",children:[((T=(P=e==null?void 0:e.Companies)==null?void 0:P.Management)==null?void 0:T.Deposit)!==!1&&a("div",{className:"button",onClick:c,children:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE")}),((X=(U=e==null?void 0:e.Companies)==null?void 0:U.Management)==null?void 0:X.Withdraw)!==!1&&a("div",{className:"button",onClick:r,children:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]}),a("div",{className:"category-title",children:t("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("section",{children:[((K=(z=e==null?void 0:e.Companies)==null?void 0:z.Management)==null?void 0:K.Hire)!==!1&&i(A.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.HIRE_POPUP.TITLE"),description:t("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:t("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:d=>{m(d)}},buttons:[{title:t("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{m(d=>{if(/^\d+$/.test(d))return u("Services",{action:"hireEmployee",source:parseInt(d)},{id:d,name:"Joe Doe"}).then(b=>{var k,M;b&&C.patch({employees:[...(k=C.value)==null?void 0:k.employees,{id:b.id,name:b.name,grade:0,gradeLabel:(M=C.value)==null?void 0:M.grades[0].label,canInteract:!0}]})}),""})}}]})},children:[i("div",{className:"item-data",children:[a(Ee,{className:"blue"}),i("div",{className:"item-info",children:[a("div",{className:"title",children:t("APPS.SERVICES.HIRE")}),a("div",{className:"description",children:t("APPS.SERVICES.HIRE_POPUP.DESCRIPTION")})]})]}),a("div",{className:"item-value",children:a(pe,{})})]}),n.employees.map((d,b)=>i(A.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{var M,Q,Z,ee;if(!d.canInteract||e.Companies.Management.Fire===!1&&e.Companies.Management.Promote===!1)return;const k=[((Q=(M=e==null?void 0:e.Companies)==null?void 0:M.Management)==null?void 0:Q.Promote)!==!1&&{title:t("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{g.ContextMenu.set({buttons:[...n.grades.map(O=>({title:O.label,cb:()=>{u("Services",{action:"setGrade",employee:d.id,grade:O.grade},!0).then(H=>{var j;if(!H)return N("warning","Failed to set grade");C.patch({employees:(j=C.value)==null?void 0:j.employees.map(x=>(x.id===d.id&&(x.grade=O.grade,x.gradeLabel=O.label),x))})})}}))]})},300)}},((ee=(Z=e==null?void 0:e.Companies)==null?void 0:Z.Management)==null?void 0:ee.Fire)!==!1&&{title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{g.PopUp.set({title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),description:t("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:d.name}),buttons:[{title:t("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{u("Services",{action:"fireEmployee",employee:d.id},!0).then(O=>{var H;if(!O)return N("warning","Failed to fire employee");C.patch({employees:(H=C.value)==null?void 0:H.employees.filter(j=>j.id!==d.id)})})}}]})}}];g.ContextMenu.set({buttons:k.filter(O=>O)})},children:[i("div",{className:"item-data",children:[a(ue,{}),i("div",{className:"item-info",children:[a("div",{className:"title",children:d.name}),i("div",{className:"description",children:[" ",d.gradeLabel]})]})]}),a("div",{className:"item-value",children:a("div",{className:"status","data-online":d.online})})]},b))]})]})]}):a("div",{className:"no-job",children:t("APPS.SERVICES.UNEMPLOYED")})})}function Me(){const e=I(w.Settings),n=I(w.PhoneNumber),l=I(R),[m,c]=v.useState([]),r=v.useRef(null),[S,E]=v.useState({content:"",attachments:[]});v.useEffect(()=>{G("Services")&&u("Services",{action:"getMessages",page:0,id:l.id,company:l.job},_.messages[l.id]).then(s=>{if(s&&s.length>0){c([...s.reverse()]);let P=document.querySelector(".chat-container");P.scrollTop=P.scrollHeight}})},[]);const o=()=>{if(S.content.length>0){let s={sender:n,id:l.id,company:l.job,content:S.content,timestamp:new Date};if(e.airplaneMode)return c(P=>[...P,{...s,delivered:!1}]);u("Services",{action:"sendMessage",...s},!0).then(P=>{P||N("error","Failed to send message"),c(T=>[...T,{...s,delivered:P}]),E({content:"",attachments:[]}),r.current.value=""})}},p=()=>{g.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{u("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(s=>{if(!s)return N("error","Failed to get location");let P={sender:n,content:`<!SENT-LOCATION-X=${ae(s.x,2)}Y=${ae(s.y,2)}!>`,attachments:[],id:l.id,company:l.job,timestamp:new Date};u("Services",{action:"sendMessage",...P},!0).then(T=>{c(U=>[...U,T?P:{...P,delivered:!1}])})})}}]})},{handleScroll:h}=he({fetchData:s=>u("Services",{action:"getMessages",id:l.id,company:l.job,page:s}),onDataFetched:s=>c([...s.reverse(),...m]),perPage:25});V("services:newMessage",s=>{if(l.id!==s.channelId||s.sender===n||e.airplaneMode)return;c([...m,{...s,timestamp:new Date}]);let P=document.querySelector(".chat-container");P.scrollTop=P.scrollHeight});const f=s=>{if(s)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(s)};return i(L,{children:[i("div",{className:"chat-header",children:[a("div",{className:"back",onClick:()=>{D.set("messages"),R.reset()},children:a(Ce,{})}),i("div",{className:"user",children:[a("img",{src:l.icon??`./assets/img/avatar-placeholder-${e.display.theme}.svg`,className:"avatar"}),a("div",{className:"name",children:l.company??y(l.number)})]}),a(ve,{className:"hidden"})]}),a("div",{className:"chat-container",onScroll:h,children:a("div",{className:"chat-body",children:m.map((s,P)=>a(Ve,{index:P,messages:m,message:s,func:{isLocation:f}}))})}),a("div",{className:"chat-bottom",children:i("div",{className:"input",children:[a(Ie,{placeholder:t("APPS.MESSAGES.PLACEHOLDER"),ref:r,value:S.content,onChange:s=>{E({content:s.target.value,attachments:S.attachments})},onKeyDown:s=>{s.key=="Enter"&&o()}}),i("div",{className:"buttons",children:[a("div",{className:"location",children:a(Y,{onClick:p})}),S.content.length>0&&a("div",{className:"send",onClick:o,children:a(Ne,{})})]})]})})]})}const Ve=({messages:e,message:n,index:l,func:m})=>{var f;const c=I(w.PhoneNumber),r=I(R);let S,E,o,p=n.sender===c?"self":"other",h=((f=e[l+1])==null?void 0:f.sender)===c?"self":"other";if(e[l+1]?E=Math.abs(n.timestamp-e[l+1].timestamp)/36e5:h=void 0,m.isLocation(n.content)){let s=n.content.match(/X=(-?\d*\.?\d*)Y/)[1],P=n.content.match(/Y=(-?\d*\.?\d*)!>/)[1];o={x:s,y:P}}return i("div",{className:ge("message",p),"data-id":n.id,children:[S,n.delivered===!1?i("div",{className:"content-wrapper",children:[a("div",{className:"content",children:te(n.content)}),a(be,{})]}):o?i("div",{className:"location",onClick:()=>{B.patch({active:{name:"Maps",data:{location:[o.y,o.x],name:`${y(n.sender)}'s location`,icon:r.icon}}})},children:[a("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),p==="other"&&i("div",{className:"sender",children:[y(n.sender)," ",t("APPS.MESSAGES.SENT_LOCATION")]})]}):n.content&&a("div",{className:"content",children:te(n.content)}),n.delivered===!1?a("div",{className:"status",children:t("APPS.MESSAGES.NOT_DELIVERED")}):e[l+1]&&E>6?a("div",{className:"date",children:q(n.timestamp)}):p!==h&&a("div",{className:"date",children:q(n.timestamp)})]},l)},F=$(null);function we(){var S,E;const e=I(F),[n,l]=v.useState("all"),[m,c]=v.useState(""),r=o=>{if(!o)return N("error","No number provided");g.PopUp.set({title:t("APPS.SERVICES.CALL_POPUP.TITLE"),description:t("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:y(o)}),buttons:[{title:t("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:t("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let p=se(o);re({...p,number:o})}}]})};return i(A.div,{initial:{opacity:0,y:250},animate:{opacity:1,y:0},exit:{opacity:0,y:250},transition:{duration:.2,ease:"easeInOut"},className:"employee-list",children:[i("div",{className:"employee-list-header",children:[a("div",{className:"close",onClick:()=>F.set(null)}),a("div",{className:"selector",children:["all","available"].map((o,p)=>a("div",{className:"option","data-active":n===o,onClick:()=>l(o),children:t(`APPS.SERVICES.${o.toUpperCase()}`)},p))}),a(fe,{placeholder:t("APPS.SERVICES.SEARCH_EMPLOYEES"),onChange:o=>c(o.target.value)})]}),a("div",{className:"employee-list-body",children:(E=(S=e==null?void 0:e.filter(o=>(n==="all"?!0:o.online)&&ne(o.firstname,o.lastname).toLowerCase().includes(m.toLowerCase())))==null?void 0:S.sort((o,p)=>p.grade-o.grade))==null?void 0:E.map((o,p)=>i(A.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"employee-item",children:[i("div",{className:"user",children:[a("div",{className:"avatar",children:Ae(o.firstname,o.lastname)}),i("div",{className:"info",children:[ne(o.firstname,o.lastname),a("span",{children:o.gradeLabel})]})]}),a("div",{className:"buttons",children:i(L,{children:[a(J,{className:o.online&&o.number?"green":"red",onClick:()=>r(o.number)}),a(ce,{className:o.online&&o.number?"green":"red",onClick:()=>{if(!o.number)return N("error","No number provided");let h=se(o.number);B.patch({active:{name:"Messages",data:{number:o.number,name:h==null?void 0:h.name,avatar:h==null?void 0:h.avatar,view:"messages"}}})}})]})})]},p))})]})}function _e(){var m;const[e,n]=v.useState([]),l=(m=I(B))==null?void 0:m.active;return v.useEffect(()=>{G("Services")&&u("Services",{action:"getCompanies"},_.companies).then(c=>{if(!c)return N("warning","Failed to fetch companies");n(c)})},[l]),V("services:updateOpen",c=>{if(!c)return;const{job:r,open:S}=c;n(E=>{const o=E.findIndex(p=>p.job===r);return o===-1?E:(E[o].open=S,[...E])})}),a(L,{children:a("div",{className:"companies-list",children:e.sort((c,r)=>c.open&&!r.open?-1:!c.open&&r.open?1:0).map(c=>a(Ue,{company:c},c.name))})})}const Ue=({company:e})=>{var o,p,h,f;const n=I(W),l=()=>{u("Services",{action:"getEmployees",company:e.job},_.employees).then(s=>{if(!s)return N("warning","You do not have permission to view employees.");F.set(s)})},[m,c]=v.useState(!1),r=s=>{var P;!((P=s==null?void 0:s.location)!=null&&P.coords)||!s.name||B.patch({active:{name:"Maps",data:{location:[s.location.coords.y,s.location.coords.x],name:s.name,icon:s.icon}}})},S=(s,P)=>{n.Companies.Enabled&&g.PopUp.set({title:t("APPS.SERVICES.CALL_POPUP.TITLE"),description:t("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:Re(s)}),buttons:[{title:t("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:t("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{re({company:s,companylabel:P})}}]})},E=s=>{u("Services",{action:"getChannelId",company:s.job},"1").then(P=>{if(!P)return N("error","Failed to get channel id");R.set({icon:s.icon,company:s.name,job:s.job,id:P}),D.set("chat")})};return i("div",{className:"item",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),"data-open":e.open,onClick:l,children:[i("div",{className:"info",children:[e.icon&&a("div",{className:"icon",children:a("img",{src:e.icon})}),i("div",{className:"company-details",children:[a("div",{className:"title",children:e.name}),i("div",{className:"location",children:[a(le,{}),(o=e.location)==null?void 0:o.name]})]})]}),e.open?i("div",{className:"actions",children:[e.customIcon&&a("div",{className:"custom-icon",onClick:s=>{s.stopPropagation(),u("Services",{action:"customIconClick",company:e.job})},children:Oe[e.customIcon]()}),((p=e.location)==null?void 0:p.coords)&&a(Y,{className:"orange",onClick:s=>{s.stopPropagation(),r(e)}}),((h=n.Companies)==null?void 0:h.Enabled)!==!1&&e.canCall!==!1&&a(J,{className:"green",onClick:s=>{s.stopPropagation(),S(e.job,e.name)}}),e.canMessage!==!1&&a(ie,{className:"green",onClick:s=>{s.stopPropagation(),E(e)}})]}):i(L,{children:[i("div",{className:"actions",onMouseEnter:()=>c(!1),onMouseLeave:()=>c(!0),children:[((f=e.location)==null?void 0:f.coords)&&a(Y,{className:"orange",onClick:s=>{s.stopPropagation(),r(e)}}),e.canMessage!==!1&&n.Companies.MessageOffline&&a(ie,{className:"green",onClick:s=>{s.stopPropagation(),E(e)}})]}),a(de,{children:m&&a(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"closed",children:t("APPS.SERVICES.CLOSED")})})]})]},e.name)};function ke(){const e=I(w.PhoneNumber),[n,l]=v.useState({personal:[],job:[]}),[m,c]=v.useState("personal");return v.useEffect(()=>{G("Services")&&u("Services",{action:"getRecentMessages",page:0},_.messageList).then(r=>{if(!r)return N("warning","No recent messages found");l({personal:[...r.filter(S=>S.number===e)],job:[...r.filter(S=>S.number!==e)]})})},[]),V("services:channelDeleted",r=>{if(!r)return N("error","No channel ID provided");l({personal:n.personal.filter(S=>S.id!==r),job:n.job.filter(S=>S.id!==r)})}),a(L,{children:i("div",{className:"company-messages-container",children:[a("div",{className:"company-messages-header",children:a("div",{className:"selector",children:["personal","job"].map((r,S)=>a("div",{className:"option","data-active":m===r,onClick:()=>c(r),children:t(`APPS.SERVICES.${r.toUpperCase()}`)},S))})}),a(A.section,{...me(m==="personal"?"right":"left",m,.2),children:(n==null?void 0:n[m])&&(n==null?void 0:n[m].map((r,S)=>a(He,{channel:r,type:m},S)))})]})})}const He=({channel:e,type:n})=>{var r,S;const l=I(w.Settings),m=Le(()=>{var E;(E=W)!=null&&E.value.Companies.DeleteConversations&&n!=="personal"&&g.ContextMenu.set({buttons:[{title:t("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{setTimeout(()=>{g.PopUp.set({title:t("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:t("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:t("APPS.MESSAGES.DELETE_CONVERSATION.CANCEL")},{title:t("APPS.MESSAGES.DELETE_CONVERSATION.DELETE"),color:"red",cb:()=>{u("Services",{action:"deleteChannel",id:e.id},!0).then(o=>{if(!o)return N("error","Failed to delete channel, deleteChannel returned false")})}}]})},100)}}]})}),c=E=>{if(E)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(E)};return i("div",{...m,className:"item",onClick:()=>{var E,o,p;R.set({...R==null?void 0:R.value,id:e.id,icon:n==="personal"&&((E=e==null?void 0:e.company)!=null&&E.icon)?e.company.icon:`./assets/img/avatar-placeholder-${l.display.theme}.svg`,company:n==="personal"&&((o=e==null?void 0:e.company)!=null&&o.name)?e.company.name:y(e.number),job:(p=e.company)==null?void 0:p.job,number:e.number}),D.set("chat")},children:[n==="personal"&&((r=e==null?void 0:e.company)!=null&&r.icon)?a("img",{src:e.company.icon}):a("img",{src:`./assets/img/avatar-placeholder-${l.display.theme}.svg`}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[a("div",{className:"user",children:n==="personal"&&((S=e==null?void 0:e.company)!=null&&S.name)?e.company.name:y(e.number)}),i("div",{className:"right",children:[a("div",{className:"time",children:q(e.timestamp)}),a(Te,{})]})]}),a("div",{className:"message",children:c(e.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):e.lastMessage})]})]})};function je(){const e=I(W),n=I(D),[l,m]=v.useState([{icon:a(le,{}),title:t("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:a(ce,{}),title:t("APPS.SERVICES.MESSAGES"),value:"messages"}]);return v.useEffect(()=>{var c,r;((r=(c=e==null?void 0:e.Companies)==null?void 0:c.Management)==null?void 0:r.Enabled)!==!1&&m([...l,{icon:a(ye,{}),title:t("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),a("div",{className:"companies-footer",children:l.map((c,r)=>i("div",{className:"item","data-active":n===c.value,onClick:()=>D.set(c.value),children:[c.icon,c.title]},r))})}const D=$("companies"),R=$(null),C=$(null);function Ge(){const e=I(D),n=I(F),l={companies:a(_e,{}),actions:a(De,{}),messages:a(ke,{}),chat:a(Me,{})};let m={actions:t("APPS.SERVICES.ACTIONS"),messages:t("APPS.SERVICES.MESSAGES"),companies:t("APPS.SERVICES.COMPANIES")};return V("services:setCompany",c=>C.set(c)),V("services:setDuty",c=>C.patch({duty:c})),i("div",{className:"companies-container","data-view":e,children:[a(de,{children:n&&a(we,{})}),i(A.div,{...me(e==="chat"?"left":"right",e,.2),className:"companies-wrapper",children:[e!=="chat"&&a("div",{className:"companies-header",children:a("div",{className:"title",children:m[e]})}),a("div",{className:"companies-body",children:l[e]})]}),e!=="chat"&&a(je,{})]})}export{C as CompanyData,R as Data,D as View,Ge as default};
