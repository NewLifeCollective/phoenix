import{u as E,r,E as U,p as P,J as _,_ as j,j as l,a,L as s,ah as V,w as F,m as v,a7 as M,ab as B,h as K,D as N,A as f,k as $,bk as z,N as q,d as O,C as u,b as C,aw as H,f as J,i as X,P as I}from"./index-4a091edb.js";import{formatDate as Q}from"./Marketplace-bed8ca93.js";import{T as Z}from"./Textarea-17af0c3b.js";const b={posts:[{id:"1",title:"Looking for a new job",description:"I am looking for a new job in the field of software development. I have 5 years of experience in the field and I am looking for a new challenge. I am open to any offers and I am willing to relocate.",number:"0601232354"},{id:"2",title:"Banshee",description:"Selling my 2020 model Bravado Banshee, low mileage and in perfect condition. Price is negotiable.",number:"0606643134",attachment:"https://www.gtabase.com/images/gta-5/vehicles/sports/main/banshee.jpg",price:74999},{id:"3",title:"2018+ Sanchez",description:"Looking for a 2018 or newer model Sanchez. I am willing to pay up to 20k for a good condition bike.",number:"0651566734"}]};function se(){const T=E(I.Settings),p=E(C),S=E(f),g=E(I.PhoneNumber),[R,w]=r.useState(!1),[m,h]=r.useState([]),[t,c]=r.useState(null),[d,Y]=r.useState(""),[L,y]=r.useState(""),[k,D]=r.useState([]);r.useEffect(()=>{const e=setTimeout(()=>Y(L),500);return()=>clearTimeout(e)},[L]),r.useEffect(()=>{U("YellowPages")&&(P("YellowPages",{action:"getPosts",page:0},b.posts).then(e=>{!e||e.length===0||h(e)}),P("isAdmin",null,!1).then(e=>w(e)))},[S==null?void 0:S.active]),r.useEffect(()=>{d.length>0&&P("YellowPages",{action:"search",query:d},b.posts.filter(e=>e.title.toLowerCase().includes(d.toLowerCase())||e.description.toLowerCase().includes(d.toLowerCase()))).then(e=>{e&&D(e)})},[d]);const A=()=>{if(!(t!=null&&t.title)||!(t!=null&&t.description)){let i;switch(!0){case!(t!=null&&t.title):i=s("APPS.YELLOWPAGES.ERROR_POPUP.NO_TITLE");break;case!(t!=null&&t.description):i=s("APPS.YELLOWPAGES.ERROR_POPUP.NO_DESCRIPTION");break;default:i="UNKNOWN ERROR";break}u.PopUp.set({title:s("APPS.YELLOWPAGES.ERROR_POPUP.TITLE"),description:i,buttons:[{title:s("APPS.YELLOWPAGES.ERROR_POPUP.OK")}]});return}let e={...t,number:g};P("YellowPages",{action:"sendPost",data:e},!0).then(i=>{i&&(h([{...e,id:i},...m]),c(null))})},G=e=>{e&&u.PopUp.set({title:s("APPS.YELLOWPAGES.DELETE_POPUP.TITLE"),description:s("APPS.YELLOWPAGES.DELETE_POPUP.TEXT"),buttons:[{title:s("APPS.YELLOWPAGES.DELETE_POPUP.CANCEL")},{title:s("APPS.YELLOWPAGES.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{P("YellowPages",{action:"deletePost",id:e},!0).then(i=>{i&&h(m.filter(o=>o.id!==e))})}}]})},W=e=>{e&&u.PopUp.set({title:s("APPS.SERVICES.CALL_POPUP.TITLE"),description:s("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:J(e)}),buttons:[{title:s("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:s("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let i=N(e);X({...i,number:e})}}]})},{handleScroll:x}=_({fetchData:e=>P("YellowPages",{action:"getPosts",page:e}),onDataFetched:e=>h([...m,...e]),perPage:15});return j("yellowPages:newPost",e=>{T.airplaneMode||h([e,...m])}),l("div",{className:"pages-container",children:[l("div",{className:"pages-header",children:[l("div",{className:"pages-header-top",children:[a("div",{className:"title",children:s("APPS.YELLOWPAGES.PAGES")}),a(V,{onClick:()=>c({})})]}),a(F,{placeholder:s("APPS.YELLOWPAGES.SEARCH"),onChange:e=>y(e.target.value)})]}),a("div",{className:"pages-wrapper",children:a("div",{className:"posts",onScroll:x,children:(d.length>0?k:m).map((e,i)=>{var o;return a(v.div,{className:"post-item",initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},viewport:{once:!0},transition:{duration:.2,ease:"easeInOut"},children:l("div",{className:"post-info",children:[l("div",{className:"post-header",children:[a("div",{className:"title",children:e.title}),a("div",{className:"date",children:Q(e.timestamp)})]}),l("div",{className:"post-content",children:[l("div",{className:"post-text",style:{maxWidth:e.attachment?"65%":"100%"},children:[a("div",{className:"description",children:M(e.description)}),e.price&&a("div",{className:"price",children:p==null?void 0:p.CurrencyFormat.replace("%s",(o=e.price)==null?void 0:o.toLocaleString())})]}),e.attachment&&a("div",{className:"attachment",children:a(B,{src:e.attachment})})]}),l("div",{className:"post-footer",children:[a(K,{className:"green",onClick:()=>{let n=N(e.number);f.patch({active:{name:"Messages",data:{number:e.number,name:n==null?void 0:n.name,avatar:n==null?void 0:n.avatar,view:"messages"}}})}}),a($,{className:"blue",onClick:()=>W(e.number)}),(g===e.number||R)&&a(z,{className:"red",onClick:n=>{n.stopPropagation(),G(e.id)}})]})]})},i)})})}),a(q,{children:t&&l(v.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{duration:.2,ease:"easeInOut"},className:"new-post-container",children:[l("div",{className:"new-post-header",children:[a("div",{}),a("div",{className:"close",children:a("div",{onClick:()=>c(null)})}),a("div",{className:"post",onClick:A,children:s("APPS.MARKETPLACE.POST")})]}),l("div",{className:"new-post-body",children:[l("div",{className:"item",children:[a("div",{className:"title",children:s("APPS.YELLOWPAGES.TITLE")}),a(O,{type:"text",placeholder:s("APPS.YELLOWPAGES.TITLE"),maxLength:50,onChange:e=>c({...t,title:e.target.value})})]}),l("div",{className:"item",children:[a("div",{className:"title",children:s("APPS.YELLOWPAGES.DESCRIPTION")}),a(Z,{type:"text",placeholder:s("APPS.YELLOWPAGES.DESCRIPTION"),maxLength:250,rows:5,onChange:e=>c({...t,description:e.target.value})})]}),a("div",{className:"item",children:a("div",{className:"images",children:a("div",{className:"image",style:{backgroundImage:`url(${t==null?void 0:t.attachment})`},onClick:()=>{var e,i,o;if(t!=null&&t.attachment)return c({...t,attachment:null});u.Gallery.set({allowExternal:(o=(i=(e=C)==null?void 0:e.value)==null?void 0:i.AllowExternal)==null?void 0:o.Pages,onSelect:n=>c({...t,attachment:n.src})})},children:!(t!=null&&t.attachment)&&a(H,{})})})}),l("div",{className:"item",children:[a("div",{className:"title",children:s("APPS.YELLOWPAGES.PRICE")}),a(O,{type:"number",placeholder:"0",onChange:e=>{if(!e.target.value.match(/^[0-9]*$/))return e.preventDefault();c({...t,price:!isNaN(parseFloat(e.target.value))&&parseFloat(e.target.value)})}})]}),a("div",{className:"button",onClick:()=>A(),children:s("APPS.YELLOWPAGES.POST")})]})]})})]})}export{se as default};
