import{a as e,ai as Le,r,E as ie,p as E,q as h,j as o,w as _e,L as i,b2 as ze,a9 as oe,C as W,cz as be,_ as le,m as se,cA as Ue,N as Te,I as he,aw as Ye,ce as De,ac as Se,ad as Pe,a3 as Ne,J as ge,ct as Fe,cB as ye,bb as Ce,Q as Ie,a7 as Ae,F as q,d as ce,a4 as qe,$ as je,cr as Re,u as me,A as ve,aU as Ve,cC as Je,cD as Me,b0 as Xe,P as re,T as xe,S as Ge,b as fe,s as te,cE as Qe,cF as et,cG as tt,cm as nt,az as ke,am as it,an as st,be as Be,aA as ot,aB as at,a6 as rt,bX as lt,ch as ct,c1 as dt,ci as ut,cw as Ke,cH as mt,b_ as ft,cI as ht,cJ as Tt,cv as vt,bk as Pt}from"./index-d0bf63a9.js";import{T as We}from"./Textarea-26d983f9.js";import{S as gt}from"./Switch-83dad044.js";import{S as pt}from"./Slider-16091e71.js";function de(){return e("div",{className:"checkmark",children:e(Le,{})})}const $={Account:{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},Accounts:[{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,video_count:2,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},{name:"Breze",username:"breze",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"breze",instagram:"breze",isFollowing:!0,following:["lb"],followers:["lb"]},{name:"Loaf Scripts",username:"loaf",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"loaf",instagram:"loaf",isFollowing:!0,following:["lb"],followers:["lb"]}],Videos:[{id:"1",caption:"Trippy vibes",src:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",views:532,likes:16,comments:1,saves:1,commentsData:[{id:"1",username:"lb",name:"LB",verified:!0,avatar:"https://docs.lbscripts.com/images/icons/icon.png",comment:"First comment!",creator_liked:1,likes:1,liked:1,timestamp:Date.now()-1e3*60*60*2}],timestamp:Date.now()-1e3*60*60*8,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0},{id:"2",caption:"Car spotting in Los Santos",src:"https://r2.fivemanage.com/video/0NNIBeGAfx5J.mp4",views:1445,likes:123,comments:0,saves:3,commentsData:[],timestamp:Date.now()-1e3*60*60*24,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0}],Messages:[{id:"1",username:"breze",name:"Breze",verified:!0,last_message:"hey",unread_messages:1,following_count:12,follower_count:123,messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,last_message:"yoo, that vid was fire",unread_messages:0,following_count:4,follower_count:3,messages:[{id:"3",sender:"loaf",content:"yoo, that vid was fire",timestamp:Date.now()-1e3*60*60*8},{id:"1",sender:"lb",video:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",videoId:"1",timestamp:Date.now()-1e3*60*60*13}],timestamp:Date.now()-1e3*60*60*8}],Notifications:[{type:"like",username:"loaf",name:"Loaf Scripts",videoId:"1",videoSrc:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,followsYou:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function He(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function St(){const{User:t}=r.useContext(B),[m]=t,[T,S]=r.useState(""),[I,g]=r.useState(""),[u,l]=r.useState([]),[a,C]=r.useState([]),[n,s]=r.useState(0),[P,L]=r.useState(!1),[y,_]=r.useState(0),[d,v]=r.useState(!1),[N,b]=r.useState(!1);r.useEffect(()=>{ie("TikTok")&&E("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0},$.Videos).then(O=>{if(!O)return h("warning","Failed to get videos");C(O)})},[]),r.useEffect(()=>{T.length>0&&E("TikTok",{action:"searchAccounts",query:T},$.Accounts.filter(O=>O.username.includes(T))).then(O=>{if(!O)return h("info","No response, most likely no accounts to search for?");l(O)}),_(0),b(!1)},[T]),r.useEffect(()=>{const O=setTimeout(()=>S(I),500);return()=>clearTimeout(O)},[I]);const U=()=>{let O=T.length===0;if(O&&P)return h("info","Fetched everything, no need to fetch more (VIDEOS)");if(!O&&N)return h("info","Fetched everything, no need to fetch more (SEARCH)");if(d)return h("info","Already fetching");let F=document.querySelector("#last");if(!F)return h("warning","No last element");!ze(F)&&(v(!0),E("TikTok",{action:O?"getVideos":"searchAccounts",query:T,data:{full:!0,type:"recent"},page:(O?n:y)+1},null).then(w=>{w&&w.length>0?(O?C(f=>[...f,...w]):l(f=>[...f,...w]),v(!1)):(v(!1),O?L(!0):b(!0))}),O?s(w=>w+1):_(w=>w+1))};return o("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(_e,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:O=>g(O.target.value)})}),T.length>0?e("div",{className:"search-results",onScroll:U,children:u==null?void 0:u.filter(O=>O.username!==m.username).map((O,F)=>e(Ct,{data:O,last:u.length-1===F},F))}):e("div",{className:"discover-content",onScroll:U,children:a.map((O,F)=>e(It,{data:O,last:a.length-1===F},F))})]})}const Ct=({data:t,last:m})=>{const{User:T,Func:S,GoBack:I}=r.useContext(B),[g,u]=I,[l,a]=r.useState(t.isFollowing),C=n=>{E("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},!0).then(s=>{if(!s||!(s!=null&&s.success))return h("warning","Failed to toggle follow");if(s.error)return h("error",s.error);a(n)})};return o("div",{className:"item",id:m?"last":"",onClick:()=>{u({view:"discover"}),S.fetchAndSetProfile(t.username)},children:[o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:Z(t.avatar)})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.username,t.verified&&e(de,{})]}),e("div",{className:"username",children:t.name}),o("div",{className:"stats",children:[z(t.followers)," ",i("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",z(t.videos)??"0"," ",i("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:oe("button",l?"following":"follow"),onClick:n=>{n.stopPropagation(),l?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>C(!1)}]}):C(!0)},children:l?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})},It=({data:t,last:m})=>{const{Func:T,GoBack:S}=r.useContext(B),[I,g]=S;return o("div",{className:"item",id:m?"last":"",onClick:()=>{T.fetchAndSetVideo(t.id,{type:"recent"}),g({view:"discover"})},children:[o("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:u=>u.currentTarget.play().catch(()=>{}),onMouseLeave:u=>u.currentTarget.pause(),muted:!0}),e("div",{className:"timestamp",children:pe(t.timestamp)})]}),o("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),o("div",{className:"video-info",children:[o("div",{className:"user",onClick:u=>{u.stopPropagation(),g({view:"discover"}),T.fetchAndSetProfile(t.username)},children:[e("img",{src:Z(t.avatar)}),e("div",{className:"name",children:t.username})]}),o("div",{className:"stats",children:[o("div",{children:[e(be,{className:"plays"}),z(t.views)]}),o("div",{children:[e(He,{}),z(t.likes)]})]})]})]})]})};function Nt(){const{User:t,View:m,Dm:T}=r.useContext(B),[S,I]=m,[g,u]=T,[l,a]=r.useState(!1),[C,n]=r.useState([]);return r.useEffect(()=>{ie("TikTok")&&E("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(s=>{if(!(s!=null&&s.success))return h("warning",s.error);n(s.channels)})},[]),le("tiktok:receivedMessage",s=>{n(P=>{let L=P.findIndex(_=>_.channelId===s.channelId);if(L===-1)return P;let y=[...P];return y[L].lastMessage=s.content,y[L].lastMessageTimestamp=Date.now(),y})}),o(se.div,{...Ue,className:"messages-container",children:[e(Te,{children:l&&e(Ot,{close:()=>a(!1)})}),o("div",{className:"dmmessages-header",children:[e(he,{onClick:()=>I("inbox")}),e("div",{className:"title",children:i("APPS.TIKTOK.DIRECT_MESSAGES")}),e(Ye,{onClick:()=>a(!0)})]}),o("div",{className:"messages-body",children:[C.length===0&&o("div",{className:"no-messages",children:[e(De,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),C.map((s,P)=>o("div",{className:"message","data-unread":s.unread_messages>0,onClick:()=>{u({id:s.id,name:s.name,username:s.username,avatar:s.avatar,verified:s.verified,follower_count:s.follower_count,following_count:s.following_count,video_count:s.video_count}),s.unread_messages>0&&E("TikTok",{action:"clearUnreadMessages",id:s.id}),I("dm")},children:[o("div",{className:"user",children:[e("img",{src:Z(s.avatar)}),o("div",{className:"message-content",children:[e("div",{className:"username",children:s.name}),e("div",{className:"content",children:s.last_message})]})]}),e("div",{className:"timestamp",children:Se(s.timestamp)})]},P))]})]})}const Ot=({close:t})=>{const{User:m}=r.useContext(B),[T]=m,[S,I]=r.useState(""),[g,u]=r.useState(""),[l,a]=r.useState([]);r.useEffect(()=>{const n=setTimeout(()=>I(g),500);return()=>clearTimeout(n)},[g]),r.useEffect(()=>{S.length>0&&E("TikTok",{action:"searchAccounts",query:S},{success:!0,accounts:$.Accounts}).then(n=>{if(!n)return h("info","No response, most likely no accounts to search for?");a(n)})},[S]);const C=n=>{};return o(se.div,{...Pe,className:"search-container",children:[o("div",{className:"search-header",children:[e(Ne,{onClick:t}),e(_e,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>u(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:C,children:l==null?void 0:l.filter(n=>n.username!==T.username).map((n,s)=>e(wt,{data:n,last:l.length-1===s},s))})]})},wt=({data:t,last:m})=>{const{View:T,Dm:S}=r.useContext(B),[I,g]=T,[u,l]=S;return e("div",{className:"item",id:m?"last":"",onClick:()=>{l({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),g("dm")},children:o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:Z(t.avatar)})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.username,t.verified&&e(de,{})]}),e("div",{className:"username",children:t.name}),o("div",{className:"stats",children:[z(t.follower_count)," ",i("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",z(t.video_count)??"0"," ",i("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]})})};function $e({className:t}){return o("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function Oe({className:t}){return o("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function At(){const{View:t}=r.useContext(B),[m,T]=t,[S,I]=r.useState([]),[g,u]=r.useState(0);r.useEffect(()=>{ie("TikTok")&&(E("TikTok",{action:"getUnreadMessages"},{success:!0,unread:1}).then(a=>{if(!a.success)return h("warning","Failed to get unread messages: "+a.error);u(a==null?void 0:a.unread)}),E("TikTok",{action:"getNotifications",page:0},{success:!0,data:$.Notifications}).then(a=>{if(!a.success)return h("warning","Failed to get notifications: "+a.error);I(a.data)}))},[]);const{handleScroll:l}=ge({fetchData:a=>E("TikTok",{action:"getNotifications",page:a}),onDataFetched:a=>()=>{if(!(a!=null&&a.success))return h("warning","Failed to get notifications: "+a.error);if(!(a!=null&&a.data))return h("warning","Failed to get notifications: (NO DATA)"+(a==null?void 0:a.error));I([...S,...a.data])},perPage:25});return o("div",{className:"inbox-container",children:[o("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:i("APPS.TIKTOK.ALL_ACTIVITY")}),o("div",{className:"messages",onClick:()=>T("messages"),children:[e(Fe,{}),g>0&&e("div",{className:"notifications",children:g})]})]}),o("div",{className:"inbox-body",onScroll:l,children:[S.length===0&&o("div",{className:"no-notifications",children:[e(ye,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),S.map((a,C)=>e(kt,{data:a},C))]})]})}const kt=({data:t})=>{const{Func:m,GoBack:T}=r.useContext(B),[S,I]=T,[g,u]=r.useState(t.isFollowing),l=n=>{E("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},{success:!0}).then(s=>{if(!s||!(s!=null&&s.success))return h("warning","Failed to toggle follow");if(s.error)return h("error",s.error);u(n)})};let a;switch(t.type){case"follow":a=i("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":a=i("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":a=i("APPS.TIKTOK.LIKED_COMMENT");break;case"save":a=i("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":a=i("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":a=i("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const C=()=>{I({view:"inbox"}),m.fetchAndSetProfile(t.username)};return o("div",{className:oe("notification",t.type),children:[o("div",{className:"user",children:[o("div",{className:"avatar",onClick:C,children:[e("img",{src:Z(t.avatar)}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(Oe,{}):e($e,{})})]}),o("div",{className:"info",children:[o("div",{className:"username",onClick:C,children:[t.name,t.verified&&e(de,{})]}),o("div",{className:"notification-content",children:[a,e("div",{className:"timestamp",children:pe(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&o("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:oe("button",g?"following":"follow"),onClick:n=>{n.stopPropagation(),g?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>l(!1)}]}):l(!0)},children:g?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(I({view:"inbox"}),m.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function Kt(){const{User:t,GoBack:m,View:T,Func:S,Dm:I,Profile:g}=r.useContext(B),[u,l]=t,[a,C]=T,[n]=I,[s,P]=m,[L,y]=g,[_,d]=r.useState([]),[v,N]=r.useState(n==null?void 0:n.id),b=r.useRef(null),[U,O]=r.useState("");r.useState(0),r.useState(!1),r.useState(!1),r.useEffect(()=>(Ce.ReceiveAppNotifications.set(!1),()=>{Ce.ReceiveAppNotifications.set(!0)}),[]),r.useEffect(()=>{var c;v&&E("TikTok",{action:"getMessages",page:0,id:v},{success:!0,messages:(c=$.Messages.find(K=>K.id===v))==null?void 0:c.messages}).then(K=>{if(!(K!=null&&K.success))return h("warning","An error occured while fetching messages. "+(K==null?void 0:K.error));if(!(K!=null&&K.messages))return h("warning","An error occured while fetching messages. (No messages)");d(K.messages.reverse())})},[v]),le("tiktok:receivedMessage",c=>{n.username===c.sender&&d([..._,{...c,timestamp:new Date().getTime()}])});const F=()=>{var c;if(U.trim().length===0)return h("warning","You can't send an empty message");E("TikTok",{action:"sendMessage",data:{id:v,username:n.username,content:U}},{success:!0,id:"3",channelId:(c=$.Messages.find(K=>K.id===v))==null?void 0:c.id}).then(K=>{if(!(K!=null&&K.success))return h("warning","An error occured while sending message. "+(K==null?void 0:K.error));h("info",`Message sent to ${n.username}, id: ${K.id}, channelId: ${K==null?void 0:K.channelId}`),K!=null&&K.channelId&&!v&&N(K.channelId),b.current.value="",d([..._,{id:K.id,sender:u.username,recipient:n.username,content:U,timestamp:new Date().getTime()}]),O("");let R=document.querySelector(".dm-body");R.scrollTop=R.scrollHeight})},{handleScroll:k}=ge({fetchData:c=>E("Instagram",{action:"getMessages",username:n.username,page:c}),onDataFetched:c=>d([...c.reverse(),..._]),perPage:25}),w=c=>{if(c)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(c)},f=c=>{S.fetchAndSetVideo(c,{single:!0}),P({view:"dm"})};return o(se.div,{...Ue,className:"dm-container",children:[o("div",{className:"dm-header",children:[e(he,{onClick:()=>{s!=null&&s.view?(s.data&&s.data.identifier==="profile"&&y(s.data.data),C(s.view),P(null)):C("messages")},className:"chevron"}),o("div",{className:"profile",onClick:c=>{c.stopPropagation(),P({view:"dm",data:{identifier:"dm",data:n}}),S.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e("img",{src:Z(n.avatar)})}),o("div",{className:"username",children:[n.name??n.username,n.verified&&e(de,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:k,children:o("div",{className:"dm-body",children:[o("div",{className:"messages-hero","data-nomessages":_.length===0,children:[e("img",{className:"avatar",src:Z(n.avatar)}),e("div",{className:"name",children:n.name}),o("div",{className:"secondary",children:[o("div",{className:"username",children:["@",n.username]}),o("div",{className:"stats",children:[o("div",{className:"following",children:[z(n.following_count)," ",i("APPS.TIKTOK.FOLLOWING").toLowerCase()]}),o("div",{className:"followers",children:[z(n.follower_count)," ",i("APPS.TIKTOK.FOLLOWERS").toLowerCase()]})]})]})]}),_.map((c,K)=>{var X;let R,G=c.sender===u.username?"self":"other",x=((X=_[K+1])==null?void 0:X.sender)===u.username?"self":"other";return _[K+1]?R=Math.abs(c.timestamp-_[K+1].timestamp)/36e5:x=void 0,c.content&&w(c.content)&&(c.video=c.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],c.videoId=c.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),o("div",{className:oe("message",G),children:[G=="other"?o("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${G!==x?"show":"hide"}`,onClick:j=>{j.stopPropagation(),P({view:"dm",data:{identifier:"dm",data:n}}),S.fetchAndSetProfile(n.username)},children:e("img",{src:Z(n.avatar)})}),e("div",{className:"message-content",children:c.video?o("div",{className:"shared-video",onClick:()=>f(c.videoId),children:[e("video",{src:c.video,autoPlay:!1,controls:!1}),e(Ie,{})]}):e("div",{className:"content",children:Ae(c.content)})})]}):e(q,{children:c.video?o("div",{className:"shared-video",onClick:()=>f(c.videoId),children:[e("video",{src:c.video,autoPlay:!1,controls:!1}),e(Ie,{})]}):e("div",{className:"content",children:Ae(c.content)})}),_[K+1]&&R>6?e("div",{className:"date",children:Se(c.timestamp)}):G!==x&&e("div",{className:"date",children:Se(c.timestamp)})]},K)})]})}),e("div",{className:"dm-footer",children:o("div",{className:"input",children:[e(ce,{type:"text",placeholder:i("APPS.DARKCHAT.INPUT_PLACEHOLDER"),ref:b,onChange:c=>O(c.target.value),onKeyDown:c=>{c.key==="Enter"&&F()}}),e("div",{className:"buttons",children:U.trim().length>0&&e("div",{className:"send",onClick:F,children:e(qe,{})})})]})})]})}function Et(){return o("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function Lt({id:t,commentCount:m,username:T,close:S}){const{User:I}=r.useContext(B),[g]=I,[u,l]=r.useState([]),[a,C]=r.useState(""),[n,s]=r.useState(null),P=r.useRef(null),L=r.useRef(null);r.useEffect(()=>{var d;ie("TikTok")&&E("TikTok",{action:"getComments",page:0,data:{id:t,creator:T}},{success:!0,comments:(d=$.Videos.find(v=>v.id===t))==null?void 0:d.commentsData}).then(v=>{if(!(v!=null&&v.success))return h("warning",v.error);l(v.comments)})},[]);const y=()=>{if(a.trim().length===0)return h("warning","Comment is empty");let d=n!=null&&n.isReplyToReply?`@${n.name} ${a}`:a;E("TikTok",{action:"postComment",data:{id:t,comment:d,replyTo:n==null?void 0:n.id}},{success:!0,id:Math.floor(Math.random()*100)}).then(v=>{if(!(v!=null&&v.success))return h("warning",v.error);l(n?N=>N.map(b=>b.id==n.id?{...b,reply_count:b!=null&&b.reply_count?b.reply_count+1:1,replies:[{id:v.id,username:g.username,avatar:g.avatar,comment:d,timestamp:new Date().getTime(),likes:0,liked:!1,verified:g.verified},...(b==null?void 0:b.replies)||[]]}:b):N=>[{id:v.id,username:g.username,avatar:g.avatar,comment:d,timestamp:new Date().getTime(),likes:0,liked:!1,verified:g.verified},...N]),C(""),L.current.style.height="auto",s(null)})},{handleScroll:_}=ge({fetchData:d=>E("TikTok",{action:"getComments",data:{id:t,creator:T},page:d}),onDataFetched:d=>l(v=>[...v,...(d==null?void 0:d.comments)??[]]),perPage:15});return r.useEffect(()=>{const d=v=>{const N=P.current;N.scrollTo({top:N.scrollTop+v.deltaY,behavior:"smooth"})};return P.current&&P.current.addEventListener("wheel",d),()=>{P.current&&P.current.removeEventListener("wheel",d)}},[P]),e("div",{className:"comments-container",onClick:()=>S(),children:o(se.div,{...Pe,className:"comments-wrapper",onClick:d=>d.stopPropagation(),children:[o("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:i("APPS.TIKTOK.COMMENTS_TITLE").format({count:m})}),e("div",{className:"close",children:e(Ne,{onClick:S})})]}),e("div",{className:"comments-body",ref:P,onScroll:_,children:u.map((d,v)=>e(Ze,{comment:d,videoId:t,username:T,remove:()=>l(N=>N.filter(b=>b.id!=d.id)),setReplyTo:s},d.id))}),o("div",{className:"comments-footer",children:[e("img",{src:Z(g.avatar)}),o("div",{className:"input",children:[e(ce,{maxLength:300,ref:L,value:a,onChange:d=>{C(d.target.value);let v=d.target.scrollHeight;d.target.style.height=v+"px"},onKeyDown:d=>{d.key=="Enter"&&y(),d.key==" "&&C(v=>v+" ")},placeholder:n?i("APPS.TIKTOK.REPLY_TO").format({name:n.name}):i("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{W.Emoji.set({onSelect:d=>C(v=>v+d.emoji)})},children:e(Et,{})}),a.trim().length>0&&e("span",{children:e(De,{onClick:y})})]})]})]})})}const Ze=({videoId:t,username:m,comment:T,remove:S,setReplyTo:I})=>{var O,F,k;const{User:g}=r.useContext(B),[u]=g,[l,a]=r.useState(T),[C,n]=r.useState(l.likes),[s,P]=r.useState(l.liked===1),[L,y]=r.useState(l.creator_liked===1);r.useState(0),r.useState(!1),r.useState(!1);const[_,d]=r.useState(!1);r.useEffect(()=>{T&&a(T)},[T]);const v=()=>{E("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:l.id,creator:m}},null).then(w=>{if(!(w!=null&&w.success))return h("warning",w.error);a(f=>({...f,replies:[...(f==null?void 0:f.replies)??[],...w.comments.filter(c=>f!=null&&f.replies?!f.replies.some(K=>K.id===c.id):!0)]})),d(!0)})},N=()=>{E("TikTok",{action:"toggleLikeComment",id:l.id,toggle:!s},{success:!0}).then(w=>{if(!(w!=null&&w.success))return h("warning",w.error);u.username===m&&y(f=>!f),P(f=>!f),a(f=>({...f,liked:!f.liked}))})};le("tiktok:updateCommentLikes",w=>{w.id===l.id&&n(f=>w.method==="add"?f+1:f-1)});let b=l.username!==u.username||m!==l.username||u.isAdmin;const U=je(w=>{if(w.stopPropagation(),w.preventDefault(),!b)return h("warning","You cannot click to this comment!");let f=[(u.isAdmin||u.username===l.username)&&{title:i("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{E("TikTok",{action:"deleteComment",id:l.id,videoId:t}).then(c=>{if(!(c!=null&&c.success))return h("warning",c.error);S()})}}];W.ContextMenu.set({buttons:f})});return o("div",{className:"item","data-clickable":b,"data-id":l.id,children:[o("div",{className:"comment-info",...U,children:[e("div",{className:"avatar",children:e("img",{src:Z(l.avatar)})}),o("div",{className:"comment-data",children:[o("div",{className:"username",children:[l.username,l.verified&&e(de,{}),l.username===m&&e("div",{className:"creator-badge",children:i("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:l.comment}),o("div",{className:"actions",children:[e("div",{className:"timestamp",children:pe(l.timestamp)}),e("div",{className:"reply",onClick:()=>{I(()=>({id:l.replyTo??l.id,name:l.username,isReplyToReply:l.replyTo!==void 0}))},children:i("APPS.TIKTOK.REPLY")})]}),L&&e("div",{className:"creator-liked",children:i("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(l.reply_count>0||l.replies)&&o("div",{className:"replies",children:[(O=l.replies)==null?void 0:O.map(w=>e(Ze,{videoId:t,username:m,comment:{...w,replyTo:l.id},remove:()=>{a(f=>{var c;return{...f,reply_count:f.reply_count-1,replies:(c=f.replies)==null?void 0:c.filter(K=>K.id!==w.id)}})},setReplyTo:I})),!_&&((F=l.replies)==null?void 0:F.length)!==l.reply_count&&o("div",{className:"view-replies",onClick:v,children:[i("APPS.TIKTOK.VIEW_REPLIES")," ",o("b",{children:["(",l!=null&&l.replies?l.reply_count-(((k=l.replies)==null?void 0:k.length)??0):l.reply_count,")"]})," ",e(Re,{})]})]}),o("div",{className:"likes","data-active":s,onClick:N,children:[s?e(Oe,{}):e(He,{}),z(C)]})]})};function _t({className:t}){return o("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function we({data:t,active:m,preview:T}){var D,Y,ne;const{User:S,Func:I,ShareComponent:g,GoBack:u}=r.useContext(B),l=me(re.Settings),[a]=S,[C,n]=g,[s,P]=r.useState(t==null?void 0:t.liked),[L,y]=r.useState(t==null?void 0:t.saved),[_,d]=r.useState(t==null?void 0:t.viewed),[v,N]=r.useState(t==null?void 0:t.likes),[b,U]=r.useState(t==null?void 0:t.saves),[O,F]=r.useState(t==null?void 0:t.comments),[k,w]=r.useState(!1),f=r.useRef(null),c=r.useRef(null),K=r.useRef(0),[R,G]=r.useState(!1),[x,X]=r.useState(!1),j=me(xe),ae=me(ve),ue=me(Ce.LockScreenVisible);r.useEffect(()=>{var p,M;return m&&((p=t.music)!=null&&p.path&&H(),(M=t.metadata)!=null&&M.tts&&V()),()=>{f!=null&&f.current&&f.current.pause(),c!=null&&c.current&&c.current.pause(),_||E("TikTok",{action:"setViewed",id:t.id},!0).then(()=>{d(!0)})}},[m]),r.useEffect(()=>{var p,M,ee;j!=null&&j.visible||!ie("TikTok")||ue?(X(!0),f!=null&&f.current&&f.current.pause(),c!=null&&c.current&&c.current.pause()):((ee=(M=(p=ve)==null?void 0:p.value)==null?void 0:M.active)==null?void 0:ee.name)==="TikTok"&&(X(!1),f!=null&&f.current&&f.current.play().catch(()=>h("warning","TTS failed to play")),c!=null&&c.current&&c.current.play().catch(()=>h("warning","Music failed to play")))},[j==null?void 0:j.visible,ae==null?void 0:ae.active,ue]);const V=()=>{var M;if(!t.metadata.ttsUrl)return;f!=null&&f.current&&(f.current.pause(),f.current=null);const p=new Audio;p.src=t.metadata.ttsUrl,p.volume=(((M=l==null?void 0:l.sound)==null?void 0:M.volume)??.5)/2,p.play().catch(()=>h("warning","TTS failed to play")),f.current=p},H=()=>{var M,ee;const p=new Audio;c!=null&&c.current&&(c.current.pause(),c.current=null),p.src=(M=t.music.path)!=null&&M.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,p.volume=t.music.volume*(((ee=l==null?void 0:l.sound)==null?void 0:ee.volume)??1),p.play().catch(()=>h("warning","Music failed to play")),c.current=p};r.useEffect(()=>{var p,M,ee;(p=l==null?void 0:l.sound)!=null&&p.volume&&(c!=null&&c.current&&(c.current.volume=t.music.volume*(((M=l==null?void 0:l.sound)==null?void 0:M.volume)??1)),f!=null&&f.current&&(f.current.volume=(((ee=l==null?void 0:l.sound)==null?void 0:ee.volume)??.5)/2))},[(D=l==null?void 0:l.sound)==null?void 0:D.volume]);const Q=()=>{T||E("TikTok",{action:"toggleLike",id:t.id,toggle:!s},{success:!0}).then(p=>{if(!p.success)return h("warning",p.error);P(!s)})},J=()=>{T||-E("TikTok",{action:"toggleSave",id:t.id,toggle:!L},{success:!0}).then(p=>{if(!p.success)return h("warning",p.error);y(!L)})};le("tiktok:updateLikes",p=>{if(p&&p.id===t.id)return N(M=>M+(p.method==="add"?1:-1))}),le("tiktok:updateSaves",p=>{if(p&&p.id===t.id)return U(M=>M+(p.method==="add"?1:-1))}),le("tiktok:updateComments",p=>{if(p&&p.id===t.id)return F(M=>(p.count=p.count??1,M+(p.method==="add"?p.count:-p.count)))});const A=p=>{if(p.detail===1)return X(!x);if(p.detail===2){if(!t.id)return;s||(Q(),G(!0),setTimeout(()=>{G(!1)},1e3))}};return r.useEffect(()=>{const p=document.querySelector(".video video");p&&(x?(p.pause(),f!=null&&f.current&&f.current.pause(),c!=null&&c.current&&c.current.pause(),h("info","paused everything")):(p.play().catch(()=>h("warning","Video failed to play")),f!=null&&f.current&&f.current.play().catch(()=>h("warning","TTS failed to play")),c!=null&&c.current&&c.current.play().catch(()=>h("warning","Music failed to play")),h("info","playing everything")))},[x]),o(q,{children:[e(Te,{children:k&&!T&&e(Lt,{id:t.id,username:t.username,commentCount:O,close:()=>w(!1)})}),o("div",{className:"video","data-active":m,onClick:A,children:[R&&e("div",{className:"popup-heart","data-visible":R,children:e(Ve,{})}),x&&e("div",{className:"paused",children:e(Ie,{})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!m,onTimeUpdate:p=>{var M,ee;m&&(p.target.currentTime<K.current&&((M=t==null?void 0:t.music)!=null&&M.path&&H(),(ee=t==null?void 0:t.metadata)!=null&&ee.ttsUrl&&(f.current.currentTime=0,f.current.play().catch(()=>h("warning","TTS failed to play")))),K.current=p.target.currentTime)}}),o("div",{className:"video-info",children:[o("div",{className:"user",children:[o("div",{className:"username",onClick:()=>{if(!T)return I.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(de,{})]}),o("span",{children:[" • ",pe(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((Y=t==null?void 0:t.music)==null?void 0:Y.title)&&o("div",{className:"song",children:[e(Je,{})," ",t.music.artist," - ",t.music.title]})]}),o("div",{className:"video-actions",children:[e("img",{className:"profile",src:Z(t.avatar),onClick:p=>{if(p.stopPropagation(),!T)return I.fetchAndSetProfile(t.username)}}),o("div",{className:"action","data-active":s,onClick:p=>{p.stopPropagation(),Q()},children:[e(Oe,{className:"like"}),z(v)]}),o("div",{className:"action",onClick:p=>{p.stopPropagation(),w(!0)},children:[e($e,{className:"comment"}),z(O)]}),o("div",{className:"action",onClick:p=>{p.stopPropagation(),J()},"data-active":L,children:[e(Me,{className:"save"}),z(b)]}),e("div",{className:"action",onClick:p=>{p.stopPropagation(),n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(a==null?void 0:a.username)===t.username?e(Xe,{className:"manage"}):o(q,{children:[e(_t,{className:"share"}),i("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e("img",{src:((ne=t==null?void 0:t.music)==null?void 0:ne.cover)??"./assets/img/icons/music/unknown.png"})})]})]})]})}function Ee(){var ue;const{View:t,Profile:m,FeedData:T,Func:S,GoBack:I}=r.useContext(B),g=me(re.Settings),[u,l]=t,[a,C]=T,[n,s]=I,[P,L]=r.useState(0),[y,_]=r.useState(!1),[d,v]=r.useState(!1),[N,b]=r.useState("recent"),[U,O]=r.useState([]),[F,k]=r.useState(0),w=me(ve),f=r.useRef(null);r.useEffect(()=>{var V;if(ie("TikTok")){if(u!=="feed"){c.current=!0;return}return L(0),v(!1),_(!1),O([]),(V=a==null?void 0:a.args)!=null&&V.single?(O([a.video]),k(0),R.current=0):E("TikTok",{action:"getVideos",page:0,data:{full:!0,type:N,...a==null?void 0:a.args}},$.Videos).then(H=>{if(!H)return h("warning","No videos found");H.length<5&&v(!0),a&&(a!=null&&a.video)&&H.unshift(a.video),k(0),R.current=0,O(H)}),()=>{C(null)}}},[u]),r.useEffect(()=>{if(ie("TikTok")&&u==="feed")return setTimeout(()=>{re.Styles.TextColor.set("#ffffff")},100),()=>{re.Styles.TextColor.set(g.display.theme==="dark"?"#ffffff":"#000000"),re.SoundManager.reset()}},[u,w==null?void 0:w.active]);const c=r.useRef(!0);r.useEffect(()=>{if(ie("TikTok")&&!a){if(c.current){c.current=!1;return}O([]),E("TikTok",{action:"getVideos",page:0,data:{full:!0,type:N}},$.Videos).then(V=>{if(!V)return h("warning","No videos found");V.length<5&&v(!0),O(V),R.current=0,k(0)})}},[N,a]);const K=r.useRef(!1),R=r.useRef(0);r.useEffect(()=>{R.current=0,k(0),L(0),v(!1),_(!1)},[N]),r.useEffect(()=>{if(ie("TikTok")){if(U.length===0)return h("info","No videos found");if(U.length===1||U.length-2===F){if(h("info","fetching more videos: "+JSON.stringify(a)),a!=null&&a.single)return;if(y||d)return h("info","Already fetching or fetched everything");_(!0),E("TikTok",{action:"getVideos",page:P+1,data:{full:!0,type:N,...a==null?void 0:a.args}},null).then(V=>{V&&V.length>0?(V.length<5&&v(!0),O(H=>[...H,...V]),_(!1)):(h("info","Fetched everything"),_(!1),v(!0)),L(H=>H+1)})}}},[F]),r.useEffect(()=>{if(!U||U.length===0)return;const V=()=>{if(!K.current)return requestAnimationFrame(V);K.current=!1;const D=f.current,ne=document.querySelector(".video").getBoundingClientRect().height,p=R.current*ne;h("info",`Target scroll position: ${p}, current scroll position: ${D.scrollTop}, snapIndex: ${R.current}`),D.scrollTo({top:p,behavior:"smooth"}),k(R.current),requestAnimationFrame(V)};requestAnimationFrame(V);const H=D=>{var Y,ne;D.preventDefault(),!((ne=(Y=xe)==null?void 0:Y.value)!=null&&ne.visible)&&G(D)},Q=["ArrowUp","ArrowDown","Space"],J=D=>{var Y;(Q.includes(D.key)||Q.includes(D.code))&&!document.querySelector(".tiktok-content")&&((Y=w==null?void 0:w.active)==null?void 0:Y.name)==="TikTok"&&D.preventDefault(),(D.key==="ArrowUp"||D.key==="ArrowDown")&&x(D.key==="ArrowUp"?-1:1)},A=f.current;return A.addEventListener("wheel",H,{passive:!1}),window.addEventListener("keydown",J),()=>{h("info","Removing event listeners (space button)"),A.removeEventListener("wheel",H),window.removeEventListener("keydown",J)}},[U]);const G=V=>{if(V.preventDefault(),j())return;const Q=V.deltaY<0?-1:1;x(Q)},x=V=>{const Q=U.length-1,J=R.current+V;J>=0&&J<=Q?(R.current=J,K.current=!0,h("info","Scrolling to video: "+R.current)):J<0?h("info","Top of the feed, trying to scroll up?"):h("info","Reached the bottom of the feed")},X=V=>{V.button===1&&V.preventDefault()},j=()=>!!document.querySelector(".comments-container");let ae=u==="feed";return e("div",{className:"tiktok-feed",style:{visibility:ae?"visible":"hidden"},children:o(se.div,{className:"feed-wrapper",...Ge("right",u),children:[!a&&e("div",{className:"feed-header",children:o("div",{className:"feed-header-content",children:[e("div",{className:oe("item",N=="following"&&"active"),onClick:()=>b("following"),children:i("APPS.TIKTOK.FOLLOWING")}),e("div",{className:oe("item",N=="recent"&&"active"),onClick:()=>b("recent"),children:i("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":N==="recent"?"right":"left"})]})}),N==="following"&&U.length===0&&e("div",{className:"no-following",children:i("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((ue=a==null?void 0:a.args)==null?void 0:ue.username)||(n==null?void 0:n.view))&&e(he,{className:"go-back",onClick:()=>{C(null),n!=null&&n.view&&!(n!=null&&n.ignoreFeed)?(l(n.view),s(null)):S.fetchAndSetProfile(a.args.username)}}),e("div",{className:"videos",ref:f,onMouseDown:X,children:U==null?void 0:U.map((V,H)=>e(we,{data:V,active:F===U.indexOf(V)&&ae},H))})]})})}function bt(){const{User:t,LoggedIn:m,View:T}=r.useContext(B),[S,I]=t,[g,u]=m,[l,a]=T,[C,n]=r.useState("login"),[s,P]=r.useState(null),[L,y]=r.useState(!0),_=()=>{if(L)return h("warning","Button is disabled");if(!s)return h("warning","No form data");let d=s==null?void 0:s.username.toLowerCase().replace(/\s/g,"");if(C==="signup"){let v=d.match(fe.value.UsernameFilter);if(!v||(v==null?void 0:v[0])!==d||d.length<3||d.length>15){h("warning","Username did not match regex"),W.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});return}}E("TikTok",{action:C,data:s}).then(v=>{var N,b,U,O,F,k;if(!v)return h("warning","Could not login, no response");if(v.success){let w={...v.data,username:((N=v.data)==null?void 0:N.username)??d,name:((b=v.data)==null?void 0:b.username)??(s==null?void 0:s.name),follower_count:((U=v.data)==null?void 0:U.follower_count)||0,following_count:((O=v.data)==null?void 0:O.following_count)||0,like_count:((F=v.data)==null?void 0:F.like_count)||0};I(w),u(!0),a("feed"),te.APPS.TIKTOK.account.set(w)}else{if(v.error)return W.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i(`APPS.INSTAGRAM.${(k=v.error)==null?void 0:k.toUpperCase()}`),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});h("info",`Could not login, ${v.error}`)}})};return r.useEffect(()=>{var d,v;s&&y(C==="login"?!s.username||!s.password:!s.name||!s.username&&((d=s.username)==null?void 0:d.length)<3||!s.password&&((v=s.password)==null?void 0:v.length)<3)},[s]),o("div",{className:"login-container",children:[o("div",{className:"login-header",children:[e("div",{className:"title",children:C==="login"?i("APPS.TIKTOK.LOGIN_TITLE"):i("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:C==="login"?i("APPS.TIKTOK.LOGIN_SUBTITLE"):i("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),o("div",{className:"login-body",children:[C==="signup"&&e(ce,{placeholder:i("APPS.TIKTOK.NAME"),onChange:d=>{d.target.value.length>30||P({...s,name:d.target.value})}}),e(ce,{placeholder:i("APPS.TIKTOK.USERNAME"),onChange:d=>{d.target.value.length>20||P({...s,username:d.target.value.toLowerCase()})}}),e(ce,{type:"password",placeholder:i("APPS.TIKTOK.PASSWORD"),onChange:d=>{d.target.value.length>50||P({...s,password:d.target.value})}}),e("div",{className:"login-button","data-disabled":L,onClick:_,children:C==="login"?i("APPS.TIKTOK.LOGIN"):i("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:C==="login"?o(q,{children:[i("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:i("APPS.TIKTOK.SIGNUP")})]}):o(q,{children:[i("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:i("APPS.TIKTOK.LOGIN")})]})})]})}function Ut(){const{User:t,Profile:m,View:T,LoggedIn:S,UserPanel:I,Func:g,GoBack:u,Dm:l}=r.useContext(B),[a,C]=t,[n,s]=m,[P,L]=S,[y,_]=I,[d,v]=u,[N,b]=l,[U,O]=T,[F,k]=r.useState([]),[w,f]=r.useState(!1),[c,K]=r.useState("recent"),[R,G]=r.useState((n==null?void 0:n.follower_count)||0),[x,X]=r.useState((n==null?void 0:n.following_count)||0),j=[{value:"recent",icon:e(Qe,{})},{value:"liked",icon:n!=null&&n.show_likes?e(Ve,{}):e(et,{})},{value:"saved",hidden:(a==null?void 0:a.username)!==(n==null?void 0:n.username),icon:e(Me,{})}],ae=[{label:i("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:i("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:i("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];r.useEffect(()=>{ie("TikTok")&&n&&(G((n==null?void 0:n.follower_count)||0),X((n==null?void 0:n.following_count)||0),k([]),!(c==="liked"&&!(n!=null&&n.show_likes)&&a.username!==n.username)&&E("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:c},page:0},$.Videos.filter(A=>A.username===n.username)).then(A=>{if(!A)return h("warning","Failed to get videos");k(A)}))},[c,n==null?void 0:n.username]);const{handleScroll:ue}=ge({fetchData:A=>E("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:c},page:A}),onDataFetched:A=>k(D=>[...D,...A]),perPage:25}),V=A=>{E("TikTok",{action:"toggleFollow",data:{username:n.username,follow:A}},{success:!0}).then(D=>{if(!D||!(D!=null&&D.success))return h("warning","Failed to toggle follow");if(D.error)return h("error",D.error);h("info",`Toggling follow to ${A}`),s({...n,isFollowing:A})})};le("tiktok:updateFollowers",A=>{if(!A||A.username!==n.username)return;let D=R+(A.method==="add"?1:-1);s({...n,follower_count:D}),G(D)}),le("tiktok:updateFollowing",A=>{if(!A||A.username!==n.username)return;let D=x+(A.method==="add"?1:-1);s({...n,following_count:D}),X(D)});const H=()=>{a.username===n.username&&E("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(A=>{var ne;if(!A)return h("info","No accounts found");let D=a.isAdmin,Y=(ne=A==null?void 0:A.filter(p=>p!==a.username))==null?void 0:ne.map(p=>({title:p,cb:()=>{p!==a.username&&E("AccountSwitcher",{action:"switch",app:"TikTok",account:p}).then(()=>{E("TikTok",{action:"isLoggedIn"}).then(M=>{M?(te.APPS.TIKTOK.account.set(M),C({...M,isAdmin:D}),O("feed"),L(!0)):te.APPS.TIKTOK.account.set(null)})})}}));W.ContextMenu.set({buttons:[...Y,{title:i("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{L(!1)}}]})})},Q=A=>{C(A),s(A),f(!1)},J=()=>{a.username!==n.username&&E("TikTok",{action:"getChannelId",username:n.username}).then(A=>{b({id:A.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),v({view:"profile",data:{identifier:"profile",data:n}}),O("dm"),s(null)})};return n?o(q,{children:[e(Te,{children:w&&e(Ft,{close:A=>Q(A)})}),o(se.div,{className:"profile-container",children:[o("div",{className:"profile-header",children:[n.username===a.username?e("span",{}):e("div",{children:e(he,{className:"go-back",onClick:()=>{var A,D;if(d!=null&&d.view){if(d!=null&&d.data)switch((A=d==null?void 0:d.data)==null?void 0:A.identifier){case"dm":b((D=d==null?void 0:d.data)==null?void 0:D.data),O("dm");break;default:O("feed"),s(null)}else O(d==null?void 0:d.view);v(null)}else O("feed");s(null)}})}),o("div",{className:"name",onClick:H,children:[n.name,a.username===n.username&&e(Re,{})]}),e("span",{})]}),o("div",{className:"profile-info",onScroll:ue,children:[e("div",{className:"avatar",children:e("img",{src:Z(n.avatar)})}),o("div",{className:"username",children:["@",n.username,n.verified&&e(de,{})]}),e("div",{className:"stats",children:ae.map((A,D)=>{let Y={followers:R,following:x};return o("div",{className:"item","data-cursor":A.name!==void 0,onClick:()=>{A.name&&_({value:A.name,username:n.username,following:x,followers:R})},children:[e("div",{className:"value",children:z(Y[A.name]??n.like_count)}),e("div",{className:"label",children:A.label})]},D)})}),o("div",{className:"actions",children:[a.username===n.username?e("div",{className:"button big",onClick:()=>f(!0),children:i("APPS.TIKTOK.EDIT_PROFILE")}):e(q,{children:n.isFollowing?o(q,{children:[e("div",{className:oe("button","big"),onClick:J,children:i("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>V(!1)}]})},children:e(tt,{})})]}):o(q,{children:[e("div",{className:"button follow",onClick:()=>V(!0),children:i("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:J,children:e(Fe,{})})]})}),n.instagram&&e("div",{className:"button instapic",onClick:()=>{ve.patch({active:{name:"Instagram",data:{username:n.instagram,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/instagram/icon.svg"})}),n.twitter&&e("div",{className:"button birdy",onClick:()=>{ve.patch({active:{name:"Twitter",data:{username:n.twitter,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/twitter/logo.png"})})]}),e("div",{className:"bio",children:n.bio}),o("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:j.filter(A=>!A.hidden).map(A=>e("div",{className:oe("item",c===A.value&&"active"),onClick:()=>K(A.value),children:A.icon}))}),o("div",{className:"feed",children:[c==="liked"&&!(n!=null&&n.show_likes)&&a.username!==n.username&&o("div",{className:"private",children:[e("div",{className:"title",children:i("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:i("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),F.map((A,D)=>e(Dt,{data:A,onClick:()=>{v({...d,ignoreFeed:!0}),g.fetchAndSetVideo(A.id,{username:n.username,id:A.id,type:c})}}))]})]})]})]})]}):null}const Dt=({data:t,onClick:m})=>o("div",{className:"item",onClick:m,children:[e("video",{src:t.src,loop:!0,onMouseEnter:T=>T.currentTarget.play().catch(()=>h("warning","Failed to play video")),onMouseLeave:T=>T.currentTarget.pause(),muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),o("div",{className:"views",children:[e(be,{}),z(t.views)]})]}),Ft=t=>{var P,L,y,_,d,v;const{User:m,LoggedIn:T,View:S}=r.useContext(B),[I,g]=m,[u,l]=T,[a,C]=r.useState(null),n=["instagram","twitter"];r.useEffect(()=>{C({name:I.name,bio:I.bio,avatar:I.avatar,instagram:I.instagram,twitter:I.twitter,show_likes:I.show_likes})},[]);const s=()=>{E("TikTok",{action:"updateProfile",data:a},{success:!0}).then(N=>{if(!N)return h("warning","No response from server");if(N.success)te.APPS.TIKTOK.account.set({...I,...a}),t.close({...I,...a});else switch(h("error",N.error),N.error){case"invalid_twitter":W.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.TWITTER.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":W.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.INSTAGRAM.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return o(se.div,{...Pe,className:"edit-profile-container",children:[o("div",{className:"edit-profile-header",children:[e("div",{children:e(he,{onClick:s})}),e("div",{className:"title",children:i("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),o("div",{className:"edit-profile-content",children:[o("div",{className:"avatar",children:[o("div",{className:"image",onClick:()=>{var N,b,U;return W.Gallery.set({allowExternal:(U=(b=(N=fe)==null?void 0:N.value)==null?void 0:b.AllowExternal)==null?void 0:U.Trendy,onSelect:O=>C({...a,avatar:O.src})})},children:[e("img",{src:Z(a==null?void 0:a.avatar)}),e(nt,{})]}),i("APPS.TIKTOK.CHANGE_PHOTO")]}),o("div",{className:"form",children:[o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.NAME")}),e(ce,{type:"text",defaultValue:a==null?void 0:a.name,onChange:N=>{N.target.value.length<=30&&C({...a,name:N.target.value})}})]}),o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.USERNAME")}),e(ce,{type:"text",disabled:!0,value:I.username})]}),o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.BIO")}),e(We,{placeholder:i("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:a==null?void 0:a.bio,onChange:N=>{N.target.value.length<=150&&C({...a,bio:N.target.value})}})]}),e("div",{className:"break"}),n.map((N,b)=>o("div",{className:"item",children:[e("div",{className:"label",children:ke(N)}),e("div",{className:"value",onClick:()=>{a!=null&&a[N]?W.PopUp.set({title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:i(`APPS.${N.toUpperCase()}.TITLE`)}),description:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:i(`APPS.${N.toUpperCase()}.TITLE`)}),buttons:[{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{C({...a,[N]:null})}}]}):E("AccountSwitcher",{action:"getAccounts",app:ke(N)}).then(U=>{U||h("info","No accounts found");let O=(U==null?void 0:U.map(F=>({title:F,cb:()=>{C({...a,[N]:F})}})))??[];W.ContextMenu.set({buttons:[...O]})})},children:a!=null&&a[N]?`@${a==null?void 0:a[N]}`:i("APPS.TIKTOK.ADD_ACCOUNT").format({name:i(`APPS.${N.toUpperCase()}.TITLE`)})})]},b)),e("div",{className:"break"}),o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.SHOW_LIKES")}),e(gt,{checked:a==null?void 0:a.show_likes,onChange:()=>{C({...a,show_likes:!(a!=null&&a.show_likes)})}})]})]}),o("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{W.PopUp.set({title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{E("TikTok",{action:"logout"},!0).then(N=>{if(!N)return h("warning","Failed to logout");te.APPS.TIKTOK.account.set(null),l(!1)})}}]})},children:i("APPS.TIKTOK.LOGOUT")}),((y=(L=(P=fe)==null?void 0:P.value)==null?void 0:L.ChangePassword)==null?void 0:y.Trendy)&&e("div",{className:"button red",onClick:()=>it("TikTok",()=>{}),children:i("APPS.TIKTOK.CHANGE_PASSWORD")}),((v=(d=(_=fe)==null?void 0:_.value)==null?void 0:d.DeleteAccount)==null?void 0:v.Trendy)&&e("div",{className:"button red",onClick:()=>{st("TikTok",()=>{l(null),g(null),te.APPS.TIKTOK.account.set(null)})},children:i("APPS.TIKTOK.DELETE_ACCOUNT")})]})]})]})};function yt(){var d,v,N,b,U,O,F;const{View:t,User:m}=r.useContext(B),[T]=m,[S,I]=t,[g,u]=r.useState(0),[l,a]=r.useState(!1),[C,n]=r.useState("en_us_001"),[s,P]=r.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[L,y]=r.useState(!1);r.useEffect(()=>{y(s.src&&s.caption)},[s]),r.useEffect(()=>{var k,w,f;switch(g){case 0:W.Gallery.set({allowExternal:(f=(w=(k=fe)==null?void 0:k.value)==null?void 0:w.AllowExternal)==null?void 0:f.Trendy,includeVideos:!0,includeImages:!1,onSelect:c=>{P({...s,src:c.src}),u(K=>K+1)}});break}},[g]);const _=()=>{var k,w;E("TikTok",{action:"uploadVideo",data:{src:s.src,caption:s.caption,metadata:((k=s.metadata)==null?void 0:k.ttsUrl)&&s.metadata,music:((w=s.music)==null?void 0:w.path)&&{path:s.music.path,volume:s.music.volume}}},{success:!0}).then(f=>{if(!f||f.error)return h("warning","Failed to upload video, error: "+f.error);if(!f.success)return h("warning","Failed to upload video");I("feed")})};return o("div",{className:"upload-container",children:[l&&e("div",{className:"loading",children:e(Be,{size:40,lineWeight:5,speed:2,color:((v=(d=re.Settings)==null?void 0:d.value)==null?void 0:v.display.theme)==="dark"?"#fff":"#000"})}),g!==0&&o(q,{children:[o("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(g===2)return u(k=>k-1);if(g===1)return I("feed")},children:g===2?i("APPS.TIKTOK.GO_BACK"):i("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:i("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!L,onClick:()=>{if(L){if(g===2)return _();s!=null&&s.metadata.tts?(a(!0),Mt(s.metadata.tts,C).then(k=>{a(!1),P({...s,metadata:{...s.metadata,ttsUrl:k}}),u(w=>w+1)}).catch(k=>{a(!1),W.PopUp.set({title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{u(w=>w+1)}}]})})):u(k=>k+1)}},children:g===1?i("APPS.TIKTOK.PREVIEW"):i("APPS.TIKTOK.SHARE")})]}),o("div",{className:"upload-body",children:[g===1&&o(q,{children:[e("div",{className:"video-placeholder",children:e("video",{src:s.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),o("div",{className:"form",children:[o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.CAPTION")}),e(ce,{defaultValue:s.caption,placeholder:i("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:k=>{if(k.target.value.length<=100)return P({...s,caption:k.target.value})}})]}),o("div",{className:"item",children:[o("div",{className:"label",children:[i("APPS.TIKTOK.TTS")," ",o("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),e(We,{defaultValue:(N=s==null?void 0:s.metadata)==null?void 0:N.tts,placeholder:i("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:k=>{if(k.target.value.length<=300)return P({...s,metadata:{...s.metadata,tts:k.target.value}})}}),((b=s==null?void 0:s.metadata)==null?void 0:b.tts)&&e("select",{onChange:k=>n(k.target.value),children:(O=(U=fe)==null?void 0:U.value.TikTokTTS)==null?void 0:O.map(k=>e("option",{value:k[1],selected:k[1]===C,children:k[0]}))})]}),o("div",{className:"item",children:[o("div",{className:"label",children:[i("APPS.TIKTOK.MUSIC")," ",o("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),o("div",{className:"button",onClick:()=>W.MusicSelector.set({onSelect:k=>P({...s,music:{...s.music,...k}})}),children:[s.music?s.music.title:i("APPS.TIKTOK.SELECT_MUSIC"),e(Ne,{onClick:k=>{k.stopPropagation(),P({...s,music:null})}})]}),((F=s.music)==null?void 0:F.title)&&o("div",{className:"slider",children:[e(ot,{}),e(pt,{min:0,max:.5,step:.025,value:s.music.volume??.25,onChange:k=>P({...s,music:{...s.music,volume:k}})}),e(at,{})]})]})]})]}),g===2&&e("div",{className:"preview",children:e(we,{data:{...s,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:T.username,avatar:Z(T.avatar),verified:T.verified,music:s.music},active:!0,preview:!0})})]})]})]})}const Rt=async(t,m,T)=>{const S=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:m,voice:T})});if(!S.ok)throw new Error(`Fetch error: ${S.status} ${S.statusText}`);return S.json()},Vt=async(t,m)=>{const T=await Rt("https://tiktok-tts.weilnet.workers.dev/api/generation",t,m);if(T.success&&T.data)return T.data;throw T},Mt=async(t,m)=>{try{const T=await Vt(t,m),I=await(await fetch(`data:application/octet-stream;base64,${T}`)).arrayBuffer(),g=new Uint8Array(I),u=new Blob([g],{type:"audio/mp3"});return await rt("Audio",u)}catch(T){throw T}};function xt(){const{View:t,User:m,Profile:T,FeedData:S}=r.useContext(B),[I,g]=m,[u,l]=t,[a,C]=T,[n,s]=S,P=[{value:"feed",label:i("APPS.TIKTOK.HOME"),activeIcon:e(lt,{}),icon:e(ct,{}),cb:()=>{l("feed"),s(null)}},{value:"discover",label:i("APPS.TIKTOK.DISCOVER"),activeIcon:e(dt,{}),icon:e(ut,{})},{value:"upload",label:i("APPS.TIKTOK.UPLOAD"),activeIcon:e(Ke,{}),icon:e(Ke,{})},{value:"inbox",label:i("APPS.TIKTOK.INBOX"),activeIcon:e(mt,{}),icon:e(ye,{})},{value:"profile",label:i("APPS.TIKTOK.PROFILE"),activeIcon:e(ft,{}),icon:e(ht,{}),cb:()=>{C(I),l("profile")}}];return e("div",{className:"tiktok-footer","data-feed":u==="feed",children:P.map((L,y)=>{let _=u===L.value;return o("div",{className:"item","data-active":_,onClick:()=>L.cb?L.cb():l(L.value),children:[_?L.activeIcon:L.icon,L.label]},y)})})}function Gt(){const{User:t,ShareComponent:m,View:T}=r.useContext(B),[S]=t,[I,g]=T,[u,l]=m,[a,C]=r.useState([]);r.useState(!1);const[n,s]=r.useState(u==null?void 0:u.pinned);return r.useEffect(()=>{E("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(P=>{if(!(P!=null&&P.success))return h("warning",P.error);C(P.channels.sort((L,y)=>y.timestamp-L.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>l(null),children:o(se.div,{...Pe,className:"share-wrapper",onClick:P=>P.stopPropagation(),children:[e("div",{className:"share-header",children:i("APPS.TIKTOK.SHARE_TITLE")}),o("div",{className:"share-body",children:[e("div",{className:"friends",children:a.map(P=>e(Bt,{data:{username:P.username,name:P.name,avatar:P.avatar,verified:P.verified}}))}),o("div",{className:"options",children:[o("div",{className:"item",children:[e(Tt,{}),i("APPS.TIKTOK.REPORT")]}),S.username===(u==null?void 0:u.username)&&o(q,{children:[o("div",{className:"item",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?i("APPS.TIKTOK.UNPIN"):i("APPS.TIKTOK.PIN")}),buttons:[{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{E("TikTok",{action:"togglePinnedVideo",id:u==null?void 0:u.id,toggle:!n},{success:!0}).then(P=>{if(P!=null&&P.success||h("warning",P.error),P!=null&&P.error&&P.error==="max_pinned")return W.PopUp.set({title:i("APPS.TIKTOK.MAX_PINNED_TITLE"),description:i("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.OK")}]});s(!n)})}}]})},children:[e(vt,{}),n?i("APPS.TIKTOK.UNPIN_VIDEO"):i("APPS.TIKTOK.PIN_VIDEO")]}),o("div",{className:"item",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{E("TikTok",{action:"deleteVideo",id:u==null?void 0:u.id},{success:!0}).then(P=>{P!=null&&P.success||h("warning",P.error),l(null),g("profile")})}}]})},children:[e(Pt,{}),i("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>l(null),children:i("APPS.TIKTOK.CANCEL")})]})})}const Bt=t=>{const{ShareComponent:m}=r.useContext(B),[T]=m,[S,I]=r.useState(!1);return o("div",{className:"item","data-sent":S,onClick:()=>{if(S)return h("warning","You have already sent this video to this user!");E("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${T.src}"ID="${T.id}"!>`}},{success:!0}).then(u=>{if(!(u!=null&&u.success))return h("warning",u.error);h("info","Successfully sent video to user!"),I(!0)})},children:[e("img",{src:Z(t.data.avatar)}),e("div",{className:"name",children:t.data.name}),S&&e(Le,{className:"checkmark"})]})};function Wt(){const{UserPanel:t}=r.useContext(B),[m,T]=t,[S,I]=r.useState([]),[g,u]=r.useState(m==null?void 0:m.value),l={following:"getFollowing",followers:"getFollowers"},a={following:i("APPS.TIKTOK.FOLLOWING"),followers:i("APPS.TIKTOK.FOLLOWERS")},C=(s,P)=>{var y,_;return(s===i("APPS.TIKTOK.FOLLOWING")?(y=$.Accounts[P])==null?void 0:y.following:((_=$.Accounts[P])==null?void 0:_.followers)??[]).map(d=>$.Accounts[d])};r.useEffect(()=>{!m||!(m!=null&&m.value)||g&&E("TikTok",{action:l[g],username:m.username,page:0},C(l[g],m.username)).then(s=>{if(!s)return h("warning","No data returned from tiktok event");I(s)})},[g]);const{handleScroll:n}=ge({fetchData:s=>E("TikTok",{action:l[m.value],username:m.username,page:s}),onDataFetched:s=>I([...S,...s]),perPage:15});return o(se.div,{...Pe,className:"userpanel-container",children:[o("div",{className:"userpanel-header",children:[e("div",{onClick:()=>T(null),children:e(he,{})}),e("div",{className:"title",children:m==null?void 0:m.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(s=>o("div",{className:"item","data-active":g===s,onClick:()=>u(s),children:[a[s]," ",z(m==null?void 0:m[s])??0]}))}),e("div",{className:"userpanel-content",onScroll:n,children:S.map((s,P)=>e(Ht,{data:s}))})]})}const Ht=({data:t})=>{const{Func:m,UserPanel:T}=r.useContext(B),[S,I]=T,[g,u]=r.useState(t.isFollowing),l=a=>{E("TikTok",{action:"toggleFollow",data:{username:t.username,follow:a}}).then(C=>{if(!C||!(C!=null&&C.success))return h("warning","Failed to toggle follow");if(C.error)return h("error",C.error);u(a)})};return o("div",{className:"item",onClick:()=>{m.fetchAndSetProfile(t.username),I(null)},children:[o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:Z(t.avatar)})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.name," ",t.verified&&e(de,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:oe("button",g?"following":"follow"),onClick:a=>{a.stopPropagation(),g?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>l(!1)}]}):l(!0)},children:g?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})};const B=r.createContext(null);function qt(){const t=me(re.Settings),[m,T]=r.useState(null),[S,I]=r.useState("feed"),[g,u]=r.useState(null),[l,a]=r.useState(null),[C,n]=r.useState(null),[s,P]=r.useState(null),[L,y]=r.useState(null),[_,d]=r.useState(null),[v,N]=r.useState(!1),[b,U]=r.useState(null),[O,F]=r.useState(!0),[k,w]=r.useState(!0);r.useEffect(()=>{E("isAdmin",null,!1).then(R=>{if(te.APPS.TIKTOK.account.value){T({...te.APPS.TIKTOK.account.value,isAdmin:R}),N(!0),F(!1);return}else if(te.APPS.TIKTOK.account.value===!1)return F(!1);E("TikTok",{action:"isLoggedIn"},$.Account).then(G=>{G?(te.APPS.TIKTOK.account.set(G),T({...G,isAdmin:R}),N(!0),F(!1)):(te.APPS.TIKTOK.account.set(!1),F(!1))})})},[]),r.useEffect(()=>{S==="feed"&&g||S==="profile"&&(g==null?void 0:g.username)!==m.username?w(!1):w(!0)},[g]);const f={profile:e(Ut,{}),video:e(we,{}),discover:e(St,{}),inbox:e(At,{}),messages:e(Nt,{}),dm:e(Kt,{}),upload:e(yt,{}),feed:e(Ee,{})},c=R=>{if(!R)return h("warning","Couldn't fetch profile (no username provided)");h("info",`Fetching profile ${R}`),E("TikTok",{action:"getProfile",username:R},$.Accounts.find(G=>G.username===R)).then(G=>{if(!G)return h("warning","Couldn't fetch profile");u(G),I("profile")})},K=(R,G)=>{E("TikTok",{action:"getVideo",id:R},{video:$.Videos.find(x=>x.id===R)}).then(x=>{if(!x)return h("warning","Couldn't fetch video");if(x.error)return h("warning",x.error);if(!(x!=null&&x.video))return h("warning","Couldn't fetch video");y({video:x.video,args:G}),I("feed")})};return e(B.Provider,{value:{User:[m,T],View:[S,I],Profile:[g,u],LoggedIn:[v,N],FeedData:[L,y],UserPanel:[C,n],ShareComponent:[s,P],GoBack:[_,d],Video:[b,U],Dm:[l,a],Func:{fetchAndSetProfile:c,fetchAndSetVideo:K}},children:O||t!=null&&t.airplaneMode?e("div",{className:"loading",children:e(Be,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":S==="feed",children:v===!0?o(q,{children:[o("div",{className:"tiktok-wrapper","data-profile":!k,children:[e(Ee,{}),S!=="feed"&&e(se.div,{...Ge(S=="discover"||S=="messages"?"right":"left",S),className:"tiktok-content",children:f==null?void 0:f[S]}),e(Te,{children:C&&e(Wt,{})})]}),e(Te,{children:s&&e(Gt,{})}),k&&e(xt,{})]}):e(bt,{})})})}const Z=t=>{var m;return t??`./assets/img/avatar-placeholder-${(m=re.Settings.value)==null?void 0:m.display.theme}.svg`},pe=t=>{if(!t)return;const m=new Date(t),S=new Date().getTime()-m.getTime(),I=Math.floor(S/(1e3*3600*24)),g=Math.floor(S/(1e3*3600)),u=Math.floor(S/(1e3*60)),l=Math.floor(S/1e3);return I>0?`${m.getMonth()+1}-${m.getDate()}`:g>0?`${g}h`:u>0?`${u}m`:l>0?`${l}s`:i("NOW")};function z(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{B as TikTokContext,qt as default,pe as formatDate,z as formatNumber,Z as getAvatar};
