import{u as h,j as n,m as b,S as w,a as e,L as r,F as v,x as _,f as C,ac as B,r as u,t as W,b as D,P as F,I as x,d as O,C as M,q as d,p as S,bg as U,aH as j,s as P,J as X,E as z,_ as k,N as G,H as R,A as Y}from"./index-4a091edb.js";function V(){const N=h(D),c=h(F.Settings),l=h(A),g=({amount:i})=>{const[t,m]=u.useState(!0);let a;return t&&(c!=null&&c.streamerMode)?a=parseInt("⁎".repeat(W(i,2).toString().length)).toLocaleString():a=W(i,2).toLocaleString(),a.length>15&&(a=a.slice(0,15)+"..."),e("div",{className:"value",onClick:()=>m(!t),children:N.CurrencyFormat.replace("%s",a)})};return n(b.div,{...w("left","home",.2),className:"overview",children:[e("div",{className:"wallet-header",children:e("div",{className:"title",children:r("APPS.WALLET.TITLE")})}),n("div",{className:"wrapper",children:[e("div",{className:"card"}),e("section",{children:n("div",{className:"item space",children:[n("div",{className:"balance",children:[e("div",{className:"title",children:r("APPS.WALLET.BALANCE")}),e(g,{amount:l.balance})]}),e("div",{className:"button",onClick:()=>E.set("newpayment"),children:r("APPS.WALLET.SEND")})]})}),l.recentTransactions&&l.recentTransactions.length>0&&n(v,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:r("APPS.WALLET.LATEST_TRANSACTIONS")}),n("div",{className:"link",onClick:()=>E.set("transactions"),children:[r("APPS.WALLET.ALL_TRANSACTIONS")," ",e(_,{})]})]}),e("section",{children:l.recentTransactions.slice(0,5).map((i,t)=>{let m=i.amount>0,a=i.company.match(/\d{10}/);return n("div",{className:"item multi",children:[i.logo?e("img",{src:i.logo}):!a&&e("div",{className:"image",children:i.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-details",children:[e("div",{className:"title",children:a?C(i.company):i.company}),e("div",{className:"date",children:B(i.timestamp)})]}),n("div",{className:`amount ${m?"green":"red"}`,children:[!m&&"-",N.CurrencyFormat.replace("%s",Math.abs(i.amount).toLocaleString())]})]})]},t)})})]}),l.bills&&l.bills.length>0&&n(v,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:r("APPS.WALLET.LATEST_BILLS")}),n("div",{className:"link",children:["All Bills ",e(_,{})]})]}),e("section",{})]})]})]})}function q(){const N=h(F.Settings),c=h(D),l=h(A),[g,i]=u.useState(""),[t,m]=u.useState(0),[a,o]=u.useState(""),[p,L]=u.useState(!1),I=s=>(d("info",`Can afford? ${l.balance>=s} Balance: ${l.balance}, amount: ${s}`),l.balance>=s);u.useEffect(()=>{t===0?L(a.length>3):t===1&&L(a.length>0&&I(parseFloat(a))&&parseFloat(a)<=(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER))},[a]);const $=s=>{if(s=="backspace")return o(f=>f.length>0?f.slice(0,-1):"0");o(f=>f+s)};u.useEffect(()=>{if(t!==1||a.length>=9)return;const s=document.getElementById("number");s.style.width=`${a.length}ch`},[a]);const T=s=>{M.PopUp.set({title:r(`APPS.WALLET.${s}.TITLE`),description:r(`APPS.WALLET.${s}.DESCRIPTION`),buttons:[{title:r("APPS.WALLET.OK")}]})},H=()=>{if(p){if(t==0)S("Wallet",{action:"doesNumberExist",number:a},!0).then(s=>{if(!s)return T("NUMBER_DOES_NOT_EXIST");i(a),m(f=>f+1),o("")});else if(t==1){if(!I(parseFloat(a)))return T("INSUFFICIENT_FUNDS");if(parseFloat(a)>(c.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return T("Max transfer amount reached");if(N.airplaneMode)return T("AIRPLANE_MODE");S("Wallet",{action:"sendPayment",number:g,amount:Math.floor(parseFloat(a))},{success:!0}).then(s=>{s!=null&&s.success?m(f=>f+1):(d("warning","Could not send payment",s.reason),T(s.reason))})}}};return n(b.div,{...w("right","sendpayment",.25),className:"send-container",children:[n("div",{className:"send-header",children:[e("div",{onClick:()=>E.set("home"),children:t!==2&&n(v,{children:[e(x,{}),r("APPS.WALLET.HOME")]})}),t===2?e("div",{onClick:()=>E.set("home"),children:r("APPS.WALLET.DONE")}):e("div",{className:!p&&"disabled",onClick:H,children:r("APPS.WALLET.NEXT")})]}),n(b.div,{...w(t!==0?"right":null,t.toString(),.25),className:"send-wrapper",children:[t===0&&n(v,{children:[e("div",{className:"user",children:e(O,{className:"number_input",type:"number",onChange:s=>o(s.target.value.replace(/[^0-9]/g,"")),value:a,placeholder:C("1234567890")})}),e("div",{className:"button",onClick:()=>{M.ContactSelector.set({onSelect:s=>{if(!(s!=null&&s.number))return d("warning","No contact found");S("Wallet",{action:"doesNumberExist",number:s.number}).then(f=>{f?(i(s.number),m(1),o("")):setTimeout(()=>T("NUMBER_DOES_NOT_EXIST"),250)})}})},children:r("APPS.WALLET.SELECT_CONTACT")}),e("div",{className:"description",children:r("APPS.WALLET.NO_REFUNDS")})]}),t===1&&n(v,{children:[n("div",{className:"amount",children:[e("div",{className:"symbol",children:c.CurrencyFormat.replace("%s","")}),e(O,{type:"number",id:"number",value:a,onChange:s=>o(s.target.value.replace(/[^0-9]/g,""))})]}),n("div",{className:"description",children:[r("APPS.WALLET.NEW_BALANCE"),": ",c.CurrencyFormat.replace("%s",""),isNaN(W(l.balance-parseFloat(a),2))?l.balance:W(l.balance-parseFloat(a),2)]})]}),t===2&&n("div",{className:"success",children:[e(U,{}),e("div",{className:"title",children:r("APPS.WALLET.DONE")}),e("div",{className:"subtitle",children:r("APPS.WALLET.DONE_SUBTITLE").format({amount:c.CurrencyFormat.replace("%s",a),number:C(g)})})]})]}),t!==2&&e("div",{className:"numpad-wrapper",children:e(j,{cb:s=>$(s)})})]})}const y={balance:10230,transactions:[{amount:-99,company:"LB",logo:"https://docs.lbscripts.com/images/icons/icon.png",timestamp:Date.now()-1e3*60*60*2},{amount:-24.45,company:"Burgershot",logo:"https://ih0.redbubble.net/image.5360028329.7056/raf,360x360,075,t,fafafa:ca443f4786.jpg",timestamp:Date.now()-1e3*60*60*6},{amount:10,company:"Breze",timestamp:Date.now()-1e3*60*60*12},{amount:-22,company:"Breze",timestamp:Date.now()-1e3*60*60*24},{amount:-99,company:"Breze",timestamp:Date.now()-1e3*60*60*24*2},{amount:3400,company:"Salary",timestamp:Date.now()-1e3*60*60*24*4},{amount:-700,company:"Invoice #1234",timestamp:Date.now()-1e3*60*60*24*4}],bills:[]};function J(){const N=h(D),c=h(P.APPS.WALLET.transactions),[l,g]=u.useState({});u.useEffect(()=>{if(c.length>10)return d("info","Cache exists and is a lot of shit, nto fetching getTransations");S("Wallet",{action:"getTransactions"},y.transactions).then(t=>{if(!t)return d("warning","Failed to fetch transactions");P.APPS.WALLET.transactions.set(t)})},[]);const{handleScroll:i}=X({fetchData:t=>S("Wallet",{action:"getTransactions",page:t}),onDataFetched:t=>P.APPS.WALLET.transactions.set(t),perPage:25});return u.useEffect(()=>{if(!c)return;const t=c.reduce((m,a)=>{let o=new Date(a.timestamp).toDateString(),p=o.split(" ").slice(1,3).join(" ");return o===new Date().toDateString()?p=r("APPS.WALLET.TODAY"):o===new Date(new Date().setDate(new Date().getDate()-1)).toDateString()&&(p=r("APPS.WALLET.YESTERDAY")),m[p]||(m[p]=[]),m[p].push(a),m},{});g(t)},[c]),n(b.div,{className:"overview",...w("right","transactions",.2),children:[n("div",{className:"wallet-header",children:[n("div",{className:"navigation",onClick:()=>E.set("home"),children:[e(x,{}),r("APPS.WALLET.HOME")]}),e("div",{className:"title",children:r("APPS.WALLET.TRANSACTIONS")})]}),e("div",{className:"wrapper",onScroll:i,children:Object.keys(l).map((t,m)=>n(u.Fragment,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:t}),e("div",{className:"value",children:n(v,{children:[l[t].reduce((a,o)=>a+o.amount,0)>0?"+":"-",N.CurrencyFormat.replace("%s",Math.abs(l[t].reduce((a,o)=>a+o.amount,0)).toLocaleString())]})})]}),e("section",{children:l[t].map((a,o)=>{let p=a.amount>0,L=a.company.match(/\d{10}/);return n("div",{className:"item multi",children:[a.logo?e("img",{src:a.logo}):!L&&e("div",{className:"image",children:a.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-details",children:[e("div",{className:"title",children:L?C(a.company):a.company}),e("div",{className:"date",children:B(a.timestamp)})]}),n("div",{className:`amount ${p?"green":"red"}`,children:[!p&&"-",N.CurrencyFormat.replace("%s",Math.abs(a.amount).toLocaleString())]})]})]},o)})})]},m))})]})}const E=R("home"),A=R({balance:0,recentTransactions:[],bills:[]}),K={home:e(V,{}),transactions:e(J,{}),newpayment:e(q,{})};function Z(){const N=h(F.Settings),c=h(A),l=h(E),g=h(Y);return u.useEffect(()=>{var i;z("Wallet")&&(S("Wallet",{action:"getBalance"},y.balance).then(t=>{if(!t)return d("warning","Failed to fetch balance");A.patch({balance:t})}),((i=P.APPS.WALLET.transactions)==null?void 0:i.value.length)===0&&S("Wallet",{action:"getTransactions",recent:!0},y.transactions.slice(0,5)).then(t=>{if(!t)return d("warning","Failed to fetch transactions");A.patch({recentTransactions:t})}))},[g==null?void 0:g.active]),k("wallet:addTransaction",i=>{if(N.airplaneMode)return d("warning","Cannot add transaction in airplane mode");d("info","Adding transaction",i);let t={...i,timestamp:new Date().getTime()};P.APPS.WALLET.transactions.set([t,...c.recentTransactions]),A.patch({recentTransactions:[t,...c.recentTransactions].slice(0,5)})}),k("wallet:setBalance",i=>{if(N.airplaneMode)return d("warning","Cannot add transaction in airplane mode");if(!i)return d("warning","Failed to fetch balance");d("info","Setting balance",i),A.patch({balance:i})}),e("div",{className:"wallet-app-container",children:e(G,{children:K[l]})})}export{E as View,A as WalletInfo,Z as default};
